<<<<<<< HEAD
if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){const t=this.constructor;return this.then((a=>t.resolve(e()).then((()=>a))),(a=>t.resolve(e()).then((()=>{throw a}))))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const e=uni.requireGlobal();ArrayBuffer=e.ArrayBuffer,Int8Array=e.Int8Array,Uint8Array=e.Uint8Array,Uint8ClampedArray=e.Uint8ClampedArray,Int16Array=e.Int16Array,Uint16Array=e.Uint16Array,Int32Array=e.Int32Array,Uint32Array=e.Uint32Array,Float32Array=e.Float32Array,Float64Array=e.Float64Array,BigInt64Array=e.BigInt64Array,BigUint64Array=e.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(e){"use strict";function t(e,t,...a){uni.__log__?uni.__log__(e,t,...a):console[e].apply(console,[...a,t])}function a(e,t){return"string"==typeof e?t:e}const o=[{font_class:"arrow-down",unicode:""},{font_class:"arrow-left",unicode:""},{font_class:"arrow-right",unicode:""},{font_class:"arrow-up",unicode:""},{font_class:"auth",unicode:""},{font_class:"auth-filled",unicode:""},{font_class:"back",unicode:""},{font_class:"bars",unicode:""},{font_class:"calendar",unicode:""},{font_class:"calendar-filled",unicode:""},{font_class:"camera",unicode:""},{font_class:"camera-filled",unicode:""},{font_class:"cart",unicode:""},{font_class:"cart-filled",unicode:""},{font_class:"chat",unicode:""},{font_class:"chat-filled",unicode:""},{font_class:"chatboxes",unicode:""},{font_class:"chatboxes-filled",unicode:""},{font_class:"chatbubble",unicode:""},{font_class:"chatbubble-filled",unicode:""},{font_class:"checkbox",unicode:""},{font_class:"checkbox-filled",unicode:""},{font_class:"checkmarkempty",unicode:""},{font_class:"circle",unicode:""},{font_class:"circle-filled",unicode:""},{font_class:"clear",unicode:""},{font_class:"close",unicode:""},{font_class:"closeempty",unicode:""},{font_class:"cloud-download",unicode:""},{font_class:"cloud-download-filled",unicode:""},{font_class:"cloud-upload",unicode:""},{font_class:"cloud-upload-filled",unicode:""},{font_class:"color",unicode:""},{font_class:"color-filled",unicode:""},{font_class:"compose",unicode:""},{font_class:"contact",unicode:""},{font_class:"contact-filled",unicode:""},{font_class:"down",unicode:""},{font_class:"bottom",unicode:""},{font_class:"download",unicode:""},{font_class:"download-filled",unicode:""},{font_class:"email",unicode:""},{font_class:"email-filled",unicode:""},{font_class:"eye",unicode:""},{font_class:"eye-filled",unicode:""},{font_class:"eye-slash",unicode:""},{font_class:"eye-slash-filled",unicode:""},{font_class:"fire",unicode:""},{font_class:"fire-filled",unicode:""},{font_class:"flag",unicode:""},{font_class:"flag-filled",unicode:""},{font_class:"folder-add",unicode:""},{font_class:"folder-add-filled",unicode:""},{font_class:"font",unicode:""},{font_class:"forward",unicode:""},{font_class:"gear",unicode:""},{font_class:"gear-filled",unicode:""},{font_class:"gift",unicode:""},{font_class:"gift-filled",unicode:""},{font_class:"hand-down",unicode:""},{font_class:"hand-down-filled",unicode:""},{font_class:"hand-up",unicode:""},{font_class:"hand-up-filled",unicode:""},{font_class:"headphones",unicode:""},{font_class:"heart",unicode:""},{font_class:"heart-filled",unicode:""},{font_class:"help",unicode:""},{font_class:"help-filled",unicode:""},{font_class:"home",unicode:""},{font_class:"home-filled",unicode:""},{font_class:"image",unicode:""},{font_class:"image-filled",unicode:""},{font_class:"images",unicode:""},{font_class:"images-filled",unicode:""},{font_class:"info",unicode:""},{font_class:"info-filled",unicode:""},{font_class:"left",unicode:""},{font_class:"link",unicode:""},{font_class:"list",unicode:""},{font_class:"location",unicode:""},{font_class:"location-filled",unicode:""},{font_class:"locked",unicode:""},{font_class:"locked-filled",unicode:""},{font_class:"loop",unicode:""},{font_class:"mail-open",unicode:""},{font_class:"mail-open-filled",unicode:""},{font_class:"map",unicode:""},{font_class:"map-filled",unicode:""},{font_class:"map-pin",unicode:""},{font_class:"map-pin-ellipse",unicode:""},{font_class:"medal",unicode:""},{font_class:"medal-filled",unicode:""},{font_class:"mic",unicode:""},{font_class:"mic-filled",unicode:""},{font_class:"micoff",unicode:""},{font_class:"micoff-filled",unicode:""},{font_class:"minus",unicode:""},{font_class:"minus-filled",unicode:""},{font_class:"more",unicode:""},{font_class:"more-filled",unicode:""},{font_class:"navigate",unicode:""},{font_class:"navigate-filled",unicode:""},{font_class:"notification",unicode:""},{font_class:"notification-filled",unicode:""},{font_class:"paperclip",unicode:""},{font_class:"paperplane",unicode:""},{font_class:"paperplane-filled",unicode:""},{font_class:"person",unicode:""},{font_class:"person-filled",unicode:""},{font_class:"personadd",unicode:""},{font_class:"personadd-filled",unicode:""},{font_class:"personadd-filled-copy",unicode:""},{font_class:"phone",unicode:""},{font_class:"phone-filled",unicode:""},{font_class:"plus",unicode:""},{font_class:"plus-filled",unicode:""},{font_class:"plusempty",unicode:""},{font_class:"pulldown",unicode:""},{font_class:"pyq",unicode:""},{font_class:"qq",unicode:""},{font_class:"redo",unicode:""},{font_class:"redo-filled",unicode:""},{font_class:"refresh",unicode:""},{font_class:"refresh-filled",unicode:""},{font_class:"refreshempty",unicode:""},{font_class:"reload",unicode:""},{font_class:"right",unicode:""},{font_class:"scan",unicode:""},{font_class:"search",unicode:""},{font_class:"settings",unicode:""},{font_class:"settings-filled",unicode:""},{font_class:"shop",unicode:""},{font_class:"shop-filled",unicode:""},{font_class:"smallcircle",unicode:""},{font_class:"smallcircle-filled",unicode:""},{font_class:"sound",unicode:""},{font_class:"sound-filled",unicode:""},{font_class:"spinner-cycle",unicode:""},{font_class:"staff",unicode:""},{font_class:"staff-filled",unicode:""},{font_class:"star",unicode:""},{font_class:"star-filled",unicode:""},{font_class:"starhalf",unicode:""},{font_class:"trash",unicode:""},{font_class:"trash-filled",unicode:""},{font_class:"tune",unicode:""},{font_class:"tune-filled",unicode:""},{font_class:"undo",unicode:""},{font_class:"undo-filled",unicode:""},{font_class:"up",unicode:""},{font_class:"top",unicode:""},{font_class:"upload",unicode:""},{font_class:"upload-filled",unicode:""},{font_class:"videocam",unicode:""},{font_class:"videocam-filled",unicode:""},{font_class:"vip",unicode:""},{font_class:"vip-filled",unicode:""},{font_class:"wallet",unicode:""},{font_class:"wallet-filled",unicode:""},{font_class:"weibo",unicode:""},{font_class:"weixin",unicode:""}],s=(e,t)=>{const a=e.__vccOpts||e;for(const[o,s]of t)a[o]=s;return a};const n=s({name:"UniIcons",emits:["click"],props:{type:{type:String,default:""},color:{type:String,default:"#333333"},size:{type:[Number,String],default:16},customPrefix:{type:String,default:""},fontFamily:{type:String,default:""}},data:()=>({icons:o}),computed:{unicode(){let e=this.icons.find((e=>e.font_class===this.type));return e?e.unicode:""},iconSize(){return"number"==typeof(e=this.size)||/^[0-9]*$/g.test(e)?e+"px":e;var e},styleObj(){return""!==this.fontFamily?`color: ${this.color}; font-size: ${this.iconSize}; font-family: ${this.fontFamily};`:`color: ${this.color}; font-size: ${this.iconSize};`}},methods:{_onClick(){this.$emit("click")}}},[["render",function(t,a,o,s,n,i){return e.openBlock(),e.createElementBlock("text",{style:e.normalizeStyle(i.styleObj),class:e.normalizeClass(["uni-icons",["uniui-"+o.type,o.customPrefix,o.customPrefix?o.type:""]]),onClick:a[0]||(a[0]=(...e)=>i._onClick&&i._onClick(...e))},[e.renderSlot(t.$slots,"default",{},void 0,!0)],6)}],["__scopeId","data-v-5610c8db"]]),i=["{","}"];const l=/^(?:\d)+/,r=/^(?:\w)+/;const c="zh-Hans",u="zh-Hant",d="en",m=Object.prototype.hasOwnProperty,h=(e,t)=>m.call(e,t),p=new class{constructor(){this._caches=Object.create(null)}interpolate(e,t,a=i){if(!t)return[e];let o=this._caches[e];return o||(o=function(e,[t,a]){const o=[];let s=0,n="";for(;s<e.length;){let i=e[s++];if(i===t){n&&o.push({type:"text",value:n}),n="";let t="";for(i=e[s++];void 0!==i&&i!==a;)t+=i,i=e[s++];const c=i===a,u=l.test(t)?"list":c&&r.test(t)?"named":"unknown";o.push({value:t,type:u})}else n+=i}return n&&o.push({type:"text",value:n}),o}(e,a),this._caches[e]=o),function(e,t){const a=[];let o=0;const s=Array.isArray(t)?"list":(n=t,null!==n&&"object"==typeof n?"named":"unknown");var n;if("unknown"===s)return a;for(;o<e.length;){const n=e[o];switch(n.type){case"text":a.push(n.value);break;case"list":a.push(t[parseInt(n.value,10)]);break;case"named":"named"===s&&a.push(t[n.value])}o++}return a}(o,t)}};function g(e,t){if(!e)return;if(e=e.trim().replace(/_/g,"-"),t&&t[e])return e;if("chinese"===(e=e.toLowerCase()))return c;if(0===e.indexOf("zh"))return e.indexOf("-hans")>-1?c:e.indexOf("-hant")>-1?u:(a=e,["-tw","-hk","-mo","-cht"].find((e=>-1!==a.indexOf(e)))?u:c);var a;let o=[d,"fr","es"];t&&Object.keys(t).length>0&&(o=Object.keys(t));const s=function(e,t){return t.find((t=>0===e.indexOf(t)))}(e,o);return s||void 0}class f{constructor({locale:e,fallbackLocale:t,messages:a,watcher:o,formater:s}){this.locale=d,this.fallbackLocale=d,this.message={},this.messages={},this.watchers=[],t&&(this.fallbackLocale=t),this.formater=s||p,this.messages=a||{},this.setLocale(e||d),o&&this.watchLocale(o)}setLocale(e){const t=this.locale;this.locale=g(e,this.messages)||this.fallbackLocale,this.messages[this.locale]||(this.messages[this.locale]={}),this.message=this.messages[this.locale],t!==this.locale&&this.watchers.forEach((e=>{e(this.locale,t)}))}getLocale(){return this.locale}watchLocale(e){const t=this.watchers.push(e)-1;return()=>{this.watchers.splice(t,1)}}add(e,t,a=!0){const o=this.messages[e];o?a?Object.assign(o,t):Object.keys(t).forEach((e=>{h(o,e)||(o[e]=t[e])})):this.messages[e]=t}f(e,t,a){return this.formater.interpolate(e,t,a).join("")}t(e,t,a){let o=this.message;return"string"==typeof t?(t=g(t,this.messages))&&(o=this.messages[t]):a=t,h(o,e)?this.formater.interpolate(o[e],a).join(""):(console.warn(`Cannot translate the value of keypath ${e}. Use the value of keypath as default.`),e)}}const y={en:{"uni-search-bar.cancel":"cancel","uni-search-bar.placeholder":"Search enter content"},"zh-Hans":{"uni-search-bar.cancel":"取消","uni-search-bar.placeholder":"请输入搜索内容"},"zh-Hant":{"uni-search-bar.cancel":"取消","uni-search-bar.placeholder":"請輸入搜索內容"}},{t:b}=function(e,t={},a,o){if("string"!=typeof e){const a=[t,e];e=a[0],t=a[1]}"string"!=typeof e&&(e="undefined"!=typeof uni&&uni.getLocale?uni.getLocale():"undefined"!=typeof global&&global.getLocale?global.getLocale():d),"string"!=typeof a&&(a="undefined"!=typeof __uniConfig&&__uniConfig.fallbackLocale||d);const s=new f({locale:e,fallbackLocale:a,messages:t,watcher:o});let n=(e,t)=>{if("function"!=typeof getApp)n=function(e,t){return s.t(e,t)};else{let e=!1;n=function(t,a){const o=getApp().$vm;return o&&(o.$locale,e||(e=!0,function(e,t){e.$watchLocale?e.$watchLocale((e=>{t.setLocale(e)})):e.$watch((()=>e.$locale),(e=>{t.setLocale(e)}))}(o,s))),s.t(t,a)}}return n(e,t)};return{i18n:s,f:(e,t,a)=>s.f(e,t,a),t:(e,t)=>n(e,t),add:(e,t,a=!0)=>s.add(e,t,a),watch:e=>s.watchLocale(e),getLocale:()=>s.getLocale(),setLocale:e=>s.setLocale(e)}}(y);const k=s({name:"UniSearchBar",emits:["input","update:modelValue","clear","cancel","confirm","blur","focus"],props:{placeholder:{type:String,default:""},radius:{type:[Number,String],default:5},clearButton:{type:String,default:"auto"},cancelButton:{type:String,default:"auto"},cancelText:{type:String,default:""},bgColor:{type:String,default:"#F8F8F8"},textColor:{type:String,default:"#000000"},maxlength:{type:[Number,String],default:100},value:{type:[Number,String],default:""},modelValue:{type:[Number,String],default:""},focus:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1}},data:()=>({show:!1,showSync:!1,searchVal:""}),computed:{cancelTextI18n(){return this.cancelText||b("uni-search-bar.cancel")},placeholderText(){return this.placeholder||b("uni-search-bar.placeholder")}},watch:{modelValue:{immediate:!0,handler(e){this.searchVal=e,e&&(this.show=!0)}},focus:{immediate:!0,handler(e){if(e){if(this.readonly)return;this.show=!0,this.$nextTick((()=>{this.showSync=!0}))}}},searchVal(e,t){this.$emit("input",e),this.$emit("update:modelValue",e)}},methods:{searchClick(){this.readonly||this.show||(this.show=!0,this.$nextTick((()=>{this.showSync=!0})))},clear(){this.searchVal="",this.$nextTick((()=>{this.$emit("clear",{value:""})}))},cancel(){this.readonly||(this.$emit("cancel",{value:this.searchVal}),this.searchVal="",this.show=!1,this.showSync=!1,plus.key.hideSoftKeybord())},confirm(){plus.key.hideSoftKeybord(),this.$emit("confirm",{value:this.searchVal})},blur(){plus.key.hideSoftKeybord(),this.$emit("blur",{value:this.searchVal})},emitFocus(e){this.$emit("focus",e.detail)}}},[["render",function(t,o,s,i,l,r){const c=a(e.resolveDynamicComponent("uni-icons"),n);return e.openBlock(),e.createElementBlock("view",{class:"uni-searchbar"},[e.createElementVNode("view",{style:e.normalizeStyle({borderRadius:s.radius+"px",backgroundColor:s.bgColor}),class:"uni-searchbar__box",onClick:o[5]||(o[5]=(...e)=>r.searchClick&&r.searchClick(...e))},[e.createElementVNode("view",{class:"uni-searchbar__box-icon-search"},[e.renderSlot(t.$slots,"searchIcon",{},(()=>[e.createVNode(c,{color:"#c0c4cc",size:"18",type:"search"})]),!0)]),l.show||l.searchVal?e.withDirectives((e.openBlock(),e.createElementBlock("input",{key:0,focus:l.showSync,disabled:s.readonly,placeholder:r.placeholderText,maxlength:s.maxlength,class:"uni-searchbar__box-search-input","confirm-type":"search",type:"text","onUpdate:modelValue":o[0]||(o[0]=e=>l.searchVal=e),style:e.normalizeStyle({color:s.textColor}),onConfirm:o[1]||(o[1]=(...e)=>r.confirm&&r.confirm(...e)),onBlur:o[2]||(o[2]=(...e)=>r.blur&&r.blur(...e)),onFocus:o[3]||(o[3]=(...e)=>r.emitFocus&&r.emitFocus(...e))},null,44,["focus","disabled","placeholder","maxlength"])),[[e.vModelText,l.searchVal]]):(e.openBlock(),e.createElementBlock("text",{key:1,class:"uni-searchbar__text-placeholder"},e.toDisplayString(s.placeholder),1)),l.show&&("always"===s.clearButton||"auto"===s.clearButton&&""!==l.searchVal)&&!s.readonly?(e.openBlock(),e.createElementBlock("view",{key:2,class:"uni-searchbar__box-icon-clear",onClick:o[4]||(o[4]=(...e)=>r.clear&&r.clear(...e))},[e.renderSlot(t.$slots,"clearIcon",{},(()=>[e.createVNode(c,{color:"#c0c4cc",size:"20",type:"clear"})]),!0)])):e.createCommentVNode("",!0)],4),"always"===s.cancelButton||l.show&&"auto"===s.cancelButton?(e.openBlock(),e.createElementBlock("text",{key:0,onClick:o[6]||(o[6]=(...e)=>r.cancel&&r.cancel(...e)),class:"uni-searchbar__cancel"},e.toDisplayString(r.cancelTextI18n),1)):e.createCommentVNode("",!0)])}],["__scopeId","data-v-2ba324d9"]]);const v=s({props:{chat:{type:Object,required:!0},index:{type:Number,required:!0},active:{type:Boolean,default:!1}}},[["render",function(t,a,o,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:"chat-item"},[e.createElementVNode("image",{class:"avatar",src:o.chat.avatar},null,8,["src"]),e.createElementVNode("view",{class:"content"},[e.createElementVNode("view",{class:"top-line"},[e.createElementVNode("text",{class:"name"},e.toDisplayString(o.chat.chatName?`${o.chat.chatName} ${o.index}`:o.chat.members.map((e=>e.nickname)).join(", ")),1),e.createElementVNode("text",{class:"time"},e.toDisplayString(o.chat.createdAt),1)]),e.createElementVNode("view",{class:"bottom-line"},[e.createElementVNode("text",{class:"message"},e.toDisplayString(o.chat.lastMessage),1),o.chat.unreadCount>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"badge"},e.toDisplayString(o.chat.unreadCount),1)):e.createCommentVNode("",!0)])])])}],["__scopeId","data-v-1c73c9d5"]]);const w=s({props:{items:{type:Array,required:!0}},data:()=>({menuVisible:!1}),methods:{showMenu(){this.menuVisible=!0},hideMenu(){this.menuVisible=!1},onSelect(e){this.$emit("select",e),this.hideMenu()}}},[["render",function(t,o,s,i,l,r){const c=a(e.resolveDynamicComponent("uni-icons"),n);return e.openBlock(),e.createElementBlock("view",{class:"pop-menu",onLongpress:o[2]||(o[2]=(...e)=>r.showMenu&&r.showMenu(...e))},[e.renderSlot(t.$slots,"default",{},void 0,!0),l.menuVisible?(e.openBlock(),e.createElementBlock("view",{key:0,class:"menu-overlay",onClick:o[1]||(o[1]=(...e)=>r.hideMenu&&r.hideMenu(...e))},[e.createElementVNode("view",{class:"menu-content",onClick:o[0]||(o[0]=e.withModifiers((()=>{}),["stop"]))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.items,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"menu-item",style:e.normalizeStyle({color:t.color||"#333"}),onClick:e=>r.onSelect(t)},[e.createVNode(c,{type:t.icon,size:"16"},null,8,["type"]),e.createElementVNode("text",null,e.toDisplayString(t.name),1)],12,["onClick"])))),128))])])):e.createCommentVNode("",!0)],32)}],["__scopeId","data-v-5c92a1cc"]]);const S=s({data:()=>({searchText:"",loading:!1,chats:[],menu:{show:!1,style:"",chatIdx:-1,isTouchMove:!1,items:[{key:"DELETE",name:"删除该聊天",icon:"trash",color:"#e64e4e"},{key:"TOP",name:"置顶该聊天",icon:"arrow-up"}]}}),methods:{navigateToChatRoom(e){e&&uni.navigateTo({url:`/pages/tabBar/chats/chat-room?chatId=${e.id}&actionType=${e.type}`})},fetchChats:async()=>(await new Promise(((e,t)=>{uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/chat",method:"GET",header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")},success:t=>e(t),fail:e=>t(e)})}))).data,onSelectMenu(e,t){switch(e.key){case"DELETE":this.removeChat(t);break;case"TOP":this.moveToTop(t)}this.menu.show=!1},removeChat(e){this.chats[e].delete=!0},moveToTop(e){const t=this.chats[e];this.chats.splice(e,1),this.chats.unshift(t)},isShowChat(e){return!e.delete&&(!this.searchText||e.showName.includes(this.searchText))},refreshUnreadBadge(){this.unreadCount>0?uni.setTabBarBadge({index:0,text:this.unreadCount+""}):uni.removeTabBarBadge({index:0,complete:()=>{}})}},computed:{unreadCount(){let e=0;return this.chats.forEach((t=>{t.delete||(e+=t.unreadCount)})),e}},watch:{unreadCount(e,t){this.refreshUnreadBadge()}},async onShow(){this.refreshUnreadBadge(),this.loading=!0,t("log","at pages/tabBar/chats/chats.vue:183","asdasdasd");const e=await this.fetchChats();this.loading=!1,this.chats=e.value,t("log","at pages/tabBar/chats/chats.vue:188",e)}},[["render",function(t,o,s,n,i,l){const r=a(e.resolveDynamicComponent("uni-search-bar"),k),c=a(e.resolveDynamicComponent("chat-item"),v),u=a(e.resolveDynamicComponent("pop-menu"),w);return e.openBlock(),e.createElementBlock("view",{class:"tab-page"},[i.loading?(e.openBlock(),e.createElementBlock("view",{key:0,class:"chat-loading"},[e.createElementVNode("view",{size:50,mask:!1},[e.createElementVNode("view",null,"消息接收中...")])])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"nav-bar"},[e.createElementVNode("view",{class:"nav-search"},[e.createVNode(r,{radius:"100",modelValue:i.searchText,"onUpdate:modelValue":o[0]||(o[0]=e=>i.searchText=e),cancelButton:"none",placeholder:"搜索"},null,8,["modelValue"])])]),i.loading||0!=i.chats.length?(e.openBlock(),e.createElementBlock("scroll-view",{key:2,class:"scroll-bar","scroll-with-animation":"true","scroll-y":"true"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.chats,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a},[l.isShowChat(t)?(e.openBlock(),e.createBlock(u,{key:0,items:i.menu.items,onSelect:e=>l.onSelectMenu(e,a)},{default:e.withCtx((()=>[e.createVNode(c,{chat:t,index:a,active:i.menu.chatIdx==a,clickable:"",onClick:e=>l.navigateToChatRoom(t)},null,8,["chat","index","active","onClick"])])),_:2},1032,["items","onSelect"])):e.createCommentVNode("",!0)])))),128))])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"chat-tip"}," 温馨提示：您现在还没有任何聊天消息，快跟您的好友发起聊天吧~ "))])}],["__scopeId","data-v-62923d1e"]]);const _=s({name:"UniBadge",emits:["click"],props:{type:{type:String,default:"error"},inverted:{type:Boolean,default:!1},isDot:{type:Boolean,default:!1},maxNum:{type:Number,default:99},absolute:{type:String,default:""},offset:{type:Array,default:()=>[0,0]},text:{type:[String,Number],default:""},size:{type:String,default:"small"},customStyle:{type:Object,default:()=>({})}},data:()=>({}),computed:{width(){return 8*String(this.text).length+12},classNames(){const{inverted:e,type:t,size:a,absolute:o}=this;return[e?"uni-badge--"+t+"-inverted":"","uni-badge--"+t,"uni-badge--"+a,o?"uni-badge--absolute":""].join(" ")},positionStyle(){if(!this.absolute)return{};let e=this.width/2,t=10;this.isDot&&(e=5,t=5);const a=`${-e+this.offset[0]}px`,o=`${-t+this.offset[1]}px`,s={rightTop:{right:a,top:o},rightBottom:{right:a,bottom:o},leftBottom:{left:a,bottom:o},leftTop:{left:a,top:o}},n=s[this.absolute];return n||s.rightTop},dotStyle(){return this.isDot?{width:"10px",minWidth:"0",height:"10px",padding:"0",borderRadius:"10px"}:{}},displayValue(){const{isDot:e,text:t,maxNum:a}=this;return e?"":Number(t)>a?`${a}+`:t}},methods:{onClick(){this.$emit("click")}}},[["render",function(t,a,o,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:"uni-badge--x"},[e.renderSlot(t.$slots,"default",{},void 0,!0),o.text?(e.openBlock(),e.createElementBlock("text",{key:0,class:e.normalizeClass([i.classNames,"uni-badge"]),style:e.normalizeStyle([i.positionStyle,o.customStyle,i.dotStyle]),onClick:a[0]||(a[0]=e=>i.onClick())},e.toDisplayString(i.displayValue),7)):e.createCommentVNode("",!0)])}],["__scopeId","data-v-bca7b097"]]);const V=s({name:"UniListItem",emits:["click","switchChange"],props:{direction:{type:String,default:"row"},title:{type:String,default:""},note:{type:String,default:""},ellipsis:{type:[Number,String],default:0},disabled:{type:[Boolean,String],default:!1},clickable:{type:Boolean,default:!1},showArrow:{type:[Boolean,String],default:!1},link:{type:[Boolean,String],default:!1},to:{type:String,default:""},showBadge:{type:[Boolean,String],default:!1},showSwitch:{type:[Boolean,String],default:!1},switchChecked:{type:[Boolean,String],default:!1},badgeText:{type:String,default:""},badgeType:{type:String,default:"success"},badgeStyle:{type:Object,default:()=>({})},rightText:{type:String,default:""},thumb:{type:String,default:""},thumbSize:{type:String,default:"base"},showExtraIcon:{type:[Boolean,String],default:!1},extraIcon:{type:Object,default:()=>({type:"",color:"#000000",size:20,customPrefix:""})},border:{type:Boolean,default:!0},customStyle:{type:Object,default:()=>({padding:"",backgroundColor:"#FFFFFF"})},keepScrollPosition:{type:Boolean,default:!1}},watch:{"customStyle.padding":{handler(e){"number"==typeof e&&(e+="");let t=e.split(" ");if(1===t.length){const e=t[0];this.padding={top:e,right:e,bottom:e,left:e}}else if(2===t.length){const[e,a]=t;this.padding={top:e,right:a,bottom:e,left:a}}else if(4===t.length){const[e,a,o,s]=t;this.padding={top:e,right:a,bottom:o,left:s}}},immediate:!0}},data:()=>({isFirstChild:!1,padding:{top:"",right:"",bottom:"",left:""}}),mounted(){this.list=this.getForm(),this.list&&(this.list.firstChildAppend||(this.list.firstChildAppend=!0,this.isFirstChild=!0))},methods:{getForm(e="uniList"){let t=this.$parent,a=t.$options.name;for(;a!==e;){if(t=t.$parent,!t)return!1;a=t.$options.name}return t},onClick(){""===this.to?(this.clickable||this.link)&&this.$emit("click",{data:{}}):this.openPage()},onSwitchChange(e){this.$emit("switchChange",e.detail)},openPage(){-1!==["navigateTo","redirectTo","reLaunch","switchTab"].indexOf(this.link)?this.pageApi(this.link):this.pageApi("navigateTo")},pageApi(e){let t={url:this.to,success:e=>{this.$emit("click",{data:e})},fail:e=>{this.$emit("click",{data:e})}};switch(e){case"navigateTo":default:uni.navigateTo(t);break;case"redirectTo":uni.redirectTo(t);break;case"reLaunch":uni.reLaunch(t);break;case"switchTab":uni.switchTab(t)}}}},[["render",function(t,o,s,i,l,r){const c=a(e.resolveDynamicComponent("uni-icons"),n),u=a(e.resolveDynamicComponent("uni-badge"),_);return e.openBlock(),e.createElementBlock("view",{class:e.normalizeClass([{"uni-list-item--disabled":s.disabled},"uni-list-item"]),style:e.normalizeStyle({"background-color":s.customStyle.backgroundColor}),"hover-class":!s.clickable&&!s.link||s.disabled||s.showSwitch?"":"uni-list-item--hover",onClick:o[1]||(o[1]=(...e)=>r.onClick&&r.onClick(...e))},[l.isFirstChild?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:0,class:e.normalizeClass(["border--left",{"uni-list--border":s.border}])},null,2)),e.createElementVNode("view",{class:e.normalizeClass(["uni-list-item__container",{"container--right":s.showArrow||s.link,"flex--direction":"column"===s.direction}]),style:e.normalizeStyle({paddingTop:l.padding.top,paddingLeft:l.padding.left,paddingRight:l.padding.right,paddingBottom:l.padding.bottom})},[e.renderSlot(t.$slots,"header",{},(()=>[e.createElementVNode("view",{class:"uni-list-item__header"},[s.thumb?(e.openBlock(),e.createElementBlock("view",{key:0,class:"uni-list-item__icon"},[e.createElementVNode("image",{src:s.thumb,class:e.normalizeClass(["uni-list-item__icon-img",["uni-list--"+s.thumbSize]])},null,10,["src"])])):s.showExtraIcon?(e.openBlock(),e.createElementBlock("view",{key:1,class:"uni-list-item__icon"},[e.createVNode(c,{customPrefix:s.extraIcon.customPrefix,color:s.extraIcon.color,size:s.extraIcon.size,type:s.extraIcon.type},null,8,["customPrefix","color","size","type"])])):e.createCommentVNode("",!0)])]),!0),e.renderSlot(t.$slots,"body",{},(()=>[e.createElementVNode("view",{class:e.normalizeClass(["uni-list-item__content",{"uni-list-item__content--center":s.thumb||s.showExtraIcon||s.showBadge||s.showSwitch}])},[s.title?(e.openBlock(),e.createElementBlock("text",{key:0,class:e.normalizeClass(["uni-list-item__content-title",[0!==s.ellipsis&&s.ellipsis<=2?"uni-ellipsis-"+s.ellipsis:""]])},e.toDisplayString(s.title),3)):e.createCommentVNode("",!0),s.note?(e.openBlock(),e.createElementBlock("text",{key:1,class:"uni-list-item__content-note"},e.toDisplayString(s.note),1)):e.createCommentVNode("",!0)],2)]),!0),e.renderSlot(t.$slots,"footer",{},(()=>[s.rightText||s.showBadge||s.showSwitch?(e.openBlock(),e.createElementBlock("view",{key:0,class:e.normalizeClass(["uni-list-item__extra",{"flex--justify":"column"===s.direction}])},[s.rightText?(e.openBlock(),e.createElementBlock("text",{key:0,class:"uni-list-item__extra-text"},e.toDisplayString(s.rightText),1)):e.createCommentVNode("",!0),s.showBadge?(e.openBlock(),e.createBlock(u,{key:1,type:s.badgeType,text:s.badgeText,"custom-style":s.badgeStyle},null,8,["type","text","custom-style"])):e.createCommentVNode("",!0),s.showSwitch?(e.openBlock(),e.createElementBlock("switch",{key:2,disabled:s.disabled,checked:s.switchChecked,onChange:o[0]||(o[0]=(...e)=>r.onSwitchChange&&r.onSwitchChange(...e))},null,40,["disabled","checked"])):e.createCommentVNode("",!0)],2)):e.createCommentVNode("",!0)]),!0)],6),s.showArrow||s.link?(e.openBlock(),e.createBlock(c,{key:1,size:16,class:"uni-icon-wrapper",color:"#bbb",type:"arrowright"})):e.createCommentVNode("",!0)],14,["hover-class"])}],["__scopeId","data-v-380d0f47"]]);const C=s({name:"uniList","mp-weixin":{options:{multipleSlots:!1}},props:{stackFromEnd:{type:Boolean,default:!1},enableBackToTop:{type:[Boolean,String],default:!1},scrollY:{type:[Boolean,String],default:!1},border:{type:Boolean,default:!0},renderReverse:{type:Boolean,default:!1}},created(){this.firstChildAppend=!1},methods:{loadMore(e){this.$emit("scrolltolower")},scroll(e){this.$emit("scroll",e)}}},[["render",function(t,a,o,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:"uni-list uni-border-top-bottom"},[o.border?(e.openBlock(),e.createElementBlock("view",{key:0,class:"uni-list--border-top"})):e.createCommentVNode("",!0),e.renderSlot(t.$slots,"default",{},void 0,!0),o.border?(e.openBlock(),e.createElementBlock("view",{key:1,class:"uni-list--border-bottom"})):e.createCommentVNode("",!0)])}],["__scopeId","data-v-c1d7c358"]]);const N=s({data:()=>({listData:[{title:"新的虚拟朋友",thumb:"/static/logo.png",url:"/pages/tabBar/contacts/newVirtualFriend"},{title:"新的真实朋友",thumb:"/static/logo.png",url:"/pages/tabBar/contacts/newRealFriend"},{title:"群聊",thumb:"/static/logo.png",url:"/pages/tabBar/contacts/groupChat"},{title:"我的AI",thumb:"/static/logo.png",url:"/pages/tabBar/ai/contacts"}],friendData:[]}),async onShow(){try{const e=(await new Promise(((e,t)=>{uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/contacts",method:"GET",header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")},success:t=>e(t),fail:e=>t(e)})}))).data;this.friendData=e.value,t("log","at pages/tabBar/contacts/contacts.vue:76",this.friendData)}catch(e){uni.showModal({title:"错误",content:"获取用户信息失败，请重新登录",showCancel:!1,success:()=>{uni.redirectTo({url:"/pages/log/log/log"})}})}},methods:{navigateTo(e){uni.navigateTo({url:e})},navigateToFriend(e){const a=e.contactprofile;t("log","at pages/tabBar/contacts/contacts.vue:104",a),uni.navigateTo({url:`/pages/detail/frienddetail?chatId=${e.chatId}&username=${a.username}&id=${a.id}&mood=${a.mood}&nickname=${a.nickname}&status=${a.status}`})}}},[["render",function(t,o,s,n,i,l){const r=a(e.resolveDynamicComponent("uni-search-bar"),k),c=a(e.resolveDynamicComponent("uni-list-item"),V),u=a(e.resolveDynamicComponent("uni-list"),C);return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"nav-bar"},[e.createElementVNode("view",{class:"nav-search"},[e.createVNode(r,{radius:"100",modelValue:t.searchText,"onUpdate:modelValue":o[0]||(o[0]=e=>t.searchText=e),cancelButton:"none",placeholder:"搜索"},null,8,["modelValue"])])]),e.createElementVNode("view",null,[e.createVNode(u,null,{default:e.withCtx((()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.listData,((t,a)=>(e.openBlock(),e.createBlock(c,{key:a,title:t.title,thumb:t.thumb,clickable:"",onClick:e=>l.navigateTo(t.url)},null,8,["title","thumb","onClick"])))),128))])),_:1})]),e.createElementVNode("view",null,[e.createVNode(u,null,{default:e.withCtx((()=>[e.createVNode(c,{title:"我的好友",customStyle:{backgroundColor:"#f5f5f5"}}),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.friendData,((t,a)=>(e.openBlock(),e.createBlock(c,{key:a,title:t.contactprofile.username,thumb:t.contactprofile.avatar,clickable:"",onClick:e=>l.navigateToFriend(t)},null,8,["title","thumb","onClick"])))),128))])),_:1})])])}]]);const B=s({name:"ProfilePage",data:()=>({id:uni.getStorageSync("id")??"",nickname:uni.getStorageSync("nickname")??"",username:uni.getStorageSync("username")??"",mood:uni.getStorageSync("mood")??"",status:uni.getStorageSync("status")??"",calender:""}),async onShow(){try{const e=(await new Promise(((e,t)=>{uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/profile",method:"GET",header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")},success:t=>e(t),fail:e=>t(e)})}))).data;this.id=e.value.id,this.nickname=e.value.nickname,this.username=e.value.username,this.mood=e.value.mood??"添加心情",this.status=e.value.status??"添加状态",uni.setStorageSync("id",this.id),uni.setStorageSync("nickname",this.nickname),uni.setStorageSync("username",this.username),uni.setStorageSync("mood",this.mood),uni.setStorageSync("status",this.status)}catch(e){uni.showModal({title:"错误",content:"获取用户信息失败，请重新登录",showCancel:!1,success:()=>{uni.redirectTo({url:"/pages/log/log/log"})}})}},methods:{onMoodTap(){uni.navigateTo({url:"/pages/accountsetting/setmood"})},onStatusTap(){uni.navigateTo({url:"/pages/accountsetting/setstatus"})},onAccountSettingTap(){uni.navigateTo({url:"/pages/tabBar/me/accountSetting"})},onScheduleTap(){uni.navigateTo({url:"/pages/accountsetting/setcal"})},onPicturesTap(){uni.showToast({title:"Tapped on My pictures",icon:"none"})},onPrivacyTap(){uni.showToast({title:"Tapped on Privacy management",icon:"none"})},onLogoutTap(){uni.removeStorageSync("token"),uni.removeStorageSync("refresh"),uni.redirectTo({url:"/pages/log/log/log"})}}},[["render",function(t,a,o,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"top-section"},[e.createElementVNode("view",{class:"head-sculpture"},[e.createElementVNode("image",{src:"/static/uni.png"})]),e.createElementVNode("view",{class:"right-section"},[e.createElementVNode("view",{class:"nickname"}," 昵称："+e.toDisplayString(n.nickname),1),e.createElementVNode("view",{class:"username"}," 用户名："+e.toDisplayString(n.username),1)])]),e.createElementVNode("view",{class:"middle-section"},[e.createElementVNode("button",{class:"mood",onClick:a[0]||(a[0]=(...e)=>i.onMoodTap&&i.onMoodTap(...e))},e.toDisplayString(n.mood),1),e.createElementVNode("button",{class:"status",onClick:a[1]||(a[1]=(...e)=>i.onStatusTap&&i.onStatusTap(...e))},e.toDisplayString(n.status),1)]),e.createElementVNode("view",{class:"settings-section"},[e.createElementVNode("button",{class:"setting-item",onClick:a[2]||(a[2]=(...e)=>i.onAccountSettingTap&&i.onAccountSettingTap(...e))},"账号设置"),e.createElementVNode("button",{class:"setting-item",onClick:a[3]||(a[3]=(...e)=>i.onScheduleTap&&i.onScheduleTap(...e))},"我的日程"),e.createElementVNode("button",{class:"setting-item",onClick:a[4]||(a[4]=(...e)=>i.onPicturesTap&&i.onPicturesTap(...e))},"我的图片"),e.createElementVNode("button",{class:"setting-item",onClick:a[5]||(a[5]=(...e)=>i.onPrivacyTap&&i.onPrivacyTap(...e))},"隐私设置")]),e.createElementVNode("view",{class:"logout-section"},[e.createElementVNode("button",{class:"logout-button",onClick:a[6]||(a[6]=(...e)=>i.onLogoutTap&&i.onLogoutTap(...e))},"登出")])])}],["__scopeId","data-v-551cee6f"]]);const x=s({name:"HomePage",methods:{goToLogin(){uni.navigateTo({url:"/pages/log/login/login"})},goToRegister(){uni.navigateTo({url:"/pages/log/register/register"})}}},[["render",function(t,a,o,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"button-section"},[e.createElementVNode("button",{class:"login-button",onClick:a[0]||(a[0]=(...e)=>i.goToLogin&&i.goToLogin(...e))},"登录"),e.createElementVNode("button",{class:"register-button",onClick:a[1]||(a[1]=(...e)=>i.goToRegister&&i.goToRegister(...e))},"注册")])])}],["__scopeId","data-v-bc8ff5cc"]]);function E(e){let t="";for(let a in e){t+=`${a}:${e[a]};`}return t}const T=s({name:"uni-easyinput",emits:["click","iconClick","update:modelValue","input","focus","blur","confirm","clear","eyes","change","keyboardheightchange"],model:{prop:"modelValue",event:"update:modelValue"},options:{virtualHost:!0},inject:{form:{from:"uniForm",default:null},formItem:{from:"uniFormItem",default:null}},props:{name:String,value:[Number,String],modelValue:[Number,String],type:{type:String,default:"text"},clearable:{type:Boolean,default:!0},autoHeight:{type:Boolean,default:!1},placeholder:{type:String,default:" "},placeholderStyle:String,focus:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},maxlength:{type:[Number,String],default:140},confirmType:{type:String,default:"done"},clearSize:{type:[Number,String],default:24},inputBorder:{type:Boolean,default:!0},prefixIcon:{type:String,default:""},suffixIcon:{type:String,default:""},trim:{type:[Boolean,String],default:!1},cursorSpacing:{type:Number,default:0},passwordIcon:{type:Boolean,default:!0},adjustPosition:{type:Boolean,default:!0},primaryColor:{type:String,default:"#2979ff"},styles:{type:Object,default:()=>({color:"#333",backgroundColor:"#fff",disableColor:"#F7F6F6",borderColor:"#e5e5e5"})},errorMessage:{type:[String,Boolean],default:""}},data:()=>({focused:!1,val:"",showMsg:"",border:!1,isFirstBorder:!1,showClearIcon:!1,showPassword:!1,focusShow:!1,localMsg:"",isEnter:!1}),computed:{isVal(){const e=this.val;return!(!e&&0!==e)},msg(){return this.localMsg||this.errorMessage},inputMaxlength(){return Number(this.maxlength)},boxStyle(){return`color:${this.inputBorder&&this.msg?"#e43d33":this.styles.color};`},inputContentClass(){return function(e){let t="";for(let a in e)e[a]&&(t+=`${a} `);return t}({"is-input-border":this.inputBorder,"is-input-error-border":this.inputBorder&&this.msg,"is-textarea":"textarea"===this.type,"is-disabled":this.disabled,"is-focused":this.focusShow})},inputContentStyle(){const e=this.focusShow?this.primaryColor:this.styles.borderColor;return E({"border-color":(this.inputBorder&&this.msg?"#dd524d":e)||"#e5e5e5","background-color":this.disabled?this.styles.disableColor:this.styles.backgroundColor})},inputStyle(){return E({"padding-right":"password"===this.type||this.clearable||this.prefixIcon?"":"10px","padding-left":this.prefixIcon?"":"10px"})}},watch:{value(e){this.val=e},modelValue(e){this.val=e},focus(e){this.$nextTick((()=>{this.focused=this.focus,this.focusShow=this.focus}))}},created(){this.init(),this.form&&this.formItem&&this.$watch("formItem.errMsg",(e=>{this.localMsg=e}))},mounted(){this.$nextTick((()=>{this.focused=this.focus,this.focusShow=this.focus}))},methods:{init(){this.value||0===this.value?this.val=this.value:this.modelValue||0===this.modelValue||""===this.modelValue?this.val=this.modelValue:this.val=null},onClickIcon(e){this.$emit("iconClick",e)},onEyes(){this.showPassword=!this.showPassword,this.$emit("eyes",this.showPassword)},onInput(e){let t=e.detail.value;this.trim&&("boolean"==typeof this.trim&&this.trim&&(t=this.trimStr(t)),"string"==typeof this.trim&&(t=this.trimStr(t,this.trim))),this.errMsg&&(this.errMsg=""),this.val=t,this.$emit("input",t),this.$emit("update:modelValue",t)},onFocus(){this.$nextTick((()=>{this.focused=!0})),this.$emit("focus",null)},_Focus(e){this.focusShow=!0,this.$emit("focus",e)},onBlur(){this.focused=!1,this.$emit("blur",null)},_Blur(e){if(e.detail.value,this.focusShow=!1,this.$emit("blur",e),!1===this.isEnter&&this.$emit("change",this.val),this.form&&this.formItem){const{validateTrigger:e}=this.form;"blur"===e&&this.formItem.onFieldChange()}},onConfirm(e){this.$emit("confirm",this.val),this.isEnter=!0,this.$emit("change",this.val),this.$nextTick((()=>{this.isEnter=!1}))},onClear(e){this.val="",this.$emit("input",""),this.$emit("update:modelValue",""),this.$emit("clear")},onkeyboardheightchange(e){this.$emit("keyboardheightchange",e)},trimStr:(e,t="both")=>"both"===t?e.trim():"left"===t?e.trimLeft():"right"===t?e.trimRight():"start"===t?e.trimStart():"end"===t?e.trimEnd():"all"===t?e.replace(/\s+/g,""):e}},[["render",function(t,o,s,i,l,r){const c=a(e.resolveDynamicComponent("uni-icons"),n);return e.openBlock(),e.createElementBlock("view",{class:e.normalizeClass(["uni-easyinput",{"uni-easyinput-error":r.msg}]),style:e.normalizeStyle(r.boxStyle)},[e.createElementVNode("view",{class:e.normalizeClass(["uni-easyinput__content",r.inputContentClass]),style:e.normalizeStyle(r.inputContentStyle)},[s.prefixIcon?(e.openBlock(),e.createBlock(c,{key:0,class:"content-clear-icon",type:s.prefixIcon,color:"#c0c4cc",onClick:o[0]||(o[0]=e=>r.onClickIcon("prefix")),size:"22"},null,8,["type"])):e.createCommentVNode("",!0),e.renderSlot(t.$slots,"left",{},void 0,!0),"textarea"===s.type?(e.openBlock(),e.createElementBlock("textarea",{key:1,class:e.normalizeClass(["uni-easyinput__content-textarea",{"input-padding":s.inputBorder}]),name:s.name,value:l.val,placeholder:s.placeholder,placeholderStyle:s.placeholderStyle,disabled:s.disabled,"placeholder-class":"uni-easyinput__placeholder-class",maxlength:r.inputMaxlength,focus:l.focused,autoHeight:s.autoHeight,"cursor-spacing":s.cursorSpacing,"adjust-position":s.adjustPosition,onInput:o[1]||(o[1]=(...e)=>r.onInput&&r.onInput(...e)),onBlur:o[2]||(o[2]=(...e)=>r._Blur&&r._Blur(...e)),onFocus:o[3]||(o[3]=(...e)=>r._Focus&&r._Focus(...e)),onConfirm:o[4]||(o[4]=(...e)=>r.onConfirm&&r.onConfirm(...e)),onKeyboardheightchange:o[5]||(o[5]=(...e)=>r.onkeyboardheightchange&&r.onkeyboardheightchange(...e))},null,42,["name","value","placeholder","placeholderStyle","disabled","maxlength","focus","autoHeight","cursor-spacing","adjust-position"])):(e.openBlock(),e.createElementBlock("input",{key:2,type:"password"===s.type?"text":s.type,class:"uni-easyinput__content-input",style:e.normalizeStyle(r.inputStyle),name:s.name,value:l.val,password:!l.showPassword&&"password"===s.type,placeholder:s.placeholder,placeholderStyle:s.placeholderStyle,"placeholder-class":"uni-easyinput__placeholder-class",disabled:s.disabled,maxlength:r.inputMaxlength,focus:l.focused,confirmType:s.confirmType,"cursor-spacing":s.cursorSpacing,"adjust-position":s.adjustPosition,onFocus:o[6]||(o[6]=(...e)=>r._Focus&&r._Focus(...e)),onBlur:o[7]||(o[7]=(...e)=>r._Blur&&r._Blur(...e)),onInput:o[8]||(o[8]=(...e)=>r.onInput&&r.onInput(...e)),onConfirm:o[9]||(o[9]=(...e)=>r.onConfirm&&r.onConfirm(...e)),onKeyboardheightchange:o[10]||(o[10]=(...e)=>r.onkeyboardheightchange&&r.onkeyboardheightchange(...e))},null,44,["type","name","value","password","placeholder","placeholderStyle","disabled","maxlength","focus","confirmType","cursor-spacing","adjust-position"])),"password"===s.type&&s.passwordIcon?(e.openBlock(),e.createElementBlock(e.Fragment,{key:3},[r.isVal?(e.openBlock(),e.createBlock(c,{key:0,class:e.normalizeClass(["content-clear-icon",{"is-textarea-icon":"textarea"===s.type}]),type:l.showPassword?"eye-slash-filled":"eye-filled",size:22,color:l.focusShow?s.primaryColor:"#c0c4cc",onClick:r.onEyes},null,8,["class","type","color","onClick"])):e.createCommentVNode("",!0)],64)):e.createCommentVNode("",!0),s.suffixIcon?(e.openBlock(),e.createElementBlock(e.Fragment,{key:4},[s.suffixIcon?(e.openBlock(),e.createBlock(c,{key:0,class:"content-clear-icon",type:s.suffixIcon,color:"#c0c4cc",onClick:o[11]||(o[11]=e=>r.onClickIcon("suffix")),size:"22"},null,8,["type"])):e.createCommentVNode("",!0)],64)):(e.openBlock(),e.createElementBlock(e.Fragment,{key:5},[s.clearable&&r.isVal&&!s.disabled&&"textarea"!==s.type?(e.openBlock(),e.createBlock(c,{key:0,class:e.normalizeClass(["content-clear-icon",{"is-textarea-icon":"textarea"===s.type}]),type:"clear",size:s.clearSize,color:r.msg?"#dd524d":l.focusShow?s.primaryColor:"#c0c4cc",onClick:r.onClear},null,8,["class","size","color","onClick"])):e.createCommentVNode("",!0)],64)),e.renderSlot(t.$slots,"right",{},void 0,!0)],6)],6)}],["__scopeId","data-v-b341649b"]]);const F=s({name:"uniFormsItem",options:{virtualHost:!0},provide(){return{uniFormItem:this}},inject:{form:{from:"uniForm",default:null}},props:{rules:{type:Array,default:()=>null},name:{type:[String,Array],default:""},required:{type:Boolean,default:!1},label:{type:String,default:""},labelWidth:{type:[String,Number],default:""},labelAlign:{type:String,default:""},errorMessage:{type:[String,Boolean],default:""},leftIcon:String,iconColor:{type:String,default:"#606266"}},data:()=>({errMsg:"",userRules:null,localLabelAlign:"left",localLabelWidth:"70px",localLabelPos:"left",border:!1,isFirstBorder:!1}),computed:{msg(){return this.errorMessage||this.errMsg}},watch:{"form.formRules"(e){this.init()},"form.labelWidth"(e){this.localLabelWidth=this._labelWidthUnit(e)},"form.labelPosition"(e){this.localLabelPos=this._labelPosition()},"form.labelAlign"(e){}},created(){this.init(!0),this.name&&this.form&&this.$watch((()=>this.form._getDataValue(this.name,this.form.localData)),((e,t)=>{if(!this.form._isEqual(e,t)){const t=this.itemSetValue(e);this.onFieldChange(t,!1)}}),{immediate:!1})},unmounted(){this.__isUnmounted=!0,this.unInit()},methods:{setRules(e=null){this.userRules=e,this.init(!1)},setValue(){},async onFieldChange(e,t=!0){const{formData:a,localData:o,errShowType:s,validateCheck:n,validateTrigger:i,_isRequiredField:l,_realName:r}=this.form,c=r(this.name);e||(e=this.form.formData[c]);const u=this.itemRules.rules&&this.itemRules.rules.length;if(!this.validator||!u||0===u)return;const d=l(this.itemRules.rules||[]);let m=null;return"bind"===i||t?(m=await this.validator.validateUpdate({[c]:e},a),d||void 0!==e&&""!==e||(m=null),m&&m.errorMessage?("undertext"===s&&(this.errMsg=m?m.errorMessage:""),"toast"===s&&uni.showToast({title:m.errorMessage||"校验错误",icon:"none"}),"modal"===s&&uni.showModal({title:"提示",content:m.errorMessage||"校验错误"})):this.errMsg="",n(m||null)):this.errMsg="",m||null},init(e=!1){const{validator:t,formRules:a,childrens:o,formData:s,localData:n,_realName:i,labelWidth:l,_getDataValue:r,_setDataValue:c}=this.form||{};if(this.localLabelAlign=this._justifyContent(),this.localLabelWidth=this._labelWidthUnit(l),this.localLabelPos=this._labelPosition(),this.form&&e&&o.push(this),!t||!a)return;this.form.isFirstBorder||(this.form.isFirstBorder=!0,this.isFirstBorder=!0),this.group&&(this.group.isFirstBorder||(this.group.isFirstBorder=!0,this.isFirstBorder=!0)),this.border=this.form.border;const u=i(this.name),d=this.userRules||this.rules;"object"==typeof a&&d&&(a[u]={rules:d},t.updateSchema(a));const m=a[u]||{};this.itemRules=m,this.validator=t,this.itemSetValue(r(this.name,n))},unInit(){if(this.form){const{childrens:e,formData:t,_realName:a}=this.form;e.forEach(((e,o)=>{e===this&&(this.form.childrens.splice(o,1),delete t[a(e.name)])}))}},itemSetValue(e){const t=this.form._realName(this.name),a=this.itemRules.rules||[],o=this.form._getValue(t,e,a);return this.form._setDataValue(t,this.form.formData,o),o},clearValidate(){this.errMsg=""},_isRequired(){return this.required},_justifyContent(){if(this.form){const{labelAlign:e}=this.form;let t=this.labelAlign?this.labelAlign:e;if("left"===t)return"flex-start";if("center"===t)return"center";if("right"===t)return"flex-end"}return"flex-start"},_labelWidthUnit(e){return this.num2px(this.labelWidth?this.labelWidth:e||(this.label?70:"auto"))},_labelPosition(){return this.form&&this.form.labelPosition||"left"},isTrigger:(e,t,a)=>"submit"!==e&&e?"bind":void 0===e?"bind"!==t?t?"submit":""===a?"bind":"submit":"bind":"submit",num2px:e=>"number"==typeof e?`${e}px`:e}},[["render",function(t,a,o,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:e.normalizeClass(["uni-forms-item",["is-direction-"+n.localLabelPos,n.border?"uni-forms-item--border":"",n.border&&n.isFirstBorder?"is-first-border":""]])},[e.renderSlot(t.$slots,"label",{},(()=>[e.createElementVNode("view",{class:e.normalizeClass(["uni-forms-item__label",{"no-label":!o.label&&!o.required}]),style:e.normalizeStyle({width:n.localLabelWidth,justifyContent:n.localLabelAlign})},[o.required?(e.openBlock(),e.createElementBlock("text",{key:0,class:"is-required"},"*")):e.createCommentVNode("",!0),e.createElementVNode("text",null,e.toDisplayString(o.label),1)],6)]),!0),e.createElementVNode("view",{class:"uni-forms-item__content"},[e.renderSlot(t.$slots,"default",{},void 0,!0),e.createElementVNode("view",{class:e.normalizeClass(["uni-forms-item__error",{"msg--active":i.msg}])},[e.createElementVNode("text",null,e.toDisplayString(i.msg),1)],2)])],2)}],["__scopeId","data-v-7b97b15c"]]);var M={email:/^\S+?@\S+?\.\S+?$/,idcard:/^[1-9]\d{5}(18|19|([23]\d))\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/,url:new RegExp("^(?!mailto:)(?:(?:http|https|ftp)://|//)(?:\\S+(?::\\S*)?@)?(?:(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[0-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))|localhost)(?::\\d{2,5})?(?:(/|\\?|#)[^\\s]*)?$","i")};const I={int:"integer",bool:"boolean",double:"number",long:"number",password:"string"};function $(e,t=""){["label"].forEach((t=>{void 0===e[t]&&(e[t]="")}));let a=t;for(let o in e){let t=new RegExp("{"+o+"}");a=a.replace(t,e[o])}return a}const P={integer:e=>P.number(e)&&parseInt(e,10)===e,string:e=>"string"==typeof e,number:e=>!isNaN(e)&&"number"==typeof e,boolean:function(e){return"boolean"==typeof e},float:function(e){return P.number(e)&&!P.integer(e)},array:e=>Array.isArray(e),object:e=>"object"==typeof e&&!P.array(e),date:e=>e instanceof Date,timestamp(e){return!(!this.integer(e)||Math.abs(e).toString().length>16)},file:e=>"string"==typeof e.url,email:e=>"string"==typeof e&&!!e.match(M.email)&&e.length<255,url:e=>"string"==typeof e&&!!e.match(M.url),pattern(e,t){try{return new RegExp(e).test(t)}catch(a){return!1}},method:e=>"function"==typeof e,idcard:e=>"string"==typeof e&&!!e.match(M.idcard),"url-https"(e){return this.url(e)&&e.startsWith("https://")},"url-scheme":e=>e.startsWith("://"),"url-web":e=>!1};const D={required:(e,t,a)=>e.required&&function(e,t){return null==e||"string"==typeof e&&!e||!(!Array.isArray(e)||e.length)||"object"===t&&!Object.keys(e).length}(t,e.format||typeof t)?$(e,e.errorMessage||a.required):null,range(e,t,a){const{range:o,errorMessage:s}=e;let n=new Array(o.length);for(let l=0;l<o.length;l++){const e=o[l];P.object(e)&&void 0!==e.value?n[l]=e.value:n[l]=e}let i=!1;return Array.isArray(t)?i=new Set(t.concat(n)).size===n.length:n.indexOf(t)>-1&&(i=!0),i?null:$(e,s||a.enum)},rangeNumber(e,t,a){if(!P.number(t))return $(e,e.errorMessage||a.pattern.mismatch);let{minimum:o,maximum:s,exclusiveMinimum:n,exclusiveMaximum:i}=e,l=n?t<=o:t<o,r=i?t>=s:t>s;return void 0!==o&&l?$(e,e.errorMessage||a.number[n?"exclusiveMinimum":"minimum"]):void 0!==s&&r?$(e,e.errorMessage||a.number[i?"exclusiveMaximum":"maximum"]):void 0!==o&&void 0!==s&&(l||r)?$(e,e.errorMessage||a.number.range):null},rangeLength(e,t,a){if(!P.string(t)&&!P.array(t))return $(e,e.errorMessage||a.pattern.mismatch);let o=e.minLength,s=e.maxLength,n=t.length;return void 0!==o&&n<o?$(e,e.errorMessage||a.length.minLength):void 0!==s&&n>s?$(e,e.errorMessage||a.length.maxLength):void 0!==o&&void 0!==s&&(n<o||n>s)?$(e,e.errorMessage||a.length.range):null},pattern:(e,t,a)=>P.pattern(e.pattern,t)?null:$(e,e.errorMessage||a.pattern.mismatch),format(e,t,a){var o=Object.keys(P),s=I[e.format]?I[e.format]:e.format||e.arrayType;return o.indexOf(s)>-1&&!P[s](t)?$(e,e.errorMessage||a.typeError):null},arrayTypeFormat(e,t,a){if(!Array.isArray(t))return $(e,e.errorMessage||a.typeError);for(let o=0;o<t.length;o++){const s=t[o];let n=this.format(e,s,a);if(null!==n)return n}return null}};class A extends class{constructor(e){this._message=e}async validateRule(e,t,a,o,s){var n=null;let i=t.rules;if(i.findIndex((e=>e.required))<0){if(null==a)return n;if("string"==typeof a&&!a.length)return n}var l=this._message;if(void 0===i)return l.default;for(var r=0;r<i.length;r++){let c=i[r],u=this._getValidateType(c);if(Object.assign(c,{label:t.label||`["${e}"]`}),D[u]&&null!=(n=D[u](c,a,l)))break;if(c.validateExpr){let e=Date.now();if(!1===c.validateExpr(a,s,e)){n=this._getMessage(c,c.errorMessage||this._message.default);break}}if(c.validateFunction&&null!==(n=await this.validateFunction(c,a,o,s,u)))break}return null!==n&&(n=l.TAG+n),n}async validateFunction(e,t,a,o,s){let n=null;try{let i=null;const l=await e.validateFunction(e,t,o||a,(e=>{i=e}));(i||"string"==typeof l&&l||!1===l)&&(n=this._getMessage(e,i||l,s))}catch(i){n=this._getMessage(e,i.message,s)}return n}_getMessage(e,t,a){return $(e,t||e.errorMessage||this._message[a]||t.default)}_getValidateType(e){var t="";return e.required?t="required":e.format?t="format":e.arrayType?t="arrayTypeFormat":e.range?t="range":void 0!==e.maximum||void 0!==e.minimum?t="rangeNumber":void 0!==e.maxLength||void 0!==e.minLength?t="rangeLength":e.pattern?t="pattern":e.validateFunction&&(t="validateFunction"),t}}{constructor(e,t){super(A.message),this._schema=e,this._options=t||null}updateSchema(e){this._schema=e}async validate(e,t){let a=this._checkFieldInSchema(e);return a||(a=await this.invokeValidate(e,!1,t)),a.length?a[0]:null}async validateAll(e,t){let a=this._checkFieldInSchema(e);return a||(a=await this.invokeValidate(e,!0,t)),a}async validateUpdate(e,t){let a=this._checkFieldInSchema(e);return a||(a=await this.invokeValidateUpdate(e,!1,t)),a.length?a[0]:null}async invokeValidate(e,t,a){let o=[],s=this._schema;for(let n in s){let i=s[n],l=await this.validateRule(n,i,e[n],e,a);if(null!=l&&(o.push({key:n,errorMessage:l}),!t))break}return o}async invokeValidateUpdate(e,t,a){let o=[];for(let s in e){let n=await this.validateRule(s,this._schema[s],e[s],e,a);if(null!=n&&(o.push({key:s,errorMessage:n}),!t))break}return o}_checkFieldInSchema(e){var t=Object.keys(e),a=Object.keys(this._schema);if(new Set(t.concat(a)).size===a.length)return"";var o=t.filter((e=>a.indexOf(e)<0));return[{key:"invalid",errorMessage:$({field:JSON.stringify(o)},A.message.TAG+A.message.defaultInvalid)}]}}A.message=new function(){return{TAG:"",default:"验证错误",defaultInvalid:"提交的字段{field}在数据库中并不存在",validateFunction:"验证无效",required:"{label}必填",enum:"{label}超出范围",timestamp:"{label}格式无效",whitespace:"{label}不能为空",typeError:"{label}类型无效",date:{format:"{label}日期{value}格式无效",parse:"{label}日期无法解析,{value}无效",invalid:"{label}日期{value}无效"},length:{minLength:"{label}长度不能少于{minLength}",maxLength:"{label}长度不能超过{maxLength}",range:"{label}必须介于{minLength}和{maxLength}之间"},number:{minimum:"{label}不能小于{minimum}",maximum:"{label}不能大于{maximum}",exclusiveMinimum:"{label}不能小于等于{minimum}",exclusiveMaximum:"{label}不能大于等于{maximum}",range:"{label}必须介于{minimum}and{maximum}之间"},pattern:{mismatch:"{label}格式不匹配"}}};const j=(e,t,a)=>{const o=a.find((e=>{return e.format&&("int"===(t=e.format)||"double"===t||"number"===t||"timestamp"===t);var t})),s=a.find((e=>e.format&&"boolean"===e.format||"bool"===e.format));return o&&(t=t||0===t?W(Number(t))?Number(t):t:null),s&&(t=!!H(t)&&t),t},L=(e,t)=>U(t,e),z=(e,t={})=>{const a=q(e);if("object"==typeof a&&Array.isArray(a)&&a.length>1){return a.reduce(((e,t)=>e+`#${t}`),"_formdata_")}return a[0]||e},O=e=>{let t=e.replace("_formdata_#","");return t=t.split("#").map((e=>W(e)?Number(e):e)),t},R=(e,t,a)=>("object"!=typeof e||q(t).reduce(((e,t,o,s)=>o===s.length-1?(e[t]=a,null):(t in e||(e[t]=/^[0-9]{1,}$/.test(s[o+1])?[]:{}),e[t])),e),e);function q(e){return Array.isArray(e)?e:e.replace(/\[/g,".").replace(/\]/g,"").split(".")}const U=(e,t,a="undefined")=>{let o=q(t).reduce(((e,t)=>(e||{})[t]),e);return o&&void 0===o?a:o},W=e=>!isNaN(Number(e)),H=e=>"boolean"==typeof e;const G=s({name:"uniForms",emits:["validate","submit"],options:{virtualHost:!0},props:{value:{type:Object,default:()=>null},modelValue:{type:Object,default:()=>null},model:{type:Object,default:()=>null},rules:{type:Object,default:()=>({})},errShowType:{type:String,default:"undertext"},validateTrigger:{type:String,default:"submit"},labelPosition:{type:String,default:"left"},labelWidth:{type:[String,Number],default:""},labelAlign:{type:String,default:"left"},border:{type:Boolean,default:!1}},provide(){return{uniForm:this}},data:()=>({formData:{},formRules:{}}),computed:{localData(){const e=this.model||this.modelValue||this.value;return e?(t=e,JSON.parse(JSON.stringify(t))):{};var t}},watch:{rules:{handler:function(e,t){this.setRules(e)},deep:!0,immediate:!0}},created(){getApp().$vm.$.appContext.config.globalProperties.binddata||(getApp().$vm.$.appContext.config.globalProperties.binddata=function(e,a,o){if(o)this.$refs[o].setValue(e,a);else{let o;for(let e in this.$refs){const t=this.$refs[e];if(t&&t.$options&&"uniForms"===t.$options.name){o=t;break}}if(!o)return t("error","at uni_modules/uni-forms/components/uni-forms/uni-forms.vue:182","当前 uni-froms 组件缺少 ref 属性");o.setValue(e,a)}}),this.childrens=[],this.inputChildrens=[],this.setRules(this.rules)},methods:{setRules(e){this.formRules=Object.assign({},this.formRules,e),this.validator=new A(e)},setValue(e,t){let a=this.childrens.find((t=>t.name===e));return a?(this.formData[e]=j(0,t,this.formRules[e]&&this.formRules[e].rules||[]),a.onFieldChange(this.formData[e])):null},validate(e,t){return this.checkAll(this.formData,e,t)},validateField(e=[],t){e=[].concat(e);let a={};return this.childrens.forEach((t=>{const o=z(t.name);-1!==e.indexOf(o)&&(a=Object.assign({},a,{[o]:this.formData[o]}))})),this.checkAll(a,[],t)},clearValidate(e=[]){e=[].concat(e),this.childrens.forEach((t=>{if(0===e.length)t.errMsg="";else{const a=z(t.name);-1!==e.indexOf(a)&&(t.errMsg="")}}))},submit(e,a,o){for(let t in this.dataValue){this.childrens.find((e=>e.name===t))&&void 0===this.formData[t]&&(this.formData[t]=this._getValue(t,this.dataValue[t]))}return o||t("warn","at uni_modules/uni-forms/components/uni-forms/uni-forms.vue:289","submit 方法即将废弃，请使用validate方法代替！"),this.checkAll(this.formData,e,a,"submit")},async checkAll(e,t,a,o){if(!this.validator)return;let s,n=[];for(let c in e){const e=this.childrens.find((e=>z(e.name)===c));e&&n.push(e)}a||"function"!=typeof t||(a=t),!a&&"function"!=typeof a&&Promise&&(s=new Promise(((e,t)=>{a=function(a,o){a?t(a):e(o)}})));let i=[],l=JSON.parse(JSON.stringify(e));for(let c in n){const e=n[c];let t=z(e.name);const a=await e.onFieldChange(l[t]);if(a&&(i.push(a),"toast"===this.errShowType||"modal"===this.errShowType))break}Array.isArray(i)&&0===i.length&&(i=null),Array.isArray(t)&&t.forEach((e=>{let t=z(e),a=L(e,this.localData);void 0!==a&&(l[t]=a)})),"submit"===o?this.$emit("submit",{detail:{value:l,errors:i}}):this.$emit("validate",i);let r={};return r=((e={},t)=>{let a=JSON.parse(JSON.stringify(e)),o={};for(let s in a){let e=O(s);R(o,e,a[s])}return o})(l,this.name),a&&"function"==typeof a&&a(i,r),s&&a?s:null},validateCheck(e){this.$emit("validate",e)},_getValue:j,_isRequiredField:e=>{let t=!1;for(let a=0;a<e.length;a++){if(e[a].required){t=!0;break}}return t},_setDataValue:(e,t,a)=>(t[e]=a,a||""),_getDataValue:L,_realName:z,_isRealName:e=>/^_formdata_#*/.test(e),_isEqual:(e,t)=>{if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;var a=toString.call(e);if(a!==toString.call(t))return!1;switch(a){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t}if("[object Object]"==a){var o=Object.getOwnPropertyNames(e),s=Object.getOwnPropertyNames(t);if(o.length!=s.length)return!1;for(var n=0;n<o.length;n++){var i=o[n];if(e[i]!==t[i])return!1}return!0}return"[object Array]"==a?e.toString()==t.toString():void 0}}},[["render",function(t,a,o,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:"uni-forms"},[e.createElementVNode("form",null,[e.renderSlot(t.$slots,"default",{},void 0,!0)])])}],["__scopeId","data-v-bdc00db0"]]);
=======
if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){const t=this.constructor;return this.then((a=>t.resolve(e()).then((()=>a))),(a=>t.resolve(e()).then((()=>{throw a}))))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const e=uni.requireGlobal();ArrayBuffer=e.ArrayBuffer,Int8Array=e.Int8Array,Uint8Array=e.Uint8Array,Uint8ClampedArray=e.Uint8ClampedArray,Int16Array=e.Int16Array,Uint16Array=e.Uint16Array,Int32Array=e.Int32Array,Uint32Array=e.Uint32Array,Float32Array=e.Float32Array,Float64Array=e.Float64Array,BigInt64Array=e.BigInt64Array,BigUint64Array=e.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(e){"use strict";function t(e,t,...a){uni.__log__?uni.__log__(e,t,...a):console[e].apply(console,[...a,t])}function a(e,t){return"string"==typeof e?t:e}const o=(e,t)=>{const a=e.__vccOpts||e;for(const[o,s]of t)a[o]=s;return a};const s=o({props:{chat:{type:Object,required:!0},index:{type:Number,required:!0},active:{type:Boolean,default:!1}}},[["render",function(t,a,o,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:"chat-item"},[e.createElementVNode("image",{class:"avatar",src:o.chat.avatar},null,8,["src"]),e.createElementVNode("view",{class:"content"},[e.createElementVNode("view",{class:"top-line"},[e.createElementVNode("text",{class:"name"},e.toDisplayString(o.chat.chatName?`${o.chat.chatName} ${o.index}`:o.chat.members.map((e=>e.nickname)).join(", ")),1),e.createElementVNode("text",{class:"time"},e.toDisplayString(o.chat.createdAt),1)]),e.createElementVNode("view",{class:"bottom-line"},[e.createElementVNode("text",{class:"message"},e.toDisplayString(o.chat.lastMessage),1),o.chat.unreadCount>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"badge"},e.toDisplayString(o.chat.unreadCount),1)):e.createCommentVNode("",!0)])])])}],["__scopeId","data-v-757e980d"]]),n=[{font_class:"arrow-down",unicode:""},{font_class:"arrow-left",unicode:""},{font_class:"arrow-right",unicode:""},{font_class:"arrow-up",unicode:""},{font_class:"auth",unicode:""},{font_class:"auth-filled",unicode:""},{font_class:"back",unicode:""},{font_class:"bars",unicode:""},{font_class:"calendar",unicode:""},{font_class:"calendar-filled",unicode:""},{font_class:"camera",unicode:""},{font_class:"camera-filled",unicode:""},{font_class:"cart",unicode:""},{font_class:"cart-filled",unicode:""},{font_class:"chat",unicode:""},{font_class:"chat-filled",unicode:""},{font_class:"chatboxes",unicode:""},{font_class:"chatboxes-filled",unicode:""},{font_class:"chatbubble",unicode:""},{font_class:"chatbubble-filled",unicode:""},{font_class:"checkbox",unicode:""},{font_class:"checkbox-filled",unicode:""},{font_class:"checkmarkempty",unicode:""},{font_class:"circle",unicode:""},{font_class:"circle-filled",unicode:""},{font_class:"clear",unicode:""},{font_class:"close",unicode:""},{font_class:"closeempty",unicode:""},{font_class:"cloud-download",unicode:""},{font_class:"cloud-download-filled",unicode:""},{font_class:"cloud-upload",unicode:""},{font_class:"cloud-upload-filled",unicode:""},{font_class:"color",unicode:""},{font_class:"color-filled",unicode:""},{font_class:"compose",unicode:""},{font_class:"contact",unicode:""},{font_class:"contact-filled",unicode:""},{font_class:"down",unicode:""},{font_class:"bottom",unicode:""},{font_class:"download",unicode:""},{font_class:"download-filled",unicode:""},{font_class:"email",unicode:""},{font_class:"email-filled",unicode:""},{font_class:"eye",unicode:""},{font_class:"eye-filled",unicode:""},{font_class:"eye-slash",unicode:""},{font_class:"eye-slash-filled",unicode:""},{font_class:"fire",unicode:""},{font_class:"fire-filled",unicode:""},{font_class:"flag",unicode:""},{font_class:"flag-filled",unicode:""},{font_class:"folder-add",unicode:""},{font_class:"folder-add-filled",unicode:""},{font_class:"font",unicode:""},{font_class:"forward",unicode:""},{font_class:"gear",unicode:""},{font_class:"gear-filled",unicode:""},{font_class:"gift",unicode:""},{font_class:"gift-filled",unicode:""},{font_class:"hand-down",unicode:""},{font_class:"hand-down-filled",unicode:""},{font_class:"hand-up",unicode:""},{font_class:"hand-up-filled",unicode:""},{font_class:"headphones",unicode:""},{font_class:"heart",unicode:""},{font_class:"heart-filled",unicode:""},{font_class:"help",unicode:""},{font_class:"help-filled",unicode:""},{font_class:"home",unicode:""},{font_class:"home-filled",unicode:""},{font_class:"image",unicode:""},{font_class:"image-filled",unicode:""},{font_class:"images",unicode:""},{font_class:"images-filled",unicode:""},{font_class:"info",unicode:""},{font_class:"info-filled",unicode:""},{font_class:"left",unicode:""},{font_class:"link",unicode:""},{font_class:"list",unicode:""},{font_class:"location",unicode:""},{font_class:"location-filled",unicode:""},{font_class:"locked",unicode:""},{font_class:"locked-filled",unicode:""},{font_class:"loop",unicode:""},{font_class:"mail-open",unicode:""},{font_class:"mail-open-filled",unicode:""},{font_class:"map",unicode:""},{font_class:"map-filled",unicode:""},{font_class:"map-pin",unicode:""},{font_class:"map-pin-ellipse",unicode:""},{font_class:"medal",unicode:""},{font_class:"medal-filled",unicode:""},{font_class:"mic",unicode:""},{font_class:"mic-filled",unicode:""},{font_class:"micoff",unicode:""},{font_class:"micoff-filled",unicode:""},{font_class:"minus",unicode:""},{font_class:"minus-filled",unicode:""},{font_class:"more",unicode:""},{font_class:"more-filled",unicode:""},{font_class:"navigate",unicode:""},{font_class:"navigate-filled",unicode:""},{font_class:"notification",unicode:""},{font_class:"notification-filled",unicode:""},{font_class:"paperclip",unicode:""},{font_class:"paperplane",unicode:""},{font_class:"paperplane-filled",unicode:""},{font_class:"person",unicode:""},{font_class:"person-filled",unicode:""},{font_class:"personadd",unicode:""},{font_class:"personadd-filled",unicode:""},{font_class:"personadd-filled-copy",unicode:""},{font_class:"phone",unicode:""},{font_class:"phone-filled",unicode:""},{font_class:"plus",unicode:""},{font_class:"plus-filled",unicode:""},{font_class:"plusempty",unicode:""},{font_class:"pulldown",unicode:""},{font_class:"pyq",unicode:""},{font_class:"qq",unicode:""},{font_class:"redo",unicode:""},{font_class:"redo-filled",unicode:""},{font_class:"refresh",unicode:""},{font_class:"refresh-filled",unicode:""},{font_class:"refreshempty",unicode:""},{font_class:"reload",unicode:""},{font_class:"right",unicode:""},{font_class:"scan",unicode:""},{font_class:"search",unicode:""},{font_class:"settings",unicode:""},{font_class:"settings-filled",unicode:""},{font_class:"shop",unicode:""},{font_class:"shop-filled",unicode:""},{font_class:"smallcircle",unicode:""},{font_class:"smallcircle-filled",unicode:""},{font_class:"sound",unicode:""},{font_class:"sound-filled",unicode:""},{font_class:"spinner-cycle",unicode:""},{font_class:"staff",unicode:""},{font_class:"staff-filled",unicode:""},{font_class:"star",unicode:""},{font_class:"star-filled",unicode:""},{font_class:"starhalf",unicode:""},{font_class:"trash",unicode:""},{font_class:"trash-filled",unicode:""},{font_class:"tune",unicode:""},{font_class:"tune-filled",unicode:""},{font_class:"undo",unicode:""},{font_class:"undo-filled",unicode:""},{font_class:"up",unicode:""},{font_class:"top",unicode:""},{font_class:"upload",unicode:""},{font_class:"upload-filled",unicode:""},{font_class:"videocam",unicode:""},{font_class:"videocam-filled",unicode:""},{font_class:"vip",unicode:""},{font_class:"vip-filled",unicode:""},{font_class:"wallet",unicode:""},{font_class:"wallet-filled",unicode:""},{font_class:"weibo",unicode:""},{font_class:"weixin",unicode:""}];const i=o({name:"UniIcons",emits:["click"],props:{type:{type:String,default:""},color:{type:String,default:"#333333"},size:{type:[Number,String],default:16},customPrefix:{type:String,default:""},fontFamily:{type:String,default:""}},data:()=>({icons:n}),computed:{unicode(){let e=this.icons.find((e=>e.font_class===this.type));return e?e.unicode:""},iconSize(){return"number"==typeof(e=this.size)||/^[0-9]*$/g.test(e)?e+"px":e;var e},styleObj(){return""!==this.fontFamily?`color: ${this.color}; font-size: ${this.iconSize}; font-family: ${this.fontFamily};`:`color: ${this.color}; font-size: ${this.iconSize};`}},methods:{_onClick(){this.$emit("click")}}},[["render",function(t,a,o,s,n,i){return e.openBlock(),e.createElementBlock("text",{style:e.normalizeStyle(i.styleObj),class:e.normalizeClass(["uni-icons",["uniui-"+o.type,o.customPrefix,o.customPrefix?o.type:""]]),onClick:a[0]||(a[0]=(...e)=>i._onClick&&i._onClick(...e))},[e.renderSlot(t.$slots,"default",{},void 0,!0)],6)}],["__scopeId","data-v-1320ff52"]]);const l=o({props:{items:{type:Array,required:!0}},data:()=>({menuVisible:!1}),methods:{showMenu(){this.menuVisible=!0},hideMenu(){this.menuVisible=!1},onSelect(e){this.$emit("select",e),this.hideMenu()}}},[["render",function(t,o,s,n,l,r){const c=a(e.resolveDynamicComponent("uni-icons"),i);return e.openBlock(),e.createElementBlock("view",{class:"pop-menu",onLongpress:o[2]||(o[2]=(...e)=>r.showMenu&&r.showMenu(...e))},[e.renderSlot(t.$slots,"default",{},void 0,!0),l.menuVisible?(e.openBlock(),e.createElementBlock("view",{key:0,class:"menu-overlay",onClick:o[1]||(o[1]=(...e)=>r.hideMenu&&r.hideMenu(...e))},[e.createElementVNode("view",{class:"menu-content",onClick:o[0]||(o[0]=e.withModifiers((()=>{}),["stop"]))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.items,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"menu-item",style:e.normalizeStyle({color:t.color||"#333"}),onClick:e=>r.onSelect(t)},[e.createVNode(c,{type:t.icon,size:"16"},null,8,["type"]),e.createElementVNode("text",null,e.toDisplayString(t.name),1)],12,["onClick"])))),128))])])):e.createCommentVNode("",!0)],32)}],["__scopeId","data-v-f7a26938"]]);const r=o({data:()=>({searchText:"",loading:!1,chats:[],menu:{show:!1,style:"",chatIdx:-1,isTouchMove:!1,items:[{key:"DELETE",name:"删除该聊天",icon:"trash",color:"#e64e4e"},{key:"TOP",name:"置顶该聊天",icon:"arrow-up"}]}}),methods:{navigateToChatRoom(e){e&&uni.navigateTo({url:`/pages/tabBar/chats/chat-room?chatId=${e.id}&actionType=${e.type}`})},async fetchChats(){const e=await new Promise(((e,t)=>{uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/chat",method:"GET",header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")},success:t=>e(t),fail:e=>t(e)})}));return t("log","at pages/tabBar/chats/chats.vue:93",e.data),"Unauthorized"===e.data&&uni.showModal({title:"GalChat",content:"欢迎使用GalChat，请先登录",showCancel:!1,success:()=>{uni.redirectTo({url:"/pages/log/log/log"})}}),e.data},onSelectMenu(e,t){switch(e.key){case"DELETE":this.removeChat(t);break;case"TOP":this.moveToTop(t)}this.menu.show=!1},removeChat(e){this.chats[e].delete=!0},moveToTop(e){const t=this.chats[e];this.chats.splice(e,1),this.chats.unshift(t)},isShowChat(e){return!e.delete&&(!this.searchText||e.showName.includes(this.searchText))},refreshUnreadBadge(){this.unreadCount>0?uni.setTabBarBadge({index:0,text:this.unreadCount+""}):uni.removeTabBarBadge({index:0,complete:()=>{}})}},computed:{unreadCount(){let e=0;return this.chats.forEach((t=>{t.delete||(e+=t.unreadCount)})),e}},watch:{unreadCount(e,t){this.refreshUnreadBadge()}},async onShow(){this.refreshUnreadBadge(),this.loading=!0,t("log","at pages/tabBar/chats/chats.vue:170","asdasdasd");const e=await this.fetchChats();this.loading=!1,this.chats=e.value,t("log","at pages/tabBar/chats/chats.vue:175",e)}},[["render",function(t,o,n,i,r,c){const u=a(e.resolveDynamicComponent("chat-item"),s),d=a(e.resolveDynamicComponent("pop-menu"),l);return e.openBlock(),e.createElementBlock("view",{class:"tab-page"},[r.loading?(e.openBlock(),e.createElementBlock("view",{key:0,class:"chat-loading"},[e.createElementVNode("view",{size:50,mask:!1},[e.createElementVNode("view",null,"消息接收中...")])])):e.createCommentVNode("",!0),r.loading||0!=r.chats.length?(e.openBlock(),e.createElementBlock("scroll-view",{key:2,class:"scroll-bar","scroll-with-animation":"true","scroll-y":"true"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.chats,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a},[c.isShowChat(t)?(e.openBlock(),e.createBlock(d,{key:0,items:r.menu.items,onSelect:e=>c.onSelectMenu(e,a)},{default:e.withCtx((()=>[e.createVNode(u,{chat:t,index:a,active:r.menu.chatIdx==a,clickable:"",onClick:e=>c.navigateToChatRoom(t)},null,8,["chat","index","active","onClick"])])),_:2},1032,["items","onSelect"])):e.createCommentVNode("",!0)])))),128))])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"chat-tip"}," 温馨提示：您现在还没有任何聊天消息，快跟您的好友发起聊天吧~ "))])}],["__scopeId","data-v-fc7d6f29"]]);const c=o({name:"UniBadge",emits:["click"],props:{type:{type:String,default:"error"},inverted:{type:Boolean,default:!1},isDot:{type:Boolean,default:!1},maxNum:{type:Number,default:99},absolute:{type:String,default:""},offset:{type:Array,default:()=>[0,0]},text:{type:[String,Number],default:""},size:{type:String,default:"small"},customStyle:{type:Object,default:()=>({})}},data:()=>({}),computed:{width(){return 8*String(this.text).length+12},classNames(){const{inverted:e,type:t,size:a,absolute:o}=this;return[e?"uni-badge--"+t+"-inverted":"","uni-badge--"+t,"uni-badge--"+a,o?"uni-badge--absolute":""].join(" ")},positionStyle(){if(!this.absolute)return{};let e=this.width/2,t=10;this.isDot&&(e=5,t=5);const a=`${-e+this.offset[0]}px`,o=`${-t+this.offset[1]}px`,s={rightTop:{right:a,top:o},rightBottom:{right:a,bottom:o},leftBottom:{left:a,bottom:o},leftTop:{left:a,top:o}},n=s[this.absolute];return n||s.rightTop},dotStyle(){return this.isDot?{width:"10px",minWidth:"0",height:"10px",padding:"0",borderRadius:"10px"}:{}},displayValue(){const{isDot:e,text:t,maxNum:a}=this;return e?"":Number(t)>a?`${a}+`:t}},methods:{onClick(){this.$emit("click")}}},[["render",function(t,a,o,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:"uni-badge--x"},[e.renderSlot(t.$slots,"default",{},void 0,!0),o.text?(e.openBlock(),e.createElementBlock("text",{key:0,class:e.normalizeClass([i.classNames,"uni-badge"]),style:e.normalizeStyle([i.positionStyle,o.customStyle,i.dotStyle]),onClick:a[0]||(a[0]=e=>i.onClick())},e.toDisplayString(i.displayValue),7)):e.createCommentVNode("",!0)])}],["__scopeId","data-v-077a76df"]]);const u=o({name:"UniListItem",emits:["click","switchChange"],props:{direction:{type:String,default:"row"},title:{type:String,default:""},note:{type:String,default:""},ellipsis:{type:[Number,String],default:0},disabled:{type:[Boolean,String],default:!1},clickable:{type:Boolean,default:!1},showArrow:{type:[Boolean,String],default:!1},link:{type:[Boolean,String],default:!1},to:{type:String,default:""},showBadge:{type:[Boolean,String],default:!1},showSwitch:{type:[Boolean,String],default:!1},switchChecked:{type:[Boolean,String],default:!1},badgeText:{type:String,default:""},badgeType:{type:String,default:"success"},badgeStyle:{type:Object,default:()=>({})},rightText:{type:String,default:""},thumb:{type:String,default:""},thumbSize:{type:String,default:"base"},showExtraIcon:{type:[Boolean,String],default:!1},extraIcon:{type:Object,default:()=>({type:"",color:"#000000",size:20,customPrefix:""})},border:{type:Boolean,default:!0},customStyle:{type:Object,default:()=>({padding:"",backgroundColor:"#FFFFFF"})},keepScrollPosition:{type:Boolean,default:!1}},watch:{"customStyle.padding":{handler(e){"number"==typeof e&&(e+="");let t=e.split(" ");if(1===t.length){const e=t[0];this.padding={top:e,right:e,bottom:e,left:e}}else if(2===t.length){const[e,a]=t;this.padding={top:e,right:a,bottom:e,left:a}}else if(4===t.length){const[e,a,o,s]=t;this.padding={top:e,right:a,bottom:o,left:s}}},immediate:!0}},data:()=>({isFirstChild:!1,padding:{top:"",right:"",bottom:"",left:""}}),mounted(){this.list=this.getForm(),this.list&&(this.list.firstChildAppend||(this.list.firstChildAppend=!0,this.isFirstChild=!0))},methods:{getForm(e="uniList"){let t=this.$parent,a=t.$options.name;for(;a!==e;){if(t=t.$parent,!t)return!1;a=t.$options.name}return t},onClick(){""===this.to?(this.clickable||this.link)&&this.$emit("click",{data:{}}):this.openPage()},onSwitchChange(e){this.$emit("switchChange",e.detail)},openPage(){-1!==["navigateTo","redirectTo","reLaunch","switchTab"].indexOf(this.link)?this.pageApi(this.link):this.pageApi("navigateTo")},pageApi(e){let t={url:this.to,success:e=>{this.$emit("click",{data:e})},fail:e=>{this.$emit("click",{data:e})}};switch(e){case"navigateTo":default:uni.navigateTo(t);break;case"redirectTo":uni.redirectTo(t);break;case"reLaunch":uni.reLaunch(t);break;case"switchTab":uni.switchTab(t)}}}},[["render",function(t,o,s,n,l,r){const u=a(e.resolveDynamicComponent("uni-icons"),i),d=a(e.resolveDynamicComponent("uni-badge"),c);return e.openBlock(),e.createElementBlock("view",{class:e.normalizeClass([{"uni-list-item--disabled":s.disabled},"uni-list-item"]),style:e.normalizeStyle({"background-color":s.customStyle.backgroundColor}),"hover-class":!s.clickable&&!s.link||s.disabled||s.showSwitch?"":"uni-list-item--hover",onClick:o[1]||(o[1]=(...e)=>r.onClick&&r.onClick(...e))},[l.isFirstChild?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:0,class:e.normalizeClass(["border--left",{"uni-list--border":s.border}])},null,2)),e.createElementVNode("view",{class:e.normalizeClass(["uni-list-item__container",{"container--right":s.showArrow||s.link,"flex--direction":"column"===s.direction}]),style:e.normalizeStyle({paddingTop:l.padding.top,paddingLeft:l.padding.left,paddingRight:l.padding.right,paddingBottom:l.padding.bottom})},[e.renderSlot(t.$slots,"header",{},(()=>[e.createElementVNode("view",{class:"uni-list-item__header"},[s.thumb?(e.openBlock(),e.createElementBlock("view",{key:0,class:"uni-list-item__icon"},[e.createElementVNode("image",{src:s.thumb,class:e.normalizeClass(["uni-list-item__icon-img",["uni-list--"+s.thumbSize]])},null,10,["src"])])):s.showExtraIcon?(e.openBlock(),e.createElementBlock("view",{key:1,class:"uni-list-item__icon"},[e.createVNode(u,{customPrefix:s.extraIcon.customPrefix,color:s.extraIcon.color,size:s.extraIcon.size,type:s.extraIcon.type},null,8,["customPrefix","color","size","type"])])):e.createCommentVNode("",!0)])]),!0),e.renderSlot(t.$slots,"body",{},(()=>[e.createElementVNode("view",{class:e.normalizeClass(["uni-list-item__content",{"uni-list-item__content--center":s.thumb||s.showExtraIcon||s.showBadge||s.showSwitch}])},[s.title?(e.openBlock(),e.createElementBlock("text",{key:0,class:e.normalizeClass(["uni-list-item__content-title",[0!==s.ellipsis&&s.ellipsis<=2?"uni-ellipsis-"+s.ellipsis:""]])},e.toDisplayString(s.title),3)):e.createCommentVNode("",!0),s.note?(e.openBlock(),e.createElementBlock("text",{key:1,class:"uni-list-item__content-note"},e.toDisplayString(s.note),1)):e.createCommentVNode("",!0)],2)]),!0),e.renderSlot(t.$slots,"footer",{},(()=>[s.rightText||s.showBadge||s.showSwitch?(e.openBlock(),e.createElementBlock("view",{key:0,class:e.normalizeClass(["uni-list-item__extra",{"flex--justify":"column"===s.direction}])},[s.rightText?(e.openBlock(),e.createElementBlock("text",{key:0,class:"uni-list-item__extra-text"},e.toDisplayString(s.rightText),1)):e.createCommentVNode("",!0),s.showBadge?(e.openBlock(),e.createBlock(d,{key:1,type:s.badgeType,text:s.badgeText,"custom-style":s.badgeStyle},null,8,["type","text","custom-style"])):e.createCommentVNode("",!0),s.showSwitch?(e.openBlock(),e.createElementBlock("switch",{key:2,disabled:s.disabled,checked:s.switchChecked,onChange:o[0]||(o[0]=(...e)=>r.onSwitchChange&&r.onSwitchChange(...e))},null,40,["disabled","checked"])):e.createCommentVNode("",!0)],2)):e.createCommentVNode("",!0)]),!0)],6),s.showArrow||s.link?(e.openBlock(),e.createBlock(u,{key:1,size:16,class:"uni-icon-wrapper",color:"#bbb",type:"arrowright"})):e.createCommentVNode("",!0)],14,["hover-class"])}],["__scopeId","data-v-81f254b4"]]);const d=o({name:"uniList","mp-weixin":{options:{multipleSlots:!1}},props:{stackFromEnd:{type:Boolean,default:!1},enableBackToTop:{type:[Boolean,String],default:!1},scrollY:{type:[Boolean,String],default:!1},border:{type:Boolean,default:!0},renderReverse:{type:Boolean,default:!1}},created(){this.firstChildAppend=!1},methods:{loadMore(e){this.$emit("scrolltolower")},scroll(e){this.$emit("scroll",e)}}},[["render",function(t,a,o,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:"uni-list uni-border-top-bottom"},[o.border?(e.openBlock(),e.createElementBlock("view",{key:0,class:"uni-list--border-top"})):e.createCommentVNode("",!0),e.renderSlot(t.$slots,"default",{},void 0,!0),o.border?(e.openBlock(),e.createElementBlock("view",{key:1,class:"uni-list--border-bottom"})):e.createCommentVNode("",!0)])}],["__scopeId","data-v-1f7cd97b"]]);const m=o({data:()=>({listData:[{title:"新的虚拟朋友",thumb:"/static/logo.png",url:"/pages/tabBar/contacts/newVirtualFriend"},{title:"新的真实朋友",thumb:"/static/logo.png",url:"/pages/tabBar/contacts/newRealFriend"},{title:"我的AI",thumb:"/static/logo.png",url:"/pages/tabBar/ai/contacts"}],friendData:[]}),async onShow(){try{const e=(await new Promise(((e,t)=>{uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/contacts",method:"GET",header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")},success:t=>e(t),fail:e=>t(e)})}))).data;this.friendData=e.value,t("log","at pages/tabBar/contacts/contacts.vue:76",this.friendData)}catch(e){uni.showModal({title:"错误",content:"获取用户信息失败，请重新登录",showCancel:!1,success:()=>{uni.redirectTo({url:"/pages/log/log/log"})}})}},methods:{navigateTo(e){uni.navigateTo({url:e})},navigateToFriend(e){const a=e.contactprofile,o=a.calendar??"";t("log","at pages/tabBar/contacts/contacts.vue:105",a),uni.navigateTo({url:`/pages/detail/frienddetail?chatId=${e.chatId}&username=${a.username}&id=${a.id}&mood=${a.mood}&nickname=${a.nickname}&status=${a.status}&calendar=${o}`})}}},[["render",function(t,o,s,n,i,l){const r=a(e.resolveDynamicComponent("uni-list-item"),u),c=a(e.resolveDynamicComponent("uni-list"),d);return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",null,[e.createVNode(c,null,{default:e.withCtx((()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.listData,((t,a)=>(e.openBlock(),e.createBlock(r,{key:a,title:t.title,thumb:t.thumb,clickable:"",onClick:e=>l.navigateTo(t.url)},null,8,["title","thumb","onClick"])))),128))])),_:1})]),e.createElementVNode("view",null,[e.createVNode(c,null,{default:e.withCtx((()=>[e.createVNode(r,{title:"我的好友",customStyle:{backgroundColor:"#f5f5f5"}}),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.friendData,((t,a)=>(e.openBlock(),e.createBlock(r,{key:a,title:t.contactprofile.username,thumb:"/static/head.png",clickable:"",onClick:e=>l.navigateToFriend(t)},null,8,["title","onClick"])))),128))])),_:1})])])}]]),h="/static/head.png";const p=o({name:"ProfilePage",data:()=>({id:uni.getStorageSync("id")??"",nickname:uni.getStorageSync("nickname")??"",username:uni.getStorageSync("username")??"",mood:uni.getStorageSync("mood")??"",status:uni.getStorageSync("status")??"",calendar:""}),async onShow(){try{const e=(await new Promise(((e,t)=>{uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/profile",method:"GET",header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")},success:t=>e(t),fail:e=>t(e)})}))).data;this.id=e.value.id,this.nickname=e.value.nickname,this.username=e.value.username,this.mood=e.value.mood??"添加心情",this.status=e.value.status??"添加状态",t("log","at pages/tabBar/me/me.vue:73",e.value.calendar),this.calendar=e.value.calendar??"",t("log","at pages/tabBar/me/me.vue:75",this.calendar),""===this.calendar?this.calendar="":this.calendar=this.calendar.content,t("log","at pages/tabBar/me/me.vue:82",this.calendar),t("log","at pages/tabBar/me/me.vue:83",uni.getStorageSync("cal")),uni.setStorageSync("id",this.id),uni.setStorageSync("nickname",this.nickname),uni.setStorageSync("username",this.username),uni.setStorageSync("mood",this.mood),uni.setStorageSync("status",this.status),uni.setStorageSync("cal",this.calendar)}catch(e){uni.showModal({title:"错误",content:"获取用户信息失败，请重新登录",showCancel:!1,success:()=>{uni.redirectTo({url:"/pages/log/log/log"})}})}},methods:{onMoodTap(){uni.navigateTo({url:"/pages/accountsetting/setmood"})},onStatusTap(){uni.navigateTo({url:"/pages/accountsetting/setstatus"})},onAccountSettingTap(){uni.navigateTo({url:"/pages/tabBar/me/accountSetting"})},onScheduleTap(){uni.navigateTo({url:"/pages/accountsetting/setcal"})},onPicturesTap(){uni.showToast({title:"Tapped on My pictures",icon:"none"})},onPrivacyTap(){uni.showToast({title:"Tapped on Privacy management",icon:"none"})},onLogoutTap(){uni.removeStorageSync("token"),uni.removeStorageSync("refresh"),uni.redirectTo({url:"/pages/log/log/log"})}}},[["render",function(t,a,o,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"top-section"},[e.createElementVNode("view",{class:"head-sculpture"},[e.createElementVNode("image",{src:h})]),e.createElementVNode("view",{class:"right-section"},[e.createElementVNode("view",{class:"nickname"}," 昵称："+e.toDisplayString(n.nickname),1),e.createElementVNode("view",{class:"username"}," 用户名："+e.toDisplayString(n.username),1)])]),e.createElementVNode("view",{class:"middle-section"},[e.createElementVNode("button",{class:"mood",onClick:a[0]||(a[0]=(...e)=>i.onMoodTap&&i.onMoodTap(...e))},e.toDisplayString(n.mood),1),e.createElementVNode("button",{class:"status",onClick:a[1]||(a[1]=(...e)=>i.onStatusTap&&i.onStatusTap(...e))},e.toDisplayString(n.status),1)]),e.createElementVNode("view",{class:"settings-section"},[e.createElementVNode("button",{class:"setting-item",onClick:a[2]||(a[2]=(...e)=>i.onAccountSettingTap&&i.onAccountSettingTap(...e))},"账号设置"),e.createElementVNode("button",{class:"setting-item",onClick:a[3]||(a[3]=(...e)=>i.onScheduleTap&&i.onScheduleTap(...e))},"我的日程")]),e.createElementVNode("view",{class:"logout-section"},[e.createElementVNode("button",{class:"logout-button",onClick:a[4]||(a[4]=(...e)=>i.onLogoutTap&&i.onLogoutTap(...e))},"登出")])])}],["__scopeId","data-v-20c5f3ed"]]);const g=o({name:"HomePage",methods:{goToLogin(){uni.navigateTo({url:"/pages/log/login/login"})},goToRegister(){uni.navigateTo({url:"/pages/log/register/register"})}}},[["render",function(t,a,o,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"button-section"},[e.createElementVNode("button",{class:"login-button",onClick:a[0]||(a[0]=(...e)=>i.goToLogin&&i.goToLogin(...e))},"登录"),e.createElementVNode("button",{class:"register-button",onClick:a[1]||(a[1]=(...e)=>i.goToRegister&&i.goToRegister(...e))},"注册")])])}],["__scopeId","data-v-13e2317b"]]);function f(e){let t="";for(let a in e){t+=`${a}:${e[a]};`}return t}const y=o({name:"uni-easyinput",emits:["click","iconClick","update:modelValue","input","focus","blur","confirm","clear","eyes","change","keyboardheightchange"],model:{prop:"modelValue",event:"update:modelValue"},options:{virtualHost:!0},inject:{form:{from:"uniForm",default:null},formItem:{from:"uniFormItem",default:null}},props:{name:String,value:[Number,String],modelValue:[Number,String],type:{type:String,default:"text"},clearable:{type:Boolean,default:!0},autoHeight:{type:Boolean,default:!1},placeholder:{type:String,default:" "},placeholderStyle:String,focus:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},maxlength:{type:[Number,String],default:140},confirmType:{type:String,default:"done"},clearSize:{type:[Number,String],default:24},inputBorder:{type:Boolean,default:!0},prefixIcon:{type:String,default:""},suffixIcon:{type:String,default:""},trim:{type:[Boolean,String],default:!1},cursorSpacing:{type:Number,default:0},passwordIcon:{type:Boolean,default:!0},adjustPosition:{type:Boolean,default:!0},primaryColor:{type:String,default:"#2979ff"},styles:{type:Object,default:()=>({color:"#333",backgroundColor:"#fff",disableColor:"#F7F6F6",borderColor:"#e5e5e5"})},errorMessage:{type:[String,Boolean],default:""}},data:()=>({focused:!1,val:"",showMsg:"",border:!1,isFirstBorder:!1,showClearIcon:!1,showPassword:!1,focusShow:!1,localMsg:"",isEnter:!1}),computed:{isVal(){const e=this.val;return!(!e&&0!==e)},msg(){return this.localMsg||this.errorMessage},inputMaxlength(){return Number(this.maxlength)},boxStyle(){return`color:${this.inputBorder&&this.msg?"#e43d33":this.styles.color};`},inputContentClass(){return function(e){let t="";for(let a in e)e[a]&&(t+=`${a} `);return t}({"is-input-border":this.inputBorder,"is-input-error-border":this.inputBorder&&this.msg,"is-textarea":"textarea"===this.type,"is-disabled":this.disabled,"is-focused":this.focusShow})},inputContentStyle(){const e=this.focusShow?this.primaryColor:this.styles.borderColor;return f({"border-color":(this.inputBorder&&this.msg?"#dd524d":e)||"#e5e5e5","background-color":this.disabled?this.styles.disableColor:this.styles.backgroundColor})},inputStyle(){return f({"padding-right":"password"===this.type||this.clearable||this.prefixIcon?"":"10px","padding-left":this.prefixIcon?"":"10px"})}},watch:{value(e){this.val=e},modelValue(e){this.val=e},focus(e){this.$nextTick((()=>{this.focused=this.focus,this.focusShow=this.focus}))}},created(){this.init(),this.form&&this.formItem&&this.$watch("formItem.errMsg",(e=>{this.localMsg=e}))},mounted(){this.$nextTick((()=>{this.focused=this.focus,this.focusShow=this.focus}))},methods:{init(){this.value||0===this.value?this.val=this.value:this.modelValue||0===this.modelValue||""===this.modelValue?this.val=this.modelValue:this.val=null},onClickIcon(e){this.$emit("iconClick",e)},onEyes(){this.showPassword=!this.showPassword,this.$emit("eyes",this.showPassword)},onInput(e){let t=e.detail.value;this.trim&&("boolean"==typeof this.trim&&this.trim&&(t=this.trimStr(t)),"string"==typeof this.trim&&(t=this.trimStr(t,this.trim))),this.errMsg&&(this.errMsg=""),this.val=t,this.$emit("input",t),this.$emit("update:modelValue",t)},onFocus(){this.$nextTick((()=>{this.focused=!0})),this.$emit("focus",null)},_Focus(e){this.focusShow=!0,this.$emit("focus",e)},onBlur(){this.focused=!1,this.$emit("blur",null)},_Blur(e){if(e.detail.value,this.focusShow=!1,this.$emit("blur",e),!1===this.isEnter&&this.$emit("change",this.val),this.form&&this.formItem){const{validateTrigger:e}=this.form;"blur"===e&&this.formItem.onFieldChange()}},onConfirm(e){this.$emit("confirm",this.val),this.isEnter=!0,this.$emit("change",this.val),this.$nextTick((()=>{this.isEnter=!1}))},onClear(e){this.val="",this.$emit("input",""),this.$emit("update:modelValue",""),this.$emit("clear")},onkeyboardheightchange(e){this.$emit("keyboardheightchange",e)},trimStr:(e,t="both")=>"both"===t?e.trim():"left"===t?e.trimLeft():"right"===t?e.trimRight():"start"===t?e.trimStart():"end"===t?e.trimEnd():"all"===t?e.replace(/\s+/g,""):e}},[["render",function(t,o,s,n,l,r){const c=a(e.resolveDynamicComponent("uni-icons"),i);return e.openBlock(),e.createElementBlock("view",{class:e.normalizeClass(["uni-easyinput",{"uni-easyinput-error":r.msg}]),style:e.normalizeStyle(r.boxStyle)},[e.createElementVNode("view",{class:e.normalizeClass(["uni-easyinput__content",r.inputContentClass]),style:e.normalizeStyle(r.inputContentStyle)},[s.prefixIcon?(e.openBlock(),e.createBlock(c,{key:0,class:"content-clear-icon",type:s.prefixIcon,color:"#c0c4cc",onClick:o[0]||(o[0]=e=>r.onClickIcon("prefix")),size:"22"},null,8,["type"])):e.createCommentVNode("",!0),e.renderSlot(t.$slots,"left",{},void 0,!0),"textarea"===s.type?(e.openBlock(),e.createElementBlock("textarea",{key:1,class:e.normalizeClass(["uni-easyinput__content-textarea",{"input-padding":s.inputBorder}]),name:s.name,value:l.val,placeholder:s.placeholder,placeholderStyle:s.placeholderStyle,disabled:s.disabled,"placeholder-class":"uni-easyinput__placeholder-class",maxlength:r.inputMaxlength,focus:l.focused,autoHeight:s.autoHeight,"cursor-spacing":s.cursorSpacing,"adjust-position":s.adjustPosition,onInput:o[1]||(o[1]=(...e)=>r.onInput&&r.onInput(...e)),onBlur:o[2]||(o[2]=(...e)=>r._Blur&&r._Blur(...e)),onFocus:o[3]||(o[3]=(...e)=>r._Focus&&r._Focus(...e)),onConfirm:o[4]||(o[4]=(...e)=>r.onConfirm&&r.onConfirm(...e)),onKeyboardheightchange:o[5]||(o[5]=(...e)=>r.onkeyboardheightchange&&r.onkeyboardheightchange(...e))},null,42,["name","value","placeholder","placeholderStyle","disabled","maxlength","focus","autoHeight","cursor-spacing","adjust-position"])):(e.openBlock(),e.createElementBlock("input",{key:2,type:"password"===s.type?"text":s.type,class:"uni-easyinput__content-input",style:e.normalizeStyle(r.inputStyle),name:s.name,value:l.val,password:!l.showPassword&&"password"===s.type,placeholder:s.placeholder,placeholderStyle:s.placeholderStyle,"placeholder-class":"uni-easyinput__placeholder-class",disabled:s.disabled,maxlength:r.inputMaxlength,focus:l.focused,confirmType:s.confirmType,"cursor-spacing":s.cursorSpacing,"adjust-position":s.adjustPosition,onFocus:o[6]||(o[6]=(...e)=>r._Focus&&r._Focus(...e)),onBlur:o[7]||(o[7]=(...e)=>r._Blur&&r._Blur(...e)),onInput:o[8]||(o[8]=(...e)=>r.onInput&&r.onInput(...e)),onConfirm:o[9]||(o[9]=(...e)=>r.onConfirm&&r.onConfirm(...e)),onKeyboardheightchange:o[10]||(o[10]=(...e)=>r.onkeyboardheightchange&&r.onkeyboardheightchange(...e))},null,44,["type","name","value","password","placeholder","placeholderStyle","disabled","maxlength","focus","confirmType","cursor-spacing","adjust-position"])),"password"===s.type&&s.passwordIcon?(e.openBlock(),e.createElementBlock(e.Fragment,{key:3},[r.isVal?(e.openBlock(),e.createBlock(c,{key:0,class:e.normalizeClass(["content-clear-icon",{"is-textarea-icon":"textarea"===s.type}]),type:l.showPassword?"eye-slash-filled":"eye-filled",size:22,color:l.focusShow?s.primaryColor:"#c0c4cc",onClick:r.onEyes},null,8,["class","type","color","onClick"])):e.createCommentVNode("",!0)],64)):e.createCommentVNode("",!0),s.suffixIcon?(e.openBlock(),e.createElementBlock(e.Fragment,{key:4},[s.suffixIcon?(e.openBlock(),e.createBlock(c,{key:0,class:"content-clear-icon",type:s.suffixIcon,color:"#c0c4cc",onClick:o[11]||(o[11]=e=>r.onClickIcon("suffix")),size:"22"},null,8,["type"])):e.createCommentVNode("",!0)],64)):(e.openBlock(),e.createElementBlock(e.Fragment,{key:5},[s.clearable&&r.isVal&&!s.disabled&&"textarea"!==s.type?(e.openBlock(),e.createBlock(c,{key:0,class:e.normalizeClass(["content-clear-icon",{"is-textarea-icon":"textarea"===s.type}]),type:"clear",size:s.clearSize,color:r.msg?"#dd524d":l.focusShow?s.primaryColor:"#c0c4cc",onClick:r.onClear},null,8,["class","size","color","onClick"])):e.createCommentVNode("",!0)],64)),e.renderSlot(t.$slots,"right",{},void 0,!0)],6)],6)}],["__scopeId","data-v-63e7b685"]]);const b=o({name:"uniFormsItem",options:{virtualHost:!0},provide(){return{uniFormItem:this}},inject:{form:{from:"uniForm",default:null}},props:{rules:{type:Array,default:()=>null},name:{type:[String,Array],default:""},required:{type:Boolean,default:!1},label:{type:String,default:""},labelWidth:{type:[String,Number],default:""},labelAlign:{type:String,default:""},errorMessage:{type:[String,Boolean],default:""},leftIcon:String,iconColor:{type:String,default:"#606266"}},data:()=>({errMsg:"",userRules:null,localLabelAlign:"left",localLabelWidth:"70px",localLabelPos:"left",border:!1,isFirstBorder:!1}),computed:{msg(){return this.errorMessage||this.errMsg}},watch:{"form.formRules"(e){this.init()},"form.labelWidth"(e){this.localLabelWidth=this._labelWidthUnit(e)},"form.labelPosition"(e){this.localLabelPos=this._labelPosition()},"form.labelAlign"(e){}},created(){this.init(!0),this.name&&this.form&&this.$watch((()=>this.form._getDataValue(this.name,this.form.localData)),((e,t)=>{if(!this.form._isEqual(e,t)){const t=this.itemSetValue(e);this.onFieldChange(t,!1)}}),{immediate:!1})},unmounted(){this.__isUnmounted=!0,this.unInit()},methods:{setRules(e=null){this.userRules=e,this.init(!1)},setValue(){},async onFieldChange(e,t=!0){const{formData:a,localData:o,errShowType:s,validateCheck:n,validateTrigger:i,_isRequiredField:l,_realName:r}=this.form,c=r(this.name);e||(e=this.form.formData[c]);const u=this.itemRules.rules&&this.itemRules.rules.length;if(!this.validator||!u||0===u)return;const d=l(this.itemRules.rules||[]);let m=null;return"bind"===i||t?(m=await this.validator.validateUpdate({[c]:e},a),d||void 0!==e&&""!==e||(m=null),m&&m.errorMessage?("undertext"===s&&(this.errMsg=m?m.errorMessage:""),"toast"===s&&uni.showToast({title:m.errorMessage||"校验错误",icon:"none"}),"modal"===s&&uni.showModal({title:"提示",content:m.errorMessage||"校验错误"})):this.errMsg="",n(m||null)):this.errMsg="",m||null},init(e=!1){const{validator:t,formRules:a,childrens:o,formData:s,localData:n,_realName:i,labelWidth:l,_getDataValue:r,_setDataValue:c}=this.form||{};if(this.localLabelAlign=this._justifyContent(),this.localLabelWidth=this._labelWidthUnit(l),this.localLabelPos=this._labelPosition(),this.form&&e&&o.push(this),!t||!a)return;this.form.isFirstBorder||(this.form.isFirstBorder=!0,this.isFirstBorder=!0),this.group&&(this.group.isFirstBorder||(this.group.isFirstBorder=!0,this.isFirstBorder=!0)),this.border=this.form.border;const u=i(this.name),d=this.userRules||this.rules;"object"==typeof a&&d&&(a[u]={rules:d},t.updateSchema(a));const m=a[u]||{};this.itemRules=m,this.validator=t,this.itemSetValue(r(this.name,n))},unInit(){if(this.form){const{childrens:e,formData:t,_realName:a}=this.form;e.forEach(((e,o)=>{e===this&&(this.form.childrens.splice(o,1),delete t[a(e.name)])}))}},itemSetValue(e){const t=this.form._realName(this.name),a=this.itemRules.rules||[],o=this.form._getValue(t,e,a);return this.form._setDataValue(t,this.form.formData,o),o},clearValidate(){this.errMsg=""},_isRequired(){return this.required},_justifyContent(){if(this.form){const{labelAlign:e}=this.form;let t=this.labelAlign?this.labelAlign:e;if("left"===t)return"flex-start";if("center"===t)return"center";if("right"===t)return"flex-end"}return"flex-start"},_labelWidthUnit(e){return this.num2px(this.labelWidth?this.labelWidth:e||(this.label?70:"auto"))},_labelPosition(){return this.form&&this.form.labelPosition||"left"},isTrigger:(e,t,a)=>"submit"!==e&&e?"bind":void 0===e?"bind"!==t?t?"submit":""===a?"bind":"submit":"bind":"submit",num2px:e=>"number"==typeof e?`${e}px`:e}},[["render",function(t,a,o,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:e.normalizeClass(["uni-forms-item",["is-direction-"+n.localLabelPos,n.border?"uni-forms-item--border":"",n.border&&n.isFirstBorder?"is-first-border":""]])},[e.renderSlot(t.$slots,"label",{},(()=>[e.createElementVNode("view",{class:e.normalizeClass(["uni-forms-item__label",{"no-label":!o.label&&!o.required}]),style:e.normalizeStyle({width:n.localLabelWidth,justifyContent:n.localLabelAlign})},[o.required?(e.openBlock(),e.createElementBlock("text",{key:0,class:"is-required"},"*")):e.createCommentVNode("",!0),e.createElementVNode("text",null,e.toDisplayString(o.label),1)],6)]),!0),e.createElementVNode("view",{class:"uni-forms-item__content"},[e.renderSlot(t.$slots,"default",{},void 0,!0),e.createElementVNode("view",{class:e.normalizeClass(["uni-forms-item__error",{"msg--active":i.msg}])},[e.createElementVNode("text",null,e.toDisplayString(i.msg),1)],2)])],2)}],["__scopeId","data-v-d42c39e1"]]);var k={email:/^\S+?@\S+?\.\S+?$/,idcard:/^[1-9]\d{5}(18|19|([23]\d))\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/,url:new RegExp("^(?!mailto:)(?:(?:http|https|ftp)://|//)(?:\\S+(?::\\S*)?@)?(?:(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[0-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))|localhost)(?::\\d{2,5})?(?:(/|\\?|#)[^\\s]*)?$","i")};const v={int:"integer",bool:"boolean",double:"number",long:"number",password:"string"};function w(e,t=""){["label"].forEach((t=>{void 0===e[t]&&(e[t]="")}));let a=t;for(let o in e){let t=new RegExp("{"+o+"}");a=a.replace(t,e[o])}return a}const S={integer:e=>S.number(e)&&parseInt(e,10)===e,string:e=>"string"==typeof e,number:e=>!isNaN(e)&&"number"==typeof e,boolean:function(e){return"boolean"==typeof e},float:function(e){return S.number(e)&&!S.integer(e)},array:e=>Array.isArray(e),object:e=>"object"==typeof e&&!S.array(e),date:e=>e instanceof Date,timestamp(e){return!(!this.integer(e)||Math.abs(e).toString().length>16)},file:e=>"string"==typeof e.url,email:e=>"string"==typeof e&&!!e.match(k.email)&&e.length<255,url:e=>"string"==typeof e&&!!e.match(k.url),pattern(e,t){try{return new RegExp(e).test(t)}catch(a){return!1}},method:e=>"function"==typeof e,idcard:e=>"string"==typeof e&&!!e.match(k.idcard),"url-https"(e){return this.url(e)&&e.startsWith("https://")},"url-scheme":e=>e.startsWith("://"),"url-web":e=>!1};const _={required:(e,t,a)=>e.required&&function(e,t){return null==e||"string"==typeof e&&!e||!(!Array.isArray(e)||e.length)||"object"===t&&!Object.keys(e).length}(t,e.format||typeof t)?w(e,e.errorMessage||a.required):null,range(e,t,a){const{range:o,errorMessage:s}=e;let n=new Array(o.length);for(let l=0;l<o.length;l++){const e=o[l];S.object(e)&&void 0!==e.value?n[l]=e.value:n[l]=e}let i=!1;return Array.isArray(t)?i=new Set(t.concat(n)).size===n.length:n.indexOf(t)>-1&&(i=!0),i?null:w(e,s||a.enum)},rangeNumber(e,t,a){if(!S.number(t))return w(e,e.errorMessage||a.pattern.mismatch);let{minimum:o,maximum:s,exclusiveMinimum:n,exclusiveMaximum:i}=e,l=n?t<=o:t<o,r=i?t>=s:t>s;return void 0!==o&&l?w(e,e.errorMessage||a.number[n?"exclusiveMinimum":"minimum"]):void 0!==s&&r?w(e,e.errorMessage||a.number[i?"exclusiveMaximum":"maximum"]):void 0!==o&&void 0!==s&&(l||r)?w(e,e.errorMessage||a.number.range):null},rangeLength(e,t,a){if(!S.string(t)&&!S.array(t))return w(e,e.errorMessage||a.pattern.mismatch);let o=e.minLength,s=e.maxLength,n=t.length;return void 0!==o&&n<o?w(e,e.errorMessage||a.length.minLength):void 0!==s&&n>s?w(e,e.errorMessage||a.length.maxLength):void 0!==o&&void 0!==s&&(n<o||n>s)?w(e,e.errorMessage||a.length.range):null},pattern:(e,t,a)=>S.pattern(e.pattern,t)?null:w(e,e.errorMessage||a.pattern.mismatch),format(e,t,a){var o=Object.keys(S),s=v[e.format]?v[e.format]:e.format||e.arrayType;return o.indexOf(s)>-1&&!S[s](t)?w(e,e.errorMessage||a.typeError):null},arrayTypeFormat(e,t,a){if(!Array.isArray(t))return w(e,e.errorMessage||a.typeError);for(let o=0;o<t.length;o++){const s=t[o];let n=this.format(e,s,a);if(null!==n)return n}return null}};class V extends class{constructor(e){this._message=e}async validateRule(e,t,a,o,s){var n=null;let i=t.rules;if(i.findIndex((e=>e.required))<0){if(null==a)return n;if("string"==typeof a&&!a.length)return n}var l=this._message;if(void 0===i)return l.default;for(var r=0;r<i.length;r++){let c=i[r],u=this._getValidateType(c);if(Object.assign(c,{label:t.label||`["${e}"]`}),_[u]&&null!=(n=_[u](c,a,l)))break;if(c.validateExpr){let e=Date.now();if(!1===c.validateExpr(a,s,e)){n=this._getMessage(c,c.errorMessage||this._message.default);break}}if(c.validateFunction&&null!==(n=await this.validateFunction(c,a,o,s,u)))break}return null!==n&&(n=l.TAG+n),n}async validateFunction(e,t,a,o,s){let n=null;try{let i=null;const l=await e.validateFunction(e,t,o||a,(e=>{i=e}));(i||"string"==typeof l&&l||!1===l)&&(n=this._getMessage(e,i||l,s))}catch(i){n=this._getMessage(e,i.message,s)}return n}_getMessage(e,t,a){return w(e,t||e.errorMessage||this._message[a]||t.default)}_getValidateType(e){var t="";return e.required?t="required":e.format?t="format":e.arrayType?t="arrayTypeFormat":e.range?t="range":void 0!==e.maximum||void 0!==e.minimum?t="rangeNumber":void 0!==e.maxLength||void 0!==e.minLength?t="rangeLength":e.pattern?t="pattern":e.validateFunction&&(t="validateFunction"),t}}{constructor(e,t){super(V.message),this._schema=e,this._options=t||null}updateSchema(e){this._schema=e}async validate(e,t){let a=this._checkFieldInSchema(e);return a||(a=await this.invokeValidate(e,!1,t)),a.length?a[0]:null}async validateAll(e,t){let a=this._checkFieldInSchema(e);return a||(a=await this.invokeValidate(e,!0,t)),a}async validateUpdate(e,t){let a=this._checkFieldInSchema(e);return a||(a=await this.invokeValidateUpdate(e,!1,t)),a.length?a[0]:null}async invokeValidate(e,t,a){let o=[],s=this._schema;for(let n in s){let i=s[n],l=await this.validateRule(n,i,e[n],e,a);if(null!=l&&(o.push({key:n,errorMessage:l}),!t))break}return o}async invokeValidateUpdate(e,t,a){let o=[];for(let s in e){let n=await this.validateRule(s,this._schema[s],e[s],e,a);if(null!=n&&(o.push({key:s,errorMessage:n}),!t))break}return o}_checkFieldInSchema(e){var t=Object.keys(e),a=Object.keys(this._schema);if(new Set(t.concat(a)).size===a.length)return"";var o=t.filter((e=>a.indexOf(e)<0));return[{key:"invalid",errorMessage:w({field:JSON.stringify(o)},V.message.TAG+V.message.defaultInvalid)}]}}V.message=new function(){return{TAG:"",default:"验证错误",defaultInvalid:"提交的字段{field}在数据库中并不存在",validateFunction:"验证无效",required:"{label}必填",enum:"{label}超出范围",timestamp:"{label}格式无效",whitespace:"{label}不能为空",typeError:"{label}类型无效",date:{format:"{label}日期{value}格式无效",parse:"{label}日期无法解析,{value}无效",invalid:"{label}日期{value}无效"},length:{minLength:"{label}长度不能少于{minLength}",maxLength:"{label}长度不能超过{maxLength}",range:"{label}必须介于{minLength}和{maxLength}之间"},number:{minimum:"{label}不能小于{minimum}",maximum:"{label}不能大于{maximum}",exclusiveMinimum:"{label}不能小于等于{minimum}",exclusiveMaximum:"{label}不能大于等于{maximum}",range:"{label}必须介于{minimum}and{maximum}之间"},pattern:{mismatch:"{label}格式不匹配"}}};const C=(e,t,a)=>{const o=a.find((e=>{return e.format&&("int"===(t=e.format)||"double"===t||"number"===t||"timestamp"===t);var t})),s=a.find((e=>e.format&&"boolean"===e.format||"bool"===e.format));return o&&(t=t||0===t?M(Number(t))?Number(t):t:null),s&&(t=!!I(t)&&t),t},B=(e,t)=>F(t,e),N=(e,t={})=>{const a=T(e);if("object"==typeof a&&Array.isArray(a)&&a.length>1){return a.reduce(((e,t)=>e+`#${t}`),"_formdata_")}return a[0]||e},x=e=>{let t=e.replace("_formdata_#","");return t=t.split("#").map((e=>M(e)?Number(e):e)),t},E=(e,t,a)=>("object"!=typeof e||T(t).reduce(((e,t,o,s)=>o===s.length-1?(e[t]=a,null):(t in e||(e[t]=/^[0-9]{1,}$/.test(s[o+1])?[]:{}),e[t])),e),e);function T(e){return Array.isArray(e)?e:e.replace(/\[/g,".").replace(/\]/g,"").split(".")}const F=(e,t,a="undefined")=>{let o=T(t).reduce(((e,t)=>(e||{})[t]),e);return o&&void 0===o?a:o},M=e=>!isNaN(Number(e)),I=e=>"boolean"==typeof e;const $=o({name:"uniForms",emits:["validate","submit"],options:{virtualHost:!0},props:{value:{type:Object,default:()=>null},modelValue:{type:Object,default:()=>null},model:{type:Object,default:()=>null},rules:{type:Object,default:()=>({})},errShowType:{type:String,default:"undertext"},validateTrigger:{type:String,default:"submit"},labelPosition:{type:String,default:"left"},labelWidth:{type:[String,Number],default:""},labelAlign:{type:String,default:"left"},border:{type:Boolean,default:!1}},provide(){return{uniForm:this}},data:()=>({formData:{},formRules:{}}),computed:{localData(){const e=this.model||this.modelValue||this.value;return e?(t=e,JSON.parse(JSON.stringify(t))):{};var t}},watch:{rules:{handler:function(e,t){this.setRules(e)},deep:!0,immediate:!0}},created(){getApp().$vm.$.appContext.config.globalProperties.binddata||(getApp().$vm.$.appContext.config.globalProperties.binddata=function(e,a,o){if(o)this.$refs[o].setValue(e,a);else{let o;for(let e in this.$refs){const t=this.$refs[e];if(t&&t.$options&&"uniForms"===t.$options.name){o=t;break}}if(!o)return t("error","at uni_modules/uni-forms/components/uni-forms/uni-forms.vue:182","当前 uni-froms 组件缺少 ref 属性");o.setValue(e,a)}}),this.childrens=[],this.inputChildrens=[],this.setRules(this.rules)},methods:{setRules(e){this.formRules=Object.assign({},this.formRules,e),this.validator=new V(e)},setValue(e,t){let a=this.childrens.find((t=>t.name===e));return a?(this.formData[e]=C(0,t,this.formRules[e]&&this.formRules[e].rules||[]),a.onFieldChange(this.formData[e])):null},validate(e,t){return this.checkAll(this.formData,e,t)},validateField(e=[],t){e=[].concat(e);let a={};return this.childrens.forEach((t=>{const o=N(t.name);-1!==e.indexOf(o)&&(a=Object.assign({},a,{[o]:this.formData[o]}))})),this.checkAll(a,[],t)},clearValidate(e=[]){e=[].concat(e),this.childrens.forEach((t=>{if(0===e.length)t.errMsg="";else{const a=N(t.name);-1!==e.indexOf(a)&&(t.errMsg="")}}))},submit(e,a,o){for(let t in this.dataValue){this.childrens.find((e=>e.name===t))&&void 0===this.formData[t]&&(this.formData[t]=this._getValue(t,this.dataValue[t]))}return o||t("warn","at uni_modules/uni-forms/components/uni-forms/uni-forms.vue:289","submit 方法即将废弃，请使用validate方法代替！"),this.checkAll(this.formData,e,a,"submit")},async checkAll(e,t,a,o){if(!this.validator)return;let s,n=[];for(let c in e){const e=this.childrens.find((e=>N(e.name)===c));e&&n.push(e)}a||"function"!=typeof t||(a=t),!a&&"function"!=typeof a&&Promise&&(s=new Promise(((e,t)=>{a=function(a,o){a?t(a):e(o)}})));let i=[],l=JSON.parse(JSON.stringify(e));for(let c in n){const e=n[c];let t=N(e.name);const a=await e.onFieldChange(l[t]);if(a&&(i.push(a),"toast"===this.errShowType||"modal"===this.errShowType))break}Array.isArray(i)&&0===i.length&&(i=null),Array.isArray(t)&&t.forEach((e=>{let t=N(e),a=B(e,this.localData);void 0!==a&&(l[t]=a)})),"submit"===o?this.$emit("submit",{detail:{value:l,errors:i}}):this.$emit("validate",i);let r={};return r=((e={},t)=>{let a=JSON.parse(JSON.stringify(e)),o={};for(let s in a){let e=x(s);E(o,e,a[s])}return o})(l,this.name),a&&"function"==typeof a&&a(i,r),s&&a?s:null},validateCheck(e){this.$emit("validate",e)},_getValue:C,_isRequiredField:e=>{let t=!1;for(let a=0;a<e.length;a++){if(e[a].required){t=!0;break}}return t},_setDataValue:(e,t,a)=>(t[e]=a,a||""),_getDataValue:B,_realName:N,_isRealName:e=>/^_formdata_#*/.test(e),_isEqual:(e,t)=>{if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;var a=toString.call(e);if(a!==toString.call(t))return!1;switch(a){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t}if("[object Object]"==a){var o=Object.getOwnPropertyNames(e),s=Object.getOwnPropertyNames(t);if(o.length!=s.length)return!1;for(var n=0;n<o.length;n++){var i=o[n];if(e[i]!==t[i])return!1}return!0}return"[object Array]"==a?e.toString()==t.toString():void 0}}},[["render",function(t,a,o,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:"uni-forms"},[e.createElementVNode("form",null,[e.renderSlot(t.$slots,"default",{},void 0,!0)])])}],["__scopeId","data-v-d0b7151e"]]);
>>>>>>> 9b9fc38 (last version)
/*!
   * pinia v2.1.7
   * (c) 2023 Eduardo San Martin Morote
   * @license MIT
   */
<<<<<<< HEAD
let J;const K=e=>J=e,Q=Symbol();function X(e){return e&&"object"==typeof e&&"[object Object]"===Object.prototype.toString.call(e)&&"function"!=typeof e.toJSON}var Y,Z;(Z=Y||(Y={})).direct="direct",Z.patchObject="patch object",Z.patchFunction="patch function";const ee=()=>{};function te(t,a,o,s=ee){t.push(a);const n=()=>{const e=t.indexOf(a);e>-1&&(t.splice(e,1),s())};return!o&&e.getCurrentScope()&&e.onScopeDispose(n),n}function ae(e,...t){e.slice().forEach((e=>{e(...t)}))}const oe=e=>e();function se(t,a){t instanceof Map&&a instanceof Map&&a.forEach(((e,a)=>t.set(a,e))),t instanceof Set&&a instanceof Set&&a.forEach(t.add,t);for(const o in a){if(!a.hasOwnProperty(o))continue;const s=a[o],n=t[o];X(n)&&X(s)&&t.hasOwnProperty(o)&&!e.isRef(s)&&!e.isReactive(s)?t[o]=se(n,s):t[o]=s}return t}const ne=Symbol();const{assign:ie}=Object;function le(t,a,o={},s,n,i){let l;const r=ie({actions:{}},o),c={deep:!0};let u,d,m,h=[],p=[];const g=s.state.value[t];let f;function y(a){let o;u=d=!1,"function"==typeof a?(a(s.state.value[t]),o={type:Y.patchFunction,storeId:t,events:m}):(se(s.state.value[t],a),o={type:Y.patchObject,payload:a,storeId:t,events:m});const n=f=Symbol();e.nextTick().then((()=>{f===n&&(u=!0)})),d=!0,ae(h,o,s.state.value[t])}i||g||(s.state.value[t]={}),e.ref({});const b=i?function(){const{state:e}=o,t=e?e():{};this.$patch((e=>{ie(e,t)}))}:ee;function k(e,a){return function(){K(s);const o=Array.from(arguments),n=[],i=[];function l(e){n.push(e)}function r(e){i.push(e)}let c;ae(p,{args:o,name:e,store:w,after:l,onError:r});try{c=a.apply(this&&this.$id===t?this:w,o)}catch(u){throw ae(i,u),u}return c instanceof Promise?c.then((e=>(ae(n,e),e))).catch((e=>(ae(i,e),Promise.reject(e)))):(ae(n,c),c)}}const v={_p:s,$id:t,$onAction:te.bind(null,p),$patch:y,$reset:b,$subscribe(a,o={}){const n=te(h,a,o.detached,(()=>i())),i=l.run((()=>e.watch((()=>s.state.value[t]),(e=>{("sync"===o.flush?d:u)&&a({storeId:t,type:Y.direct,events:m},e)}),ie({},c,o))));return n},$dispose:function(){l.stop(),h=[],p=[],s._s.delete(t)}},w=e.reactive(v);s._s.set(t,w);const S=(s._a&&s._a.runWithContext||oe)((()=>s._e.run((()=>(l=e.effectScope()).run(a)))));for(const C in S){const a=S[C];if(e.isRef(a)&&(V=a,!e.isRef(V)||!V.effect)||e.isReactive(a))i||(!g||X(_=a)&&_.hasOwnProperty(ne)||(e.isRef(a)?a.value=g[C]:se(a,g[C])),s.state.value[t][C]=a);else if("function"==typeof a){const e=k(C,a);S[C]=e,r.actions[C]=a}}var _,V;return ie(w,S),ie(e.toRaw(w),S),Object.defineProperty(w,"$state",{get:()=>s.state.value[t],set:e=>{y((t=>{ie(t,e)}))}}),s._p.forEach((e=>{ie(w,l.run((()=>e({store:w,app:s._a,pinia:s,options:r}))))})),g&&i&&o.hydrate&&o.hydrate(w.$state,g),u=!0,d=!0,w}const re=function(t,a,o){let s,n;const i="function"==typeof a;function l(t,o){const l=e.hasInjectionContext();(t=t||(l?e.inject(Q,null):null))&&K(t),(t=J)._s.has(s)||(i?le(s,a,n,t):function(t,a,o,s){const{state:n,actions:i,getters:l}=a,r=o.state.value[t];let c;c=le(t,(function(){r||(o.state.value[t]=n?n():{});const a=e.toRefs(o.state.value[t]);return ie(a,i,Object.keys(l||{}).reduce(((a,s)=>(a[s]=e.markRaw(e.computed((()=>{K(o);const e=o._s.get(t);return l[s].call(e,e)}))),a)),{}))}),a,o,0,!0)}(s,n,t));return t._s.get(s)}return"string"==typeof t?(s=t,n=i?o:a):(n=t,s=t.id),l.$id=s,l}("profile",{state:()=>({profile:null}),actions:{async getProfile(){try{uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/profile",method:"GET",header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")},success:e=>{this.profile=e.data.value}})}catch(e){t("error","at stores/profile.js:24","Error fetching profile:",e)}},async initializeProfile(){if(!this.profile)try{await this.getProfile()}catch(e){t("log","at stores/profile.js:33",e)}}}});const ce=s({data:()=>({loginForm:{phoneNum:"",password:""},rules:{phoneNum:{rules:[{required:!0,errorMessage:"请输入用户名"}]},password:{rules:[{required:!0,errorMessage:"请输入密码"}]}}}),methods:{submit(){const e={username:this.loginForm.phoneNum,password:this.loginForm.password};uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/identity/login",method:"POST",header:{"Content-Type":"application/json"},data:e,success:t=>{const a=t.data;if(a.status){uni.showToast({title:"登录成功",icon:"success"}),uni.setStorageSync("token",a.value.accessToken),uni.setStorageSync("refresh",a.value.accessToken);re().getProfile(),uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/profile",method:"GET",header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")},success:t=>{const a=t.data;uni.setStorageSync("id",a.value.id),uni.setStorageSync("nickname",a.value.nickname),uni.setStorageSync("username",a.value.username),uni.setStorageSync("password",e.password)}}),uni.switchTab({url:"/pages/tabBar/chats/chats"})}else uni.showModal({title:"提示",content:a.message,showCancel:!1})},fail:e=>{uni.showToast({title:"网络请求失败",icon:"error"}),t("error","at pages/log/login/login.vue:115","请求失败：",e)}})}}},[["render",function(t,o,s,n,i,l){const r=a(e.resolveDynamicComponent("uni-easyinput"),T),c=a(e.resolveDynamicComponent("uni-forms-item"),F),u=a(e.resolveDynamicComponent("uni-forms"),G);return e.openBlock(),e.createElementBlock("view",{class:"page login"},[e.createElementVNode("view",{class:"title"},"欢迎登录"),e.createVNode(u,{class:"form",modelValue:i.loginForm,rules:i.rules,"validate-trigger":"bind"},{default:e.withCtx((()=>[e.createVNode(c,{name:"phoneNum"},{default:e.withCtx((()=>[e.createVNode(r,{type:"text",modelValue:i.loginForm.phoneNum,"onUpdate:modelValue":o[0]||(o[0]=e=>i.loginForm.phoneNum=e),"prefix-icon":"person",placeholder:"用户名"},null,8,["modelValue"])])),_:1}),e.createVNode(c,{name:"password"},{default:e.withCtx((()=>[e.createVNode(r,{type:"password",modelValue:i.loginForm.password,"onUpdate:modelValue":o[1]||(o[1]=e=>i.loginForm.password=e),"prefix-icon":"locked",placeholder:"密码"},null,8,["modelValue"])])),_:1}),e.createElementVNode("button",{class:"btn-submit",onClick:o[2]||(o[2]=(...e)=>l.submit&&l.submit(...e)),type:"primary"},"登录")])),_:1},8,["modelValue","rules"]),e.createElementVNode("navigator",{class:"nav-register",url:"/pages/log/register/register","open-type":"redirect"}," 没有账号？前往注册 ")])}],["__scopeId","data-v-f338d1b4"]]);const ue=s({data:()=>({isValid:!1,dataForm:{userName:"",nickName:"",phoneNum:"",code:"",password:"",confirmPassword:""},rules:{userName:{rules:[{required:!0,errorMessage:"请输入用户名"},{minLength:6,errorMessage:"用户名不能少于6个字符"}]},nickName:{rules:[{required:!0,errorMessage:"请输入昵称"}]},phoneNum:{rules:[{required:!0,errorMessage:"请输入手机号"}]},code:{rules:[{required:!0,errorMessage:"请输入验证码"}]},password:{rules:[{required:!0,errorMessage:"请输入密码"},{minLength:6,errorMessage:"密码不能少于6个字符"}]},confirmPassword:{rules:[{required:!0,errorMessage:"请输入确认密码"},{validateFunction:(e,a,o,s)=>(t("log","at pages/log/register/register.vue:92","validateFunction"),o.password!=a&&s("两次密码输入不一致"),!0)}]}}}),watch:{dataForm:{handler(e,t){""!=this.dataForm.userName&&""!=this.dataForm.nickname&&""!=this.dataForm.phoneNum&&""!=this.dataForm.code&&""!=this.dataForm.password&&this.dataForm.password==this.dataForm.confirmPassword?this.isValid=!0:this.isValid=!1},deep:!0}},methods:{submit(){t("log","at pages/log/register/register.vue:119","submitted");const e={username:this.dataForm.userName,password:this.dataForm.password,nickname:this.dataForm.nickName,phone:this.dataForm.phoneNum,code:this.dataForm.code};uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/identity/register",method:"POST",header:{"Content-Type":"application/json"},data:e,success:e=>{const t=e.data;t.status?(uni.showToast({title:"注册成功",icon:"success",duration:2e3}),this.login()):uni.showModal({title:"注册失败",content:t.message,showCancel:!1})},fail:e=>{uni.showModal({title:"错误",content:"网络请求失败，请稍后重试",showCancel:!1}),t("error","at pages/log/register/register.vue:159","注册请求失败：",e)}})},login(){const e={username:this.dataForm.userName,password:this.dataForm.password};uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/identity/login",method:"POST",header:{"Content-Type":"application/json"},data:e,success:e=>{const t=e.data;t.status?(uni.showToast({title:t.message,icon:"success"}),uni.setStorageSync("token",t.value.accessToken),uni.setStorageSync("refresh",t.value.accessToken),uni.switchTab({url:"/pages/tabBar/chats/chats"})):uni.showModal({title:"提示",content:t.message,showCancel:!1})},fail:e=>{uni.showToast({title:"网络请求失败",icon:"error"}),t("error","at pages/log/register/register.vue:208","请求失败：",e)}})},getVerificationCode(){uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/identity/sendCode",method:"POST",header:{"Content-Type":"application/json"},data:{phone:this.dataForm.phoneNum},success:e=>{const t=e.data;t.status?uni.showToast({title:"发送成功",icon:"success",duration:2e3}):uni.showModal({title:"发送失败",content:t.message,showCancel:!1})},fail:e=>{uni.showModal({title:"错误",content:"发送验证码失败，请稍后重试",showCancel:!1}),t("error","at pages/log/register/register.vue:247","发送验证码失败：",e)}})}}},[["render",function(t,o,s,n,i,l){const r=a(e.resolveDynamicComponent("uni-easyinput"),T),c=a(e.resolveDynamicComponent("uni-forms-item"),F),u=a(e.resolveDynamicComponent("uni-forms"),G);return e.openBlock(),e.createElementBlock("view",{class:"register"},[e.createElementVNode("view",{class:"title"},"欢迎注册"),e.createVNode(u,{class:"form",modelValue:i.dataForm,rules:i.rules,"validate-trigger":"bind","label-width":"80px"},{default:e.withCtx((()=>[e.createVNode(c,{name:"userName",label:"用户名"},{default:e.withCtx((()=>[e.createVNode(r,{type:"text",modelValue:i.dataForm.userName,"onUpdate:modelValue":o[0]||(o[0]=e=>i.dataForm.userName=e),placeholder:"用户名"},null,8,["modelValue"])])),_:1}),e.createVNode(c,{name:"nickName",label:"昵称"},{default:e.withCtx((()=>[e.createVNode(r,{type:"text",modelValue:i.dataForm.nickName,"onUpdate:modelValue":o[1]||(o[1]=e=>i.dataForm.nickName=e),placeholder:"昵称"},null,8,["modelValue"])])),_:1}),e.createVNode(c,{name:"phoneNum",label:"手机号"},{default:e.withCtx((()=>[e.createVNode(r,{type:"number",modelValue:i.dataForm.phoneNum,"onUpdate:modelValue":o[2]||(o[2]=e=>i.dataForm.phoneNum=e),placeholder:"手机号"},null,8,["modelValue"])])),_:1}),e.createVNode(c,{name:"code",label:"验证码"},{default:e.withCtx((()=>[e.createVNode(r,{type:"number",modelValue:i.dataForm.code,"onUpdate:modelValue":o[4]||(o[4]=e=>i.dataForm.code=e),placeholder:"验证码"},{right:e.withCtx((()=>[e.createElementVNode("button",{disabled:11!=i.dataForm.phoneNum.length,onClick:o[3]||(o[3]=(...e)=>l.getVerificationCode&&l.getVerificationCode(...e)),class:"btn-get-code"},"获取验证码",8,["disabled"])])),_:1},8,["modelValue"])])),_:1}),e.createVNode(c,{name:"password",label:"密码"},{default:e.withCtx((()=>[e.createVNode(r,{type:"password",modelValue:i.dataForm.password,"onUpdate:modelValue":o[5]||(o[5]=e=>i.dataForm.password=e),placeholder:"密码"},null,8,["modelValue"])])),_:1}),e.createVNode(c,{name:"confirmPassword",label:"确认密码"},{default:e.withCtx((()=>[e.createVNode(r,{type:"password",modelValue:i.dataForm.confirmPassword,"onUpdate:modelValue":o[6]||(o[6]=e=>i.dataForm.confirmPassword=e),placeholder:"确认密码"},null,8,["modelValue"])])),_:1}),e.createElementVNode("button",{class:"btn-submit",disabled:!i.isValid,onClick:o[7]||(o[7]=(...e)=>l.submit&&l.submit(...e)),type:"warn"},"注册并登录",8,["disabled"])])),_:1},8,["modelValue","rules"]),e.createElementVNode("navigator",{class:"nav-login",url:"/pages/log/login/login","open-type":"redirect"}," 已有账号？前往登录 ")])}],["__scopeId","data-v-d2b3d8e0"]]);const de=s({data:()=>({inputMessage:"",scrollTop:0,messageList:[{id:1,content:"你好！",isSelf:!1,avatar:"/static/c1.png",time:new Date},{id:2,content:"你好！很高兴见到你！",isSelf:!0,avatar:"/static/c2.png",time:new Date}]}),methods:{sendMessage(){this.inputMessage.trim()&&(this.messageList.push({id:this.messageList.length+1,content:this.inputMessage,isSelf:!0,avatar:"/static/c2.png",time:new Date}),this.inputMessage="",this.$nextTick((()=>{this.scrollToBottom()})),setTimeout((()=>{this.messageList.push({id:this.messageList.length+1,content:"收到你的消息了！",isSelf:!1,avatar:"/static/c1.png",time:new Date}),this.scrollToBottom()}),1e3))},scrollToBottom(){uni.createSelectorQuery().in(this).select(".message-list").boundingClientRect((e=>{this.scrollTop=e.height})).exec()},loadMoreMessages(){t("log","at pages/tabBar/chats/chat-box.vue:126","加载更多消息")}},mounted(){this.scrollToBottom()}},[["render",function(t,a,o,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:"chat-container"},[e.createElementVNode("view",{class:"chat-header"},[e.createElementVNode("text",{class:"header-title"},"聊天")]),e.createElementVNode("scroll-view",{class:"chat-messages","scroll-y":"true","scroll-top":n.scrollTop,"scroll-with-animation":!0,onScrolltoupper:a[0]||(a[0]=(...e)=>i.loadMoreMessages&&i.loadMoreMessages(...e))},[e.createElementVNode("view",{class:"message-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.messageList,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["message-item",t.isSelf?"message-right":"message-left"])},[e.createElementVNode("image",{class:"avatar",src:t.avatar,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"message-content"},[e.createElementVNode("text",{class:"message-text"},e.toDisplayString(t.content),1)])],2)))),128))])],40,["scroll-top"]),e.createElementVNode("view",{class:"chat-footer"},[e.createElementVNode("view",{class:"input-box"},[e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":a[1]||(a[1]=e=>n.inputMessage=e),"confirm-type":"send",onConfirm:a[2]||(a[2]=(...e)=>i.sendMessage&&i.sendMessage(...e)),placeholder:"请输入消息",class:"message-input"},null,544),[[e.vModelText,n.inputMessage]]),e.createElementVNode("button",{class:e.normalizeClass(["send-btn",{active:n.inputMessage.length>0}]),onClick:a[3]||(a[3]=(...e)=>i.sendMessage&&i.sendMessage(...e))},"发送",2)])])])}]]);const me=s({data:()=>({range:Array.from({length:10},((e,t)=>t+1)),character:{name:"",personality:{sociability:5,shyness:5,calmness:5,optimism:5,empathy:5,curiosity:5,logic:5,creativity:5,patience:5,aggressiveness:5,humor:5,ambition:5,resilience:5,trustworthiness:5}},isSubmitting:!1,nameError:!1}),methods:{updatePersonality(e,t){const a=this.range[t.detail.value];this.character.personality[e]=a},translateKey:e=>({sociability:"Sociability",shyness:"Shyness",calmness:"Calmness",optimism:"Optimism",empathy:"Empathy",curiosity:"Curiosity",logic:"Logic",creativity:"Creativity",patience:"Patience",aggressiveness:"Aggressiveness",humor:"Humor",ambition:"Ambition",resilience:"Resilience",trustworthiness:"Trustworthiness"}[e]||e),async submitCharacter(){if(this.character.name.trim()){this.nameError=!1,this.isSubmitting=!0;try{t("log","at pages/tabBar/contacts/newVirtualFriend.vue:90","Created character:",this.character);const e=await uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/characters",method:"POST",data:{name:this.character.name,personality:this.character.personality},header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")}});uni.showToast({title:"Character created!",icon:"success"}),uni.navigateTo({url:`/pages/tabBar/chats/chat-room?chatId=${e.data.value.chatId}&actionType=virtual&characterId=${e.data.value.id}`})}catch(e){t("error","at pages/tabBar/contacts/newVirtualFriend.vue:114","Error creating character:",e),uni.showToast({title:"Error creating character",icon:"error"})}finally{this.isSubmitting=!1}}else this.nameError=!0}}},[["render",function(t,a,o,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("text",{class:"label"},"Character Name:"),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>n.character.name=e),type:"text",placeholder:"Enter character name",class:"input"},null,512),[[e.vModelText,n.character.name]]),n.nameError?(e.openBlock(),e.createElementBlock("text",{key:0,class:"error"},"Name is required")):e.createCommentVNode("",!0)]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.character.personality,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"form-group",key:a},[e.createElementVNode("text",{class:"label"},e.toDisplayString(i.translateKey(a))+":",1),e.createElementVNode("picker",{mode:"selector",range:n.range,value:t-1,onChange:e=>i.updatePersonality(a,e),class:"selector"},[e.createElementVNode("view",{class:"picker-text"},e.toDisplayString(t),1)],40,["range","value","onChange"])])))),128)),e.createElementVNode("button",{onClick:a[1]||(a[1]=(...e)=>i.submitCharacter&&i.submitCharacter(...e)),class:"submit-button",disabled:n.isSubmitting},[n.isSubmitting?(e.openBlock(),e.createElementBlock("view",{key:0},"Creating...")):(e.openBlock(),e.createElementBlock("view",{key:1},"Create Character"))],8,["disabled"])])}],["__scopeId","data-v-fca1466b"]]);const he=s({data:()=>({searchText:"",searchResults:[],searchTimer:null,hasSearched:!1}),watch:{searchText:{handler(e,t){if(this.searchTimer&&clearTimeout(this.searchTimer),!this.searchText.trim())return this.searchResults=[],void(this.hasSearched=!1);this.searchTimer=setTimeout((()=>{this.searchUser()}),500)}}},methods:{async searchUser(){try{await uni.request({url:`https://gal-chat-test-970e995e1901.herokuapp.com/api/profile/byUsername/${this.searchText}`,method:"GET",header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")},success:e=>{const a=e.data;this.hasSearched=!0,a.status?(this.searchResults=a.value,t("log","at pages/tabBar/contacts/newRealFriend.vue:79",this.searchResults)):this.searchResults=[]}})}catch(e){this.searchResults=[],uni.showToast({title:"网络错误",icon:"none"})}},showdetail(){uni.navigateTo({url:`/pages/detail/userdetail?id=${this.searchResults.id}&username=${this.searchText}&nickname=${this.searchResults.nickname}`})}}},[["render",function(t,o,s,n,i,l){const r=a(e.resolveDynamicComponent("uni-search-bar"),k);return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("view",{class:"nav-bar"},[e.createElementVNode("view",{class:"nav-search"},[e.createVNode(r,{modelValue:i.searchText,"onUpdate:modelValue":o[0]||(o[0]=e=>i.searchText=e),radius:"100",cancelButton:"none",placeholder:"点击搜索新的好友"},null,8,["modelValue"])])]),e.createElementVNode("view",null,[0!=i.searchResults.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"search-results"},[e.createElementVNode("view",{class:"user-item",onClick:o[1]||(o[1]=e=>l.showdetail())},[e.createElementVNode("image",{class:"user-avatar",src:i.searchResults.avatar,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("text",{class:"user-name"},e.toDisplayString(i.searchResults.username),1)])])):e.createCommentVNode("",!0),i.searchText&&0===i.searchResults.length?(e.openBlock(),e.createElementBlock("view",{key:1,class:"no-results"},[e.createElementVNode("text",null,"未找到相关用户")])):e.createCommentVNode("",!0),e.createElementVNode("text",null,"没有待处理的好友请求")])],64)}]]);const pe=s({},[["render",function(t,o){const s=a(e.resolveDynamicComponent("uni-search-bar"),k),i=a(e.resolveDynamicComponent("uni-icons"),n);return e.openBlock(),e.createElementBlock("view",{class:"nav-bar"},[e.createElementVNode("view",{class:"nav-search"},[e.createVNode(s,{modelValue:t.searchText,"onUpdate:modelValue":o[0]||(o[0]=e=>t.searchText=e),radius:"100",cancelButton:"none",placeholder:"点击搜索群聊"},null,8,["modelValue"])]),e.createElementVNode("view",{class:"nav-add",onClick:o[1]||(o[1]=e=>t.onAddNewFriends())},[e.createVNode(i,{type:"personadd",size:"35"})])])}]]);const ge=s({data:()=>({listData:[{title:"昵称",url:"/pages/accountsetting/setnickname"},{title:"用户名",url:"/pages/accountsetting/setaccount"},{title:"修改密码",url:"/pages/accountsetting/setpassword"}]}),methods:{navigateTo(e){uni.navigateTo({url:e})}}},[["render",function(t,o,s,n,i,l){const r=a(e.resolveDynamicComponent("uni-list-item"),V),c=a(e.resolveDynamicComponent("uni-list"),C);return e.openBlock(),e.createElementBlock("view",null,[e.createVNode(c,null,{default:e.withCtx((()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.listData,((t,a)=>(e.openBlock(),e.createBlock(r,{key:a,title:t.title,clickable:"",onClick:e=>l.navigateTo(t.url)},null,8,["title","onClick"])))),128))])),_:1})])}]]);const fe=s({data:()=>({isValid:!1,oldnickname:uni.getStorageSync("nickname")??"",dataForm:{nickName:uni.getStorageSync("nickname")??""},rules:{nickName:{rules:[{required:!0,errorMessage:"请输入昵称"}]}}}),onLoad(){this.dataForm={nickName:uni.getStorageSync("nickname")}},watch:{dataForm:{handler(e,t){this.dataForm.nickName!=this.oldnickname&&""!=this.dataForm.nickName?this.isValid=!0:this.isValid=!1},deep:!0}},methods:{submit(){const e={username:uni.getStorageSync("username"),nickname:this.dataForm.nickName,password:uni.getStorageSync("password"),confirmPassword:uni.getStorageSync("password")};uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/profile/update",method:"PUT",header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")},data:e,success:e=>{const t=e.data;t.status?(uni.setStorageSync("nickname",this.dataForm.nickName),uni.showToast({title:"修改成功",icon:"success",duration:2e3}),uni.navigateBack()):uni.showModal({title:"修改失败",content:t.message,showCancel:!1})},fail:e=>{uni.showModal({title:"错误",content:"网络请求失败，请稍后重试",showCancel:!1}),t("error","at pages/accountsetting/setnickname.vue:91","请求失败：",e)}})}}},[["render",function(t,o,s,n,i,l){const r=a(e.resolveDynamicComponent("uni-easyinput"),T),c=a(e.resolveDynamicComponent("uni-forms-item"),F),u=a(e.resolveDynamicComponent("uni-forms"),G);return e.openBlock(),e.createElementBlock("view",{class:"register"},[e.createVNode(u,{class:"form",modelValue:i.dataForm,rules:i.rules,"validate-trigger":"bind","label-width":"80px"},{default:e.withCtx((()=>[e.createVNode(c,{name:"nickName",label:"昵称"},{default:e.withCtx((()=>[e.createVNode(r,{type:"text",modelValue:i.dataForm.nickName,"onUpdate:modelValue":o[0]||(o[0]=e=>i.dataForm.nickName=e),placeholder:"昵称"},null,8,["modelValue"]),e.createElementVNode("text",{class:"tip-text"},"一个好的昵称可以让好友轻松记住你")])),_:1}),e.createElementVNode("button",{class:"btn-submit",disabled:!i.isValid,onClick:o[1]||(o[1]=(...e)=>l.submit&&l.submit(...e)),type:"primary"},"保存",8,["disabled"])])),_:1},8,["modelValue","rules"])])}],["__scopeId","data-v-b2a9fd82"]]);const ye=s({data:()=>({isValid:!1,olduserName:uni.getStorageSync("userName")??"",dataForm:{userName:uni.getStorageSync("userName")??""},rules:{userName:{rules:[{required:!0,errorMessage:"请输入用户名"},{minLength:6,errorMessage:"用户名不能少于6个字符"}]}}}),onLoad(){this.dataForm={userName:uni.getStorageSync("userName")}},watch:{dataForm:{handler(e,t){this.dataForm.userName!=this.olduserName&&""!=this.dataForm.userName?this.isValid=!0:this.isValid=!1},deep:!0}},methods:{submit(){const e={username:this.dataForm.userName,nickname:uni.getStorageSync("nickname"),password:uni.getStorageSync("password"),confirmPassword:uni.getStorageSync("password")};uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/profile/update",method:"PUT",header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")},data:e,success:e=>{const t=e.data;t.status?(uni.setStorageSync("userName",this.dataForm.userName),uni.showToast({title:"修改成功",icon:"success",duration:2e3}),uni.navigateBack()):uni.showModal({title:"修改失败",content:t.message,showCancel:!1})},fail:e=>{uni.showModal({title:"错误",content:"网络请求失败，请稍后重试",showCancel:!1}),t("error","at pages/accountsetting/setaccount.vue:94","请求失败：",e)}})}}},[["render",function(t,o,s,n,i,l){const r=a(e.resolveDynamicComponent("uni-easyinput"),T),c=a(e.resolveDynamicComponent("uni-forms-item"),F),u=a(e.resolveDynamicComponent("uni-forms"),G);return e.openBlock(),e.createElementBlock("view",{class:"register"},[e.createVNode(u,{class:"form",modelValue:i.dataForm,rules:i.rules,"validate-trigger":"bind","label-width":"80px"},{default:e.withCtx((()=>[e.createVNode(c,{name:"userName",label:"用户名"},{default:e.withCtx((()=>[e.createVNode(r,{type:"text",modelValue:i.dataForm.userName,"onUpdate:modelValue":o[0]||(o[0]=e=>i.dataForm.userName=e),placeholder:"用户名"},null,8,["modelValue"]),e.createElementVNode("text",{class:"tip-text"},"用户名是账号的唯一凭证，用于登录，请牢记")])),_:1}),e.createElementVNode("button",{class:"btn-submit",disabled:!i.isValid,onClick:o[1]||(o[1]=(...e)=>l.submit&&l.submit(...e)),type:"primary"},"保存",8,["disabled"])])),_:1},8,["modelValue","rules"])])}],["__scopeId","data-v-1d44fd70"]]);const be=s({data:()=>({isValid:!1,dataForm:{oldpassword:"",password:"",confirmPassword:""},rules:{oldpassword:{rules:[{required:!0,errorMessage:"请输入旧密码"}]},password:{rules:[{required:!0,errorMessage:"请输入新密码"},{minLength:6,errorMessage:"密码不能少于6个字符"}]},confirmPassword:{rules:[{required:!0,errorMessage:"请输入确认密码"},{validateFunction:(e,t,a,o)=>(a.password!=t&&o("两次密码输入不一致"),!0)}]}}}),watch:{dataForm:{handler(e,t){""!=this.dataForm.oldpassword&&""!=this.dataForm.password&&this.dataForm.password==this.dataForm.confirmPassword?this.isValid=!0:this.isValid=!1},deep:!0}},methods:{submit(){const e={username:uni.getStorageSync("username"),nickname:uni.getStorageSync("nickname"),password:this.dataForm.password,confirmPassword:this.dataForm.oldpassword};uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/profile/update",method:"PUT",header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")},data:e,success:e=>{const t=e.data;t.status?(uni.setStorageSync("password",this.dataForm.password),uni.showToast({title:"修改成功",icon:"success",duration:2e3}),uni.navigateBack()):uni.showModal({title:"修改失败",content:t.message,showCancel:!1})},fail:e=>{uni.showModal({title:"错误",content:"网络请求失败，请稍后重试",showCancel:!1}),t("error","at pages/accountsetting/setpassword.vue:115","请求失败：",e)}})}}},[["render",function(t,o,s,n,i,l){const r=a(e.resolveDynamicComponent("uni-easyinput"),T),c=a(e.resolveDynamicComponent("uni-forms-item"),F),u=a(e.resolveDynamicComponent("uni-forms"),G);return e.openBlock(),e.createElementBlock("view",{class:"register"},[e.createVNode(u,{class:"form",modelValue:i.dataForm,rules:i.rules,"validate-trigger":"bind","label-width":"80px"},{default:e.withCtx((()=>[e.createVNode(c,{name:"oldpassword",label:"旧密码"},{default:e.withCtx((()=>[e.createVNode(r,{type:"password",modelValue:i.dataForm.oldpassword,"onUpdate:modelValue":o[0]||(o[0]=e=>i.dataForm.oldpassword=e),placeholder:"旧密码"},null,8,["modelValue"])])),_:1}),e.createVNode(c,{name:"password",label:"新密码"},{default:e.withCtx((()=>[e.createVNode(r,{type:"password",modelValue:i.dataForm.password,"onUpdate:modelValue":o[1]||(o[1]=e=>i.dataForm.password=e),placeholder:"新密码"},null,8,["modelValue"])])),_:1}),e.createVNode(c,{name:"confirmPassword",label:"确认密码"},{default:e.withCtx((()=>[e.createVNode(r,{type:"password",modelValue:i.dataForm.confirmPassword,"onUpdate:modelValue":o[2]||(o[2]=e=>i.dataForm.confirmPassword=e),placeholder:"确认密码"},null,8,["modelValue"])])),_:1}),e.createElementVNode("button",{class:"btn-submit",disabled:!i.isValid,onClick:o[3]||(o[3]=(...e)=>l.submit&&l.submit(...e)),type:"primary"},"保存",8,["disabled"])])),_:1},8,["modelValue","rules"])])}],["__scopeId","data-v-6fdbf42b"]]);const ke=s({data:()=>({dataForm:{mood:"添加心情"===uni.getStorageSync("mood")?"":uni.getStorageSync("mood")}}),onLoad(){this.dataForm={mood:"添加心情"===uni.getStorageSync("mood")?"":uni.getStorageSync("mood")}},methods:{submit(){const e={mood:""===this.dataForm.mood?"添加心情":this.dataForm.mood};uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/profile/mood",method:"PUT",header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")},data:e,success:e=>{const t=e.data;t.status?(uni.setStorageSync("mood",this.dataForm.mood),uni.showToast({title:"修改成功",icon:"success",duration:2e3}),uni.switchTab({url:"/pages/tabBar/me/me"})):uni.showModal({title:"修改失败",content:t.message,showCancel:!1})},fail:e=>{uni.showModal({title:"错误",content:"网络请求失败，请稍后重试",showCancel:!1}),t("error","at pages/accountsetting/setmood.vue:68","请求失败：",e)}})}}},[["render",function(t,o,s,n,i,l){const r=a(e.resolveDynamicComponent("uni-easyinput"),T),c=a(e.resolveDynamicComponent("uni-forms-item"),F),u=a(e.resolveDynamicComponent("uni-forms"),G);return e.openBlock(),e.createElementBlock("view",{class:"register"},[e.createVNode(u,{class:"form",modelValue:i.dataForm,rules:t.rules,"validate-trigger":"bind","label-width":"80px"},{default:e.withCtx((()=>[e.createVNode(c,{name:"mood",label:"心情"},{default:e.withCtx((()=>[e.createVNode(r,{type:"text",modelValue:i.dataForm.mood,"onUpdate:modelValue":o[0]||(o[0]=e=>i.dataForm.mood=e),placeholder:"无心情"},null,8,["modelValue"]),e.createElementVNode("text",{class:"tip-text"},"将心情告诉你的好友")])),_:1}),e.createElementVNode("button",{class:"btn-submit",onClick:o[1]||(o[1]=(...e)=>l.submit&&l.submit(...e)),type:"primary"},"保存")])),_:1},8,["modelValue","rules"])])}],["__scopeId","data-v-ae70f249"]]);const ve=s({data:()=>({dataForm:{status:"添加状态"===uni.getStorageSync("status")?"":uni.getStorageSync("status")}}),onLoad(){this.dataForm={status:"添加状态"===uni.getStorageSync("status")?"":uni.getStorageSync("status")}},methods:{submit(){const e={status:""===this.dataForm.status?"添加状态":this.dataForm.status};uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/profile/status",method:"PUT",header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")},data:e,success:e=>{const t=e.data;t.status?(uni.setStorageSync("status",this.dataForm.status),uni.showToast({title:"修改成功",icon:"success",duration:2e3}),uni.switchTab({url:"/pages/tabBar/me/me"})):uni.showModal({title:"修改失败",content:t.message,showCancel:!1})},fail:e=>{uni.showModal({title:"错误",content:"网络请求失败，请稍后重试",showCancel:!1}),t("error","at pages/accountsetting/setstatus.vue:68","请求失败：",e)}})}}},[["render",function(t,o,s,n,i,l){const r=a(e.resolveDynamicComponent("uni-easyinput"),T),c=a(e.resolveDynamicComponent("uni-forms-item"),F),u=a(e.resolveDynamicComponent("uni-forms"),G);return e.openBlock(),e.createElementBlock("view",{class:"register"},[e.createVNode(u,{class:"form",modelValue:i.dataForm,rules:t.rules,"validate-trigger":"bind","label-width":"80px"},{default:e.withCtx((()=>[e.createVNode(c,{name:"status",label:"状态"},{default:e.withCtx((()=>[e.createVNode(r,{type:"text",modelValue:i.dataForm.status,"onUpdate:modelValue":o[0]||(o[0]=e=>i.dataForm.status=e),placeholder:"无状态"},null,8,["modelValue"]),e.createElementVNode("text",{class:"tip-text"},"将你的状态告诉你的好友")])),_:1}),e.createElementVNode("button",{class:"btn-submit",onClick:o[1]||(o[1]=(...e)=>l.submit&&l.submit(...e)),type:"primary"},"保存")])),_:1},8,["modelValue","rules"])])}],["__scopeId","data-v-ee14aff4"]]);const we=s({data:()=>({isexist:"null"!==uni.getStorageSync("cal"),dataForm:{cal:"null"===uni.getStorageSync("cal")?"":uni.getStorageSync("cal")}}),onLoad(){this.dataForm={cal:"null"===uni.getStorageSync("cal")?"":uni.getStorageSync("cal")}},methods:{submit(){const e={content:""===this.dataForm.cal?"null":this.dataForm.cal,userIds:[uni.getStorageSync("id")]};uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/profile/calendar",method:"POST",header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")},data:e,success:e=>{const t=e.data;t.status?(uni.setStorageSync("cal",this.dataForm.cal),uni.showToast({title:"添加成功",icon:"success",duration:2e3}),uni.switchTab({url:"/pages/tabBar/me/me"})):uni.showModal({title:"添加失败",content:t.message,showCancel:!1})},fail:e=>{uni.showModal({title:"错误",content:"网络请求失败，请稍后重试",showCancel:!1}),t("error","at pages/accountsetting/setcal.vue:74","请求失败：",e)}})},alter(){const e={content:""===this.dataForm.cal?"null":this.dataForm.cal,userIds:[uni.getStorageSync("id")]};uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/profile/calendar",method:"PUT",header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")},data:e,success:e=>{const t=e.data;t.status?(uni.setStorageSync("cal",this.dataForm.cal),uni.showToast({title:"修改成功",icon:"success",duration:2e3}),uni.switchTab({url:"/pages/tabBar/me/me"})):uni.showModal({title:"修改失败",content:t.message,showCancel:!1})},fail:e=>{uni.showModal({title:"错误",content:"网络请求失败，请稍后重试",showCancel:!1}),t("error","at pages/accountsetting/setcal.vue:119","请求失败：",e)}})},remove(){uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/profile/calendar",method:"DELETE",header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")},success:e=>{const t=e.data;t.status?(uni.setStorageSync("cal","null"),uni.showToast({title:"删除成功",icon:"success",duration:2e3}),uni.switchTab({url:"/pages/tabBar/me/me"})):uni.showModal({title:"删除失败",content:t.message,showCancel:!1})},fail:e=>{uni.showModal({title:"错误",content:"网络请求失败，请稍后重试",showCancel:!1}),t("error","at pages/accountsetting/setcal.vue:159","请求失败：",e)}})}}},[["render",function(t,o,s,n,i,l){const r=a(e.resolveDynamicComponent("uni-forms-item"),F),c=a(e.resolveDynamicComponent("uni-forms"),G);return e.openBlock(),e.createElementBlock("view",{class:"register"},[e.createVNode(c,{class:"form",modelValue:i.dataForm,rules:t.rules,"validate-trigger":"bind","label-width":"80px"},{default:e.withCtx((()=>[e.createVNode(r,{name:"cal",label:"日程"},{default:e.withCtx((()=>[e.withDirectives(e.createElementVNode("textarea",{class:"cal-textarea","onUpdate:modelValue":o[0]||(o[0]=e=>i.dataForm.cal=e),placeholder:"无日程"},null,512),[[e.vModelText,i.dataForm.cal]]),e.createElementVNode("text",{class:"tip-text"},"将你的日程告诉你的好友")])),_:1}),i.isexist?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn-submit",onClick:o[1]||(o[1]=(...e)=>l.submit&&l.submit(...e)),type:"primary"},"添加日程")),i.isexist?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn-submit",onClick:o[2]||(o[2]=(...e)=>l.alter&&l.alter(...e)),type:"primary"},"保存修改")):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"btn-submit",onClick:o[3]||(o[3]=(...e)=>l.remove&&l.remove(...e)),type:"warn"},"删除日程")])),_:1},8,["modelValue","rules"])])}],["__scopeId","data-v-e9a7022a"]]),Se="/static/me.jpg";const _e=s({data:()=>({isfriend:!1,id:"",nickname:"",username:""}),onLoad(e){this.id=e.id,this.nickname=e.nickname,this.username=e.username},methods:{onAddTap(){const e={contactUserId:this.id,contactType:"real"};t("log","at pages/detail/userdetail.vue:43",this.id),uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/contacts",method:"POST",header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")},data:e,success:e=>{const t=e.data;t.status&&(this.isfriend=!0),uni.showToast({title:t.message,icon:"none"})}})}}},[["render",function(t,a,o,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"top-section"},[e.createElementVNode("view",{class:"head-sculpture"},[e.createElementVNode("image",{src:Se})]),e.createElementVNode("view",{class:"right-section"},[e.createElementVNode("view",{class:"nickname"},"昵称："+e.toDisplayString(n.nickname),1),e.createElementVNode("view",{class:"username"},"用户名："+e.toDisplayString(n.username),1)])]),e.createElementVNode("view",{class:"add-friend"},[e.createElementVNode("button",{class:"add-button",onClick:a[0]||(a[0]=(...e)=>i.onAddTap&&i.onAddTap(...e)),disabled:n.isfriend},e.toDisplayString(n.isfriend?"已添加":"添加好友"),9,["disabled"])])])}],["__scopeId","data-v-a5b296e2"]]);const Ve=s({data:()=>({id:"",nickname:"",username:"",mood:"",status:""}),onLoad(e){this.id=e.id,this.nickname=e.nickname,this.username=e.username,this.chatId=e.chatId,"null"===e.mood||"添加心情"===e.mood?this.mood="无心情":this.mood=e.mood,"null"===e.status||"添加状态"===e.status?this.status="无状态":this.status=e.status},methods:{navigateToChatRoom(){uni.navigateTo({url:`/pages/tabBar/chats/chat-room?chatId=${this.chatId}`})}}},[["render",function(t,a,o,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"top-section"},[e.createElementVNode("view",{class:"head-sculpture"},[e.createElementVNode("image",{src:Se})]),e.createElementVNode("view",{class:"right-section"},[e.createElementVNode("view",{class:"nickname"},"昵称："+e.toDisplayString(n.nickname),1),e.createElementVNode("view",{class:"username"},"用户名："+e.toDisplayString(n.username),1)])]),e.createElementVNode("view",{class:"middle-section"},[e.createElementVNode("button",{class:"mood",onClick:a[0]||(a[0]=(...e)=>t.onMoodTap&&t.onMoodTap(...e))},e.toDisplayString(n.mood),1),e.createElementVNode("button",{class:"status",onClick:a[1]||(a[1]=(...e)=>t.onStatusTap&&t.onStatusTap(...e))},e.toDisplayString(n.status),1)]),e.createElementVNode("view",{class:"add-friend"},[e.createElementVNode("button",{class:"add-button",clickable:"",onClick:a[2]||(a[2]=e=>i.navigateToChatRoom())},"发消息")])])}],["__scopeId","data-v-331591d1"]]);const Ce=s({data:()=>({loading:!1,searchText:"",chats:[],filteredChats:[]}),methods:{async loadChats(){this.loading=!0;try{const e=await uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/characters",method:"GET",header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")}});this.chats=e.data.value||[],this.filteredChats=this.chats}catch(e){t("error","at pages/tabBar/ai/contacts.vue:61","Failed to load chats:",e),uni.showToast({title:"Error loading chats",icon:"none"})}finally{this.loading=!1}},async createChat(){this.loading=!0;try{const e=await uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/chat",method:"POST",data:{chatName:"chat with AI",type:"virtual"},header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")}});uni.navigateTo({url:`/pages/tabBar/chats/chat-room?chatId=${e.data.value.id}&actionType=virtual`})}catch(e){t("error","at pages/tabBar/ai/contacts.vue:91","Failed to create AI chat:",e),uni.showToast({title:"Error creating chat",icon:"none"})}finally{this.loading=!1}},onSearch(){""===this.searchText.trim()?this.filteredChats=this.chats:this.filteredChats=this.chats.filter((e=>e.chatName.toLowerCase().includes(this.searchText.toLowerCase())))},openChatRoom(e){e.chatId?uni.navigateTo({url:`/pages/tabBar/chats/chat-room?chatId=${e.chatId}&characterId=${e.id}&actionType=virtual`}):uni.showToast({title:"Character error",icon:"error"})},onAddNewFriends(){uni.navigateTo({url:"/pages/tabBar/contacts/add-friend"})}},created(){this.loadChats()}},[["render",function(t,o,s,i,l,r){const c=a(e.resolveDynamicComponent("uni-search-bar"),k),u=a(e.resolveDynamicComponent("uni-icons"),n);return e.openBlock(),e.createElementBlock("view",{class:"container"},[l.loading?(e.openBlock(),e.createElementBlock("view",{key:0,class:"chat-loading"},[e.createElementVNode("view",{size:50,mask:!1},[e.createElementVNode("view",null,"Starting AI chat, please wait...")])])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"nav-bar"},[e.createElementVNode("view",{class:"nav-search"},[e.createVNode(c,{modelValue:l.searchText,"onUpdate:modelValue":o[0]||(o[0]=e=>l.searchText=e),radius:"100",cancelButton:"none",placeholder:"Search virtual chats",onConfirm:r.onSearch},null,8,["modelValue","onConfirm"])]),e.createElementVNode("view",{class:"nav-startAi",onClick:o[1]||(o[1]=(...e)=>r.createChat&&r.createChat(...e))}," Start now with AI "),e.createElementVNode("view",{class:"nav-add",onClick:o[2]||(o[2]=(...e)=>r.onAddNewFriends&&r.onAddNewFriends(...e))},[e.createVNode(u,{type:"personadd",size:"35"})])]),l.chats.length>0?(e.openBlock(),e.createElementBlock("view",{key:1,class:"chat-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.filteredChats,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"chat-item",onClick:e=>r.openChatRoom(t)},[e.createElementVNode("view",{class:"chat-name"},e.toDisplayString(t.name),1)],8,["onClick"])))),128))])):(e.openBlock(),e.createElementBlock("view",{key:2},[e.createElementVNode("view",{class:"no-chats"},"No virtual chats found.")]))])}],["__scopeId","data-v-3e737664"]]);const Ne=s({data:()=>({profile:null,inputMessage:"",scrollTop:0,messages:null,loading:!0}),onLoad(e){this.chatId=e.chatId,this.actionType="virtual"===e.actionType?"sendOpenai":"sendMessage",this.characterId=e.characterId||null,this.initializeProfile()},methods:{async initializeProfile(){const e=re();this.profile=e.profile,this.profile?(await this.fetchInitialMessages(),this.setupSocketConnection()):t("error","at pages/tabBar/chats/chat-room.vue:80","Profile not loaded. Please check authentication.")},async fetchInitialMessages(){try{const e=await this.fetchNewMessages(1);this.messages=e.value,this.scrollToBottom()}catch(e){t("error","at pages/tabBar/chats/chat-room.vue:90","Error fetching initial messages:",e)}},async fetchNewMessages(e=1){try{return(await new Promise(((t,a)=>{uni.request({url:`https://gal-chat-test-970e995e1901.herokuapp.com/api/chat/messages/${this.chatId}?page=${e}&limit=30`,method:"GET",header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")},success:e=>t(e),fail:e=>a(e)})}))).data}catch(a){return t("error","at pages/tabBar/chats/chat-room.vue:111","Error fetching messages:",a),{data:[]}}},sendMessage(){this.inputMessage.trim()&&(this.socketTask.send({data:JSON.stringify({event:this.actionType,data:{chatId:this.chatId,userId:this.profile.id,characterId:this.characterId,message:this.inputMessage.trim()}})}),t("log","at pages/tabBar/chats/chat-room.vue:134",this.actionType,this.inputMessage.trim()),this.inputMessage="",this.$nextTick((()=>{this.scrollToBottom()})))},scrollToBottom(){uni.createSelectorQuery().in(this).select(".message-list").boundingClientRect((e=>{this.scrollTop=e.height})).exec()},async loadMoreMessages(){if(this.messages.totalPages>this.messages.currentPage)try{const e=await this.fetchNewMessages(this.messages.currentPage+1),t=[...this.messages.data];this.messages=e.value,this.messages.data=[...this.messages.data,...t]}catch(e){t("error","at pages/tabBar/chats/chat-room.vue:161","Error loading more messages:",e)}},setupSocketConnection(){try{this.socketTask=uni.connectSocket({url:"https://gal-chat-test-970e995e1901.herokuapp.com",complete:e=>t("log","at pages/tabBar/chats/chat-room.vue:170","complete",e),success:()=>{t("log","at pages/tabBar/chats/chat-room.vue:172","WebSocket connection initiated"),this.loading=!1}}),t("log","at pages/tabBar/chats/chat-room.vue:176","this.socketTask",this.socketTask),this.socketTask.onOpen((()=>{t("log","at pages/tabBar/chats/chat-room.vue:178","WebSocket connection opened"),this.socketTask.send({data:JSON.stringify({event:"joinChat",data:{chatId:this.chatId,userId:this.profile.id}})})})),this.socketTask.onMessage((e=>{try{const a=JSON.parse(e.data);"newMessage"===a.event&&(t("log","at pages/tabBar/chats/chat-room.vue:195","New message received:",a.data),this.messages.data=[...this.messages.data,a.data])}catch(a){t("error","at pages/tabBar/chats/chat-room.vue:199","Error parsing message:",a)}})),t("log","at pages/tabBar/chats/chat-room.vue:203","setupSocketConnection")}catch(e){t("error","at pages/tabBar/chats/chat-room.vue:205","Socket connection error:",e)}}},onUnload(){this.socketTask&&(this.socketTask.close({success:()=>{t("log","at pages/tabBar/chats/chat-room.vue:214","WebSocket connection closed")},fail:e=>{t("error","at pages/tabBar/chats/chat-room.vue:217","Failed to close WebSocket connection:",e)}}),this.socketTask.onOpen(null),this.socketTask.onMessage(null),this.socketTask.onError(null),this.socketTask.onClose(null))}},[["render",function(t,a,o,s,n,i){var l;return e.openBlock(),e.createElementBlock("view",{class:"chat-container"},[n.loading?(e.openBlock(),e.createElementBlock("view",{key:0,class:"chat-loading"},[e.createElementVNode("view",{size:50,mask:!1},[e.createElementVNode("view",null,"Starting chat, please wait...")])])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"chat-header"},[e.createElementVNode("text",{class:"header-title"},"张三AI")]),e.createElementVNode("scroll-view",{class:"chat-messages","scroll-y":"true","scroll-top":n.scrollTop,"scroll-with-animation":!0,onScrolltoupper:a[0]||(a[0]=(...e)=>i.loadMoreMessages&&i.loadMoreMessages(...e))},[e.createElementVNode("view",{class:"message-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList((null==(l=n.messages)?void 0:l.data)||[],((t,a)=>{var o;return e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["message-item",(null==t?void 0:t.userId)===(null==(o=n.profile)?void 0:o.id)?"message-right":"message-left"])},[e.createElementVNode("image",{class:"avatar",src:t.avatar,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"message-box"},[e.createElementVNode("view",{class:"sender-box"},[e.createElementVNode("text",{class:"sender-text"},e.toDisplayString(t.sender),1)]),e.createElementVNode("view",{class:"message-content"},[e.createElementVNode("text",{class:"message-text"},e.toDisplayString(t.message),1)])])],2)})),128))])],40,["scroll-top"]),e.createElementVNode("view",{class:"chat-footer"},[e.createElementVNode("view",{class:"input-box"},[e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":a[1]||(a[1]=e=>n.inputMessage=e),"confirm-type":"send",onConfirm:a[2]||(a[2]=(...e)=>i.sendMessage&&i.sendMessage(...e)),placeholder:"请输入消息",class:"message-input"},null,544),[[e.vModelText,n.inputMessage]]),e.createElementVNode("button",{disabled:n.loading,class:e.normalizeClass(["send-btn",{active:n.inputMessage.length>0}]),onClick:a[3]||(a[3]=(...e)=>i.sendMessage&&i.sendMessage(...e))},"发送",10,["disabled"])])])])}]]);__definePage("pages/tabBar/chats/chats",S),__definePage("pages/tabBar/contacts/contacts",N),__definePage("pages/tabBar/me/me",B),__definePage("pages/log/log/log",x),__definePage("pages/log/login/login",ce),__definePage("pages/log/register/register",ue),__definePage("pages/tabBar/chats/chat-box",de),__definePage("pages/tabBar/contacts/newVirtualFriend",me),__definePage("pages/tabBar/contacts/newRealFriend",he),__definePage("pages/tabBar/contacts/groupChat",pe),__definePage("pages/tabBar/me/accountSetting",ge),__definePage("pages/accountsetting/setnickname",fe),__definePage("pages/accountsetting/setaccount",ye),__definePage("pages/accountsetting/setpassword",be),__definePage("pages/accountsetting/setmood",ke),__definePage("pages/accountsetting/setstatus",ve),__definePage("pages/accountsetting/setcal",we),__definePage("pages/detail/userdetail",_e),__definePage("pages/detail/frienddetail",Ve),__definePage("pages/tabBar/ai/contacts",Ce),__definePage("pages/tabBar/chats/chat-room",Ne);const Be={setup(){if(uni.getStorageSync("token")){re().initializeProfile()}},onLaunch:function(){t("warn","at App.vue:15","当前组件仅支持 uni_modules 目录结构 ，请升级 HBuilderX 到 3.1.0 版本以上！"),t("log","at App.vue:16","App Launch")},onShow:function(){t("log","at App.vue:19","App Show")},onHide:function(){t("log","at App.vue:22","App Hide")}};const{app:xe,Vuex:Ee,Pinia:Te}=function(){const t=e.createVueApp(Be);return t.use(function(){const t=e.effectScope(!0),a=t.run((()=>e.ref({})));let o=[],s=[];const n=e.markRaw({install(e){K(n),n._a=e,e.provide(Q,n),e.config.globalProperties.$pinia=n,s.forEach((e=>o.push(e))),s=[]},use(e){return this._a?o.push(e):s.push(e),this},_p:o,_a:null,_e:t,_s:new Map,state:a});return n}()),{app:t}}();uni.Vuex=Ee,uni.Pinia=Te,xe.provide("__globalStyles",__uniConfig.styles),xe._component.mpType="app",xe._component.render=()=>{},xe.mount("#app")}(Vue);
=======
let P;const D=e=>P=e,A=Symbol();function L(e){return e&&"object"==typeof e&&"[object Object]"===Object.prototype.toString.call(e)&&"function"!=typeof e.toJSON}var j,z;(z=j||(j={})).direct="direct",z.patchObject="patch object",z.patchFunction="patch function";const O=()=>{};function R(t,a,o,s=O){t.push(a);const n=()=>{const e=t.indexOf(a);e>-1&&(t.splice(e,1),s())};return!o&&e.getCurrentScope()&&e.onScopeDispose(n),n}function q(e,...t){e.slice().forEach((e=>{e(...t)}))}const U=e=>e();function W(t,a){t instanceof Map&&a instanceof Map&&a.forEach(((e,a)=>t.set(a,e))),t instanceof Set&&a instanceof Set&&a.forEach(t.add,t);for(const o in a){if(!a.hasOwnProperty(o))continue;const s=a[o],n=t[o];L(n)&&L(s)&&t.hasOwnProperty(o)&&!e.isRef(s)&&!e.isReactive(s)?t[o]=W(n,s):t[o]=s}return t}const G=Symbol();const{assign:H}=Object;function J(t,a,o={},s,n,i){let l;const r=H({actions:{}},o),c={deep:!0};let u,d,m,h=[],p=[];const g=s.state.value[t];let f;function y(a){let o;u=d=!1,"function"==typeof a?(a(s.state.value[t]),o={type:j.patchFunction,storeId:t,events:m}):(W(s.state.value[t],a),o={type:j.patchObject,payload:a,storeId:t,events:m});const n=f=Symbol();e.nextTick().then((()=>{f===n&&(u=!0)})),d=!0,q(h,o,s.state.value[t])}i||g||(s.state.value[t]={}),e.ref({});const b=i?function(){const{state:e}=o,t=e?e():{};this.$patch((e=>{H(e,t)}))}:O;function k(e,a){return function(){D(s);const o=Array.from(arguments),n=[],i=[];function l(e){n.push(e)}function r(e){i.push(e)}let c;q(p,{args:o,name:e,store:w,after:l,onError:r});try{c=a.apply(this&&this.$id===t?this:w,o)}catch(u){throw q(i,u),u}return c instanceof Promise?c.then((e=>(q(n,e),e))).catch((e=>(q(i,e),Promise.reject(e)))):(q(n,c),c)}}const v={_p:s,$id:t,$onAction:R.bind(null,p),$patch:y,$reset:b,$subscribe(a,o={}){const n=R(h,a,o.detached,(()=>i())),i=l.run((()=>e.watch((()=>s.state.value[t]),(e=>{("sync"===o.flush?d:u)&&a({storeId:t,type:j.direct,events:m},e)}),H({},c,o))));return n},$dispose:function(){l.stop(),h=[],p=[],s._s.delete(t)}},w=e.reactive(v);s._s.set(t,w);const S=(s._a&&s._a.runWithContext||U)((()=>s._e.run((()=>(l=e.effectScope()).run(a)))));for(const C in S){const a=S[C];if(e.isRef(a)&&(V=a,!e.isRef(V)||!V.effect)||e.isReactive(a))i||(!g||L(_=a)&&_.hasOwnProperty(G)||(e.isRef(a)?a.value=g[C]:W(a,g[C])),s.state.value[t][C]=a);else if("function"==typeof a){const e=k(C,a);S[C]=e,r.actions[C]=a}}var _,V;return H(w,S),H(e.toRaw(w),S),Object.defineProperty(w,"$state",{get:()=>s.state.value[t],set:e=>{y((t=>{H(t,e)}))}}),s._p.forEach((e=>{H(w,l.run((()=>e({store:w,app:s._a,pinia:s,options:r}))))})),g&&i&&o.hydrate&&o.hydrate(w.$state,g),u=!0,d=!0,w}const K=function(t,a,o){let s,n;const i="function"==typeof a;function l(t,o){const l=e.hasInjectionContext();(t=t||(l?e.inject(A,null):null))&&D(t),(t=P)._s.has(s)||(i?J(s,a,n,t):function(t,a,o,s){const{state:n,actions:i,getters:l}=a,r=o.state.value[t];let c;c=J(t,(function(){r||(o.state.value[t]=n?n():{});const a=e.toRefs(o.state.value[t]);return H(a,i,Object.keys(l||{}).reduce(((a,s)=>(a[s]=e.markRaw(e.computed((()=>{D(o);const e=o._s.get(t);return l[s].call(e,e)}))),a)),{}))}),a,o,0,!0)}(s,n,t));return t._s.get(s)}return"string"==typeof t?(s=t,n=i?o:a):(n=t,s=t.id),l.$id=s,l}("profile",{state:()=>({profile:null}),actions:{async getProfile(){try{uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/profile",method:"GET",header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")},success:e=>{this.profile=e.data.value}})}catch(e){t("error","at stores/profile.js:24","Error fetching profile:",e)}},async initializeProfile(){if(!this.profile)try{await this.getProfile()}catch(e){t("log","at stores/profile.js:33",e)}}}});const Q=o({data:()=>({loginForm:{phoneNum:"",password:""},rules:{phoneNum:{rules:[{required:!0,errorMessage:"请输入用户名"}]},password:{rules:[{required:!0,errorMessage:"请输入密码"}]}}}),methods:{submit(){const e={username:this.loginForm.phoneNum,password:this.loginForm.password};uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/identity/login",method:"POST",header:{"Content-Type":"application/json"},data:e,success:t=>{const a=t.data;if(a.status){uni.showToast({title:"登录成功",icon:"success"}),uni.setStorageSync("token",a.value.accessToken),uni.setStorageSync("refresh",a.value.accessToken);K().getProfile(),uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/profile",method:"GET",header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")},success:t=>{const a=t.data;uni.setStorageSync("id",a.value.id),uni.setStorageSync("nickname",a.value.nickname),uni.setStorageSync("username",a.value.username),uni.setStorageSync("password",e.password)}}),uni.switchTab({url:"/pages/tabBar/chats/chats"})}else uni.showModal({title:"提示",content:a.message,showCancel:!1})},fail:e=>{uni.showToast({title:"网络请求失败",icon:"error"}),t("error","at pages/log/login/login.vue:115","请求失败：",e)}})}}},[["render",function(t,o,s,n,i,l){const r=a(e.resolveDynamicComponent("uni-easyinput"),y),c=a(e.resolveDynamicComponent("uni-forms-item"),b),u=a(e.resolveDynamicComponent("uni-forms"),$);return e.openBlock(),e.createElementBlock("view",{class:"page login"},[e.createElementVNode("view",{class:"title"},"欢迎登录"),e.createVNode(u,{class:"form",modelValue:i.loginForm,rules:i.rules,"validate-trigger":"bind"},{default:e.withCtx((()=>[e.createVNode(c,{name:"phoneNum"},{default:e.withCtx((()=>[e.createVNode(r,{type:"text",modelValue:i.loginForm.phoneNum,"onUpdate:modelValue":o[0]||(o[0]=e=>i.loginForm.phoneNum=e),"prefix-icon":"person",placeholder:"用户名"},null,8,["modelValue"])])),_:1}),e.createVNode(c,{name:"password"},{default:e.withCtx((()=>[e.createVNode(r,{type:"password",modelValue:i.loginForm.password,"onUpdate:modelValue":o[1]||(o[1]=e=>i.loginForm.password=e),"prefix-icon":"locked",placeholder:"密码"},null,8,["modelValue"])])),_:1}),e.createElementVNode("button",{class:"btn-submit",onClick:o[2]||(o[2]=(...e)=>l.submit&&l.submit(...e)),type:"primary"},"登录")])),_:1},8,["modelValue","rules"]),e.createElementVNode("navigator",{class:"nav-register",url:"/pages/log/register/register","open-type":"redirect"}," 没有账号？前往注册 ")])}],["__scopeId","data-v-c72614c1"]]);const X=o({data:()=>({isValid:!1,dataForm:{userName:"",nickName:"",phoneNum:"",code:"",password:"",confirmPassword:""},rules:{userName:{rules:[{required:!0,errorMessage:"请输入用户名"},{minLength:6,errorMessage:"用户名不能少于6个字符"}]},nickName:{rules:[{required:!0,errorMessage:"请输入昵称"}]},phoneNum:{rules:[{required:!0,errorMessage:"请输入手机号"}]},code:{rules:[{required:!0,errorMessage:"请输入验证码"}]},password:{rules:[{required:!0,errorMessage:"请输入密码"},{minLength:6,errorMessage:"密码不能少于6个字符"}]},confirmPassword:{rules:[{required:!0,errorMessage:"请输入确认密码"},{validateFunction:(e,a,o,s)=>(t("log","at pages/log/register/register.vue:92","validateFunction"),o.password!=a&&s("两次密码输入不一致"),!0)}]}}}),watch:{dataForm:{handler(e,t){""!=this.dataForm.userName&&""!=this.dataForm.nickname&&""!=this.dataForm.phoneNum&&""!=this.dataForm.code&&""!=this.dataForm.password&&this.dataForm.password==this.dataForm.confirmPassword?this.isValid=!0:this.isValid=!1},deep:!0}},methods:{submit(){t("log","at pages/log/register/register.vue:119","submitted");const e={username:this.dataForm.userName,password:this.dataForm.password,nickname:this.dataForm.nickName,phone:this.dataForm.phoneNum,code:this.dataForm.code};uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/identity/register",method:"POST",header:{"Content-Type":"application/json"},data:e,success:e=>{const t=e.data;t.status?(uni.showToast({title:"注册成功",icon:"success",duration:2e3}),this.login()):uni.showModal({title:"注册失败",content:t.message,showCancel:!1})},fail:e=>{uni.showModal({title:"错误",content:"网络请求失败，请稍后重试",showCancel:!1}),t("error","at pages/log/register/register.vue:159","注册请求失败：",e)}})},login(){const e={username:this.dataForm.userName,password:this.dataForm.password};uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/identity/login",method:"POST",header:{"Content-Type":"application/json"},data:e,success:e=>{const t=e.data;t.status?(uni.showToast({title:t.message,icon:"success"}),uni.setStorageSync("token",t.value.accessToken),uni.setStorageSync("refresh",t.value.accessToken),uni.switchTab({url:"/pages/tabBar/chats/chats"})):uni.showModal({title:"提示",content:t.message,showCancel:!1})},fail:e=>{uni.showToast({title:"网络请求失败",icon:"error"}),t("error","at pages/log/register/register.vue:208","请求失败：",e)}})},getVerificationCode(){uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/identity/sendCode",method:"POST",header:{"Content-Type":"application/json"},data:{phone:this.dataForm.phoneNum},success:e=>{const t=e.data;t.status?uni.showToast({title:"发送成功",icon:"success",duration:2e3}):uni.showModal({title:"发送失败",content:t.message,showCancel:!1})},fail:e=>{uni.showModal({title:"错误",content:"发送验证码失败，请稍后重试",showCancel:!1}),t("error","at pages/log/register/register.vue:247","发送验证码失败：",e)}})}}},[["render",function(t,o,s,n,i,l){const r=a(e.resolveDynamicComponent("uni-easyinput"),y),c=a(e.resolveDynamicComponent("uni-forms-item"),b),u=a(e.resolveDynamicComponent("uni-forms"),$);return e.openBlock(),e.createElementBlock("view",{class:"register"},[e.createElementVNode("view",{class:"title"},"欢迎注册"),e.createVNode(u,{class:"form",modelValue:i.dataForm,rules:i.rules,"validate-trigger":"bind","label-width":"80px"},{default:e.withCtx((()=>[e.createVNode(c,{name:"userName",label:"用户名"},{default:e.withCtx((()=>[e.createVNode(r,{type:"text",modelValue:i.dataForm.userName,"onUpdate:modelValue":o[0]||(o[0]=e=>i.dataForm.userName=e),placeholder:"用户名"},null,8,["modelValue"])])),_:1}),e.createVNode(c,{name:"nickName",label:"昵称"},{default:e.withCtx((()=>[e.createVNode(r,{type:"text",modelValue:i.dataForm.nickName,"onUpdate:modelValue":o[1]||(o[1]=e=>i.dataForm.nickName=e),placeholder:"昵称"},null,8,["modelValue"])])),_:1}),e.createVNode(c,{name:"phoneNum",label:"手机号"},{default:e.withCtx((()=>[e.createVNode(r,{type:"number",modelValue:i.dataForm.phoneNum,"onUpdate:modelValue":o[2]||(o[2]=e=>i.dataForm.phoneNum=e),placeholder:"手机号"},null,8,["modelValue"])])),_:1}),e.createVNode(c,{name:"code",label:"验证码"},{default:e.withCtx((()=>[e.createVNode(r,{type:"number",modelValue:i.dataForm.code,"onUpdate:modelValue":o[4]||(o[4]=e=>i.dataForm.code=e),placeholder:"验证码"},{right:e.withCtx((()=>[e.createElementVNode("button",{disabled:11!=i.dataForm.phoneNum.length,onClick:o[3]||(o[3]=(...e)=>l.getVerificationCode&&l.getVerificationCode(...e)),class:"btn-get-code"},"获取验证码",8,["disabled"])])),_:1},8,["modelValue"])])),_:1}),e.createVNode(c,{name:"password",label:"密码"},{default:e.withCtx((()=>[e.createVNode(r,{type:"password",modelValue:i.dataForm.password,"onUpdate:modelValue":o[5]||(o[5]=e=>i.dataForm.password=e),placeholder:"密码"},null,8,["modelValue"])])),_:1}),e.createVNode(c,{name:"confirmPassword",label:"确认密码"},{default:e.withCtx((()=>[e.createVNode(r,{type:"password",modelValue:i.dataForm.confirmPassword,"onUpdate:modelValue":o[6]||(o[6]=e=>i.dataForm.confirmPassword=e),placeholder:"确认密码"},null,8,["modelValue"])])),_:1}),e.createElementVNode("button",{class:"btn-submit",disabled:!i.isValid,onClick:o[7]||(o[7]=(...e)=>l.submit&&l.submit(...e)),type:"warn"},"注册并登录",8,["disabled"])])),_:1},8,["modelValue","rules"]),e.createElementVNode("navigator",{class:"nav-login",url:"/pages/log/login/login","open-type":"redirect"}," 已有账号？前往登录 ")])}],["__scopeId","data-v-c7305eef"]]);const Y=o({data:()=>({inputMessage:"",scrollTop:0,messageList:[{id:1,content:"你好！",isSelf:!1,avatar:"/static/c1.png",time:new Date},{id:2,content:"你好！很高兴见到你！",isSelf:!0,avatar:"/static/c2.png",time:new Date}]}),methods:{sendMessage(){this.inputMessage.trim()&&(this.messageList.push({id:this.messageList.length+1,content:this.inputMessage,isSelf:!0,avatar:"/static/c2.png",time:new Date}),this.inputMessage="",this.$nextTick((()=>{this.scrollToBottom()})),setTimeout((()=>{this.messageList.push({id:this.messageList.length+1,content:"收到你的消息了！",isSelf:!1,avatar:"/static/c1.png",time:new Date}),this.scrollToBottom()}),1e3))},scrollToBottom(){uni.createSelectorQuery().in(this).select(".message-list").boundingClientRect((e=>{this.scrollTop=e.height})).exec()},loadMoreMessages(){t("log","at pages/tabBar/chats/chat-box.vue:126","加载更多消息")}},mounted(){this.scrollToBottom()}},[["render",function(t,a,o,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:"chat-container"},[e.createElementVNode("view",{class:"chat-header"},[e.createElementVNode("text",{class:"header-title"},"聊天")]),e.createElementVNode("scroll-view",{class:"chat-messages","scroll-y":"true","scroll-top":n.scrollTop,"scroll-with-animation":!0,onScrolltoupper:a[0]||(a[0]=(...e)=>i.loadMoreMessages&&i.loadMoreMessages(...e))},[e.createElementVNode("view",{class:"message-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.messageList,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["message-item",t.isSelf?"message-right":"message-left"])},[e.createElementVNode("image",{class:"avatar",src:t.avatar,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"message-content"},[e.createElementVNode("text",{class:"message-text"},e.toDisplayString(t.content),1)])],2)))),128))])],40,["scroll-top"]),e.createElementVNode("view",{class:"chat-footer"},[e.createElementVNode("view",{class:"input-box"},[e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":a[1]||(a[1]=e=>n.inputMessage=e),"confirm-type":"send",onConfirm:a[2]||(a[2]=(...e)=>i.sendMessage&&i.sendMessage(...e)),placeholder:"请输入消息",class:"message-input"},null,544),[[e.vModelText,n.inputMessage]]),e.createElementVNode("button",{class:e.normalizeClass(["send-btn",{active:n.inputMessage.length>0}]),onClick:a[3]||(a[3]=(...e)=>i.sendMessage&&i.sendMessage(...e))},"发送",2)])])])}]]);const Z=o({data:()=>({range:Array.from({length:10},((e,t)=>t+1)),character:{name:"",personality:{sociability:5,shyness:5,calmness:5,optimism:5,empathy:5,curiosity:5,logic:5,creativity:5,patience:5,aggressiveness:5,humor:5,ambition:5,resilience:5,trustworthiness:5}},isSubmitting:!1,nameError:!1}),methods:{updatePersonality(e,t){const a=this.range[t.detail.value];this.character.personality[e]=a},translateKey:e=>({sociability:"Sociability",shyness:"Shyness",calmness:"Calmness",optimism:"Optimism",empathy:"Empathy",curiosity:"Curiosity",logic:"Logic",creativity:"Creativity",patience:"Patience",aggressiveness:"Aggressiveness",humor:"Humor",ambition:"Ambition",resilience:"Resilience",trustworthiness:"Trustworthiness"}[e]||e),async submitCharacter(){if(this.character.name.trim()){this.nameError=!1,this.isSubmitting=!0;try{t("log","at pages/tabBar/contacts/newVirtualFriend.vue:90","Created character:",this.character);const e=await uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/characters",method:"POST",data:{name:this.character.name,personality:this.character.personality},header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")}});uni.showToast({title:"Character created!",icon:"success"}),uni.navigateTo({url:`/pages/tabBar/chats/chat-room?chatId=${e.data.value.chatId}&actionType=virtual&characterId=${e.data.value.id}`})}catch(e){t("error","at pages/tabBar/contacts/newVirtualFriend.vue:114","Error creating character:",e),uni.showToast({title:"Error creating character",icon:"error"})}finally{this.isSubmitting=!1}}else this.nameError=!0}}},[["render",function(t,a,o,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("text",{class:"label"},"Character Name:"),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>n.character.name=e),type:"text",placeholder:"Enter character name",class:"input"},null,512),[[e.vModelText,n.character.name]]),n.nameError?(e.openBlock(),e.createElementBlock("text",{key:0,class:"error"},"Name is required")):e.createCommentVNode("",!0)]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.character.personality,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"form-group",key:a},[e.createElementVNode("text",{class:"label"},e.toDisplayString(i.translateKey(a))+":",1),e.createElementVNode("picker",{mode:"selector",range:n.range,value:t-1,onChange:e=>i.updatePersonality(a,e),class:"selector"},[e.createElementVNode("view",{class:"picker-text"},e.toDisplayString(t),1)],40,["range","value","onChange"])])))),128)),e.createElementVNode("button",{onClick:a[1]||(a[1]=(...e)=>i.submitCharacter&&i.submitCharacter(...e)),class:"submit-button",disabled:n.isSubmitting},[n.isSubmitting?(e.openBlock(),e.createElementBlock("view",{key:0},"Creating...")):(e.openBlock(),e.createElementBlock("view",{key:1},"Create Character"))],8,["disabled"])])}],["__scopeId","data-v-d7c2a7ec"]]),ee=["{","}"];const te=/^(?:\d)+/,ae=/^(?:\w)+/;const oe="zh-Hans",se="zh-Hant",ne="en",ie=Object.prototype.hasOwnProperty,le=(e,t)=>ie.call(e,t),re=new class{constructor(){this._caches=Object.create(null)}interpolate(e,t,a=ee){if(!t)return[e];let o=this._caches[e];return o||(o=function(e,[t,a]){const o=[];let s=0,n="";for(;s<e.length;){let i=e[s++];if(i===t){n&&o.push({type:"text",value:n}),n="";let t="";for(i=e[s++];void 0!==i&&i!==a;)t+=i,i=e[s++];const l=i===a,r=te.test(t)?"list":l&&ae.test(t)?"named":"unknown";o.push({value:t,type:r})}else n+=i}return n&&o.push({type:"text",value:n}),o}(e,a),this._caches[e]=o),function(e,t){const a=[];let o=0;const s=Array.isArray(t)?"list":(n=t,null!==n&&"object"==typeof n?"named":"unknown");var n;if("unknown"===s)return a;for(;o<e.length;){const n=e[o];switch(n.type){case"text":a.push(n.value);break;case"list":a.push(t[parseInt(n.value,10)]);break;case"named":"named"===s&&a.push(t[n.value])}o++}return a}(o,t)}};function ce(e,t){if(!e)return;if(e=e.trim().replace(/_/g,"-"),t&&t[e])return e;if("chinese"===(e=e.toLowerCase()))return oe;if(0===e.indexOf("zh"))return e.indexOf("-hans")>-1?oe:e.indexOf("-hant")>-1?se:(a=e,["-tw","-hk","-mo","-cht"].find((e=>-1!==a.indexOf(e)))?se:oe);var a;let o=[ne,"fr","es"];t&&Object.keys(t).length>0&&(o=Object.keys(t));const s=function(e,t){return t.find((t=>0===e.indexOf(t)))}(e,o);return s||void 0}class ue{constructor({locale:e,fallbackLocale:t,messages:a,watcher:o,formater:s}){this.locale=ne,this.fallbackLocale=ne,this.message={},this.messages={},this.watchers=[],t&&(this.fallbackLocale=t),this.formater=s||re,this.messages=a||{},this.setLocale(e||ne),o&&this.watchLocale(o)}setLocale(e){const t=this.locale;this.locale=ce(e,this.messages)||this.fallbackLocale,this.messages[this.locale]||(this.messages[this.locale]={}),this.message=this.messages[this.locale],t!==this.locale&&this.watchers.forEach((e=>{e(this.locale,t)}))}getLocale(){return this.locale}watchLocale(e){const t=this.watchers.push(e)-1;return()=>{this.watchers.splice(t,1)}}add(e,t,a=!0){const o=this.messages[e];o?a?Object.assign(o,t):Object.keys(t).forEach((e=>{le(o,e)||(o[e]=t[e])})):this.messages[e]=t}f(e,t,a){return this.formater.interpolate(e,t,a).join("")}t(e,t,a){let o=this.message;return"string"==typeof t?(t=ce(t,this.messages))&&(o=this.messages[t]):a=t,le(o,e)?this.formater.interpolate(o[e],a).join(""):(console.warn(`Cannot translate the value of keypath ${e}. Use the value of keypath as default.`),e)}}const de={en:{"uni-search-bar.cancel":"cancel","uni-search-bar.placeholder":"Search enter content"},"zh-Hans":{"uni-search-bar.cancel":"取消","uni-search-bar.placeholder":"请输入搜索内容"},"zh-Hant":{"uni-search-bar.cancel":"取消","uni-search-bar.placeholder":"請輸入搜索內容"}},{t:me}=function(e,t={},a,o){if("string"!=typeof e){const a=[t,e];e=a[0],t=a[1]}"string"!=typeof e&&(e="undefined"!=typeof uni&&uni.getLocale?uni.getLocale():"undefined"!=typeof global&&global.getLocale?global.getLocale():ne),"string"!=typeof a&&(a="undefined"!=typeof __uniConfig&&__uniConfig.fallbackLocale||ne);const s=new ue({locale:e,fallbackLocale:a,messages:t,watcher:o});let n=(e,t)=>{if("function"!=typeof getApp)n=function(e,t){return s.t(e,t)};else{let e=!1;n=function(t,a){const o=getApp().$vm;return o&&(o.$locale,e||(e=!0,function(e,t){e.$watchLocale?e.$watchLocale((e=>{t.setLocale(e)})):e.$watch((()=>e.$locale),(e=>{t.setLocale(e)}))}(o,s))),s.t(t,a)}}return n(e,t)};return{i18n:s,f:(e,t,a)=>s.f(e,t,a),t:(e,t)=>n(e,t),add:(e,t,a=!0)=>s.add(e,t,a),watch:e=>s.watchLocale(e),getLocale:()=>s.getLocale(),setLocale:e=>s.setLocale(e)}}(de);const he=o({name:"UniSearchBar",emits:["input","update:modelValue","clear","cancel","confirm","blur","focus"],props:{placeholder:{type:String,default:""},radius:{type:[Number,String],default:5},clearButton:{type:String,default:"auto"},cancelButton:{type:String,default:"auto"},cancelText:{type:String,default:""},bgColor:{type:String,default:"#F8F8F8"},textColor:{type:String,default:"#000000"},maxlength:{type:[Number,String],default:100},value:{type:[Number,String],default:""},modelValue:{type:[Number,String],default:""},focus:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1}},data:()=>({show:!1,showSync:!1,searchVal:""}),computed:{cancelTextI18n(){return this.cancelText||me("uni-search-bar.cancel")},placeholderText(){return this.placeholder||me("uni-search-bar.placeholder")}},watch:{modelValue:{immediate:!0,handler(e){this.searchVal=e,e&&(this.show=!0)}},focus:{immediate:!0,handler(e){if(e){if(this.readonly)return;this.show=!0,this.$nextTick((()=>{this.showSync=!0}))}}},searchVal(e,t){this.$emit("input",e),this.$emit("update:modelValue",e)}},methods:{searchClick(){this.readonly||this.show||(this.show=!0,this.$nextTick((()=>{this.showSync=!0})))},clear(){this.searchVal="",this.$nextTick((()=>{this.$emit("clear",{value:""})}))},cancel(){this.readonly||(this.$emit("cancel",{value:this.searchVal}),this.searchVal="",this.show=!1,this.showSync=!1,plus.key.hideSoftKeybord())},confirm(){plus.key.hideSoftKeybord(),this.$emit("confirm",{value:this.searchVal})},blur(){plus.key.hideSoftKeybord(),this.$emit("blur",{value:this.searchVal})},emitFocus(e){this.$emit("focus",e.detail)}}},[["render",function(t,o,s,n,l,r){const c=a(e.resolveDynamicComponent("uni-icons"),i);return e.openBlock(),e.createElementBlock("view",{class:"uni-searchbar"},[e.createElementVNode("view",{style:e.normalizeStyle({borderRadius:s.radius+"px",backgroundColor:s.bgColor}),class:"uni-searchbar__box",onClick:o[5]||(o[5]=(...e)=>r.searchClick&&r.searchClick(...e))},[e.createElementVNode("view",{class:"uni-searchbar__box-icon-search"},[e.renderSlot(t.$slots,"searchIcon",{},(()=>[e.createVNode(c,{color:"#c0c4cc",size:"18",type:"search"})]),!0)]),l.show||l.searchVal?e.withDirectives((e.openBlock(),e.createElementBlock("input",{key:0,focus:l.showSync,disabled:s.readonly,placeholder:r.placeholderText,maxlength:s.maxlength,class:"uni-searchbar__box-search-input","confirm-type":"search",type:"text","onUpdate:modelValue":o[0]||(o[0]=e=>l.searchVal=e),style:e.normalizeStyle({color:s.textColor}),onConfirm:o[1]||(o[1]=(...e)=>r.confirm&&r.confirm(...e)),onBlur:o[2]||(o[2]=(...e)=>r.blur&&r.blur(...e)),onFocus:o[3]||(o[3]=(...e)=>r.emitFocus&&r.emitFocus(...e))},null,44,["focus","disabled","placeholder","maxlength"])),[[e.vModelText,l.searchVal]]):(e.openBlock(),e.createElementBlock("text",{key:1,class:"uni-searchbar__text-placeholder"},e.toDisplayString(s.placeholder),1)),l.show&&("always"===s.clearButton||"auto"===s.clearButton&&""!==l.searchVal)&&!s.readonly?(e.openBlock(),e.createElementBlock("view",{key:2,class:"uni-searchbar__box-icon-clear",onClick:o[4]||(o[4]=(...e)=>r.clear&&r.clear(...e))},[e.renderSlot(t.$slots,"clearIcon",{},(()=>[e.createVNode(c,{color:"#c0c4cc",size:"20",type:"clear"})]),!0)])):e.createCommentVNode("",!0)],4),"always"===s.cancelButton||l.show&&"auto"===s.cancelButton?(e.openBlock(),e.createElementBlock("text",{key:0,onClick:o[6]||(o[6]=(...e)=>r.cancel&&r.cancel(...e)),class:"uni-searchbar__cancel"},e.toDisplayString(r.cancelTextI18n),1)):e.createCommentVNode("",!0)])}],["__scopeId","data-v-510eacc3"]]);const pe=o({data:()=>({searchText:"",searchResults:[],searchTimer:null,hasSearched:!1}),watch:{searchText:{handler(e,t){if(this.searchTimer&&clearTimeout(this.searchTimer),!this.searchText.trim())return this.searchResults=[],void(this.hasSearched=!1);this.searchTimer=setTimeout((()=>{this.searchUser()}),500)}}},methods:{async searchUser(){try{await uni.request({url:`https://gal-chat-test-970e995e1901.herokuapp.com/api/profile/byUsername/${this.searchText}`,method:"GET",header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")},success:e=>{const a=e.data;this.hasSearched=!0,a.status?(this.searchResults=a.value,t("log","at pages/tabBar/contacts/newRealFriend.vue:79",this.searchResults)):this.searchResults=[]}})}catch(e){this.searchResults=[],uni.showToast({title:"网络错误",icon:"none"})}},showdetail(){uni.navigateTo({url:`/pages/detail/userdetail?id=${this.searchResults.id}&username=${this.searchText}&nickname=${this.searchResults.nickname}`})}}},[["render",function(t,o,s,n,i,l){const r=a(e.resolveDynamicComponent("uni-search-bar"),he);return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("view",{class:"nav-bar"},[e.createElementVNode("view",{class:"nav-search"},[e.createVNode(r,{modelValue:i.searchText,"onUpdate:modelValue":o[0]||(o[0]=e=>i.searchText=e),radius:"100",cancelButton:"none",placeholder:"点击搜索新的好友"},null,8,["modelValue"])])]),e.createElementVNode("view",null,[0!=i.searchResults.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"search-results"},[e.createElementVNode("view",{class:"user-item",onClick:o[1]||(o[1]=e=>l.showdetail())},[e.createElementVNode("image",{class:"user-avatar",src:h,mode:"aspectFill"}),e.createElementVNode("text",{class:"user-name"},e.toDisplayString(i.searchResults.username),1)])])):e.createCommentVNode("",!0),i.searchText&&0===i.searchResults.length?(e.openBlock(),e.createElementBlock("view",{key:1,class:"no-results"},[e.createElementVNode("text",null,"未找到相关用户")])):e.createCommentVNode("",!0)])],64)}]]);const ge=o({},[["render",function(t,o){const s=a(e.resolveDynamicComponent("uni-search-bar"),he),n=a(e.resolveDynamicComponent("uni-icons"),i);return e.openBlock(),e.createElementBlock("view",{class:"nav-bar"},[e.createElementVNode("view",{class:"nav-search"},[e.createVNode(s,{modelValue:t.searchText,"onUpdate:modelValue":o[0]||(o[0]=e=>t.searchText=e),radius:"100",cancelButton:"none",placeholder:"点击搜索群聊"},null,8,["modelValue"])]),e.createElementVNode("view",{class:"nav-add",onClick:o[1]||(o[1]=e=>t.onAddNewFriends())},[e.createVNode(n,{type:"personadd",size:"35"})])])}]]);const fe=o({data:()=>({listData:[{title:"昵称",url:"/pages/accountsetting/setnickname"},{title:"用户名",url:"/pages/accountsetting/setaccount"},{title:"修改密码",url:"/pages/accountsetting/setpassword"}]}),methods:{navigateTo(e){uni.navigateTo({url:e})}}},[["render",function(t,o,s,n,i,l){const r=a(e.resolveDynamicComponent("uni-list-item"),u),c=a(e.resolveDynamicComponent("uni-list"),d);return e.openBlock(),e.createElementBlock("view",null,[e.createVNode(c,null,{default:e.withCtx((()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.listData,((t,a)=>(e.openBlock(),e.createBlock(r,{key:a,title:t.title,clickable:"",onClick:e=>l.navigateTo(t.url)},null,8,["title","onClick"])))),128))])),_:1})])}]]);const ye=o({data:()=>({isValid:!1,oldnickname:uni.getStorageSync("nickname")??"",dataForm:{nickName:uni.getStorageSync("nickname")??""},rules:{nickName:{rules:[{required:!0,errorMessage:"请输入昵称"}]}}}),onLoad(){this.dataForm={nickName:uni.getStorageSync("nickname")}},watch:{dataForm:{handler(e,t){this.dataForm.nickName!=this.oldnickname&&""!=this.dataForm.nickName?this.isValid=!0:this.isValid=!1},deep:!0}},methods:{submit(){const e={username:uni.getStorageSync("username"),nickname:this.dataForm.nickName,password:uni.getStorageSync("password"),confirmPassword:uni.getStorageSync("password")};uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/profile/update",method:"PUT",header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")},data:e,success:e=>{const t=e.data;t.status?(uni.setStorageSync("nickname",this.dataForm.nickName),uni.showToast({title:"修改成功",icon:"success",duration:2e3}),uni.navigateBack()):uni.showModal({title:"修改失败",content:t.message,showCancel:!1})},fail:e=>{uni.showModal({title:"错误",content:"网络请求失败，请稍后重试",showCancel:!1}),t("error","at pages/accountsetting/setnickname.vue:91","请求失败：",e)}})}}},[["render",function(t,o,s,n,i,l){const r=a(e.resolveDynamicComponent("uni-easyinput"),y),c=a(e.resolveDynamicComponent("uni-forms-item"),b),u=a(e.resolveDynamicComponent("uni-forms"),$);return e.openBlock(),e.createElementBlock("view",{class:"register"},[e.createVNode(u,{class:"form",modelValue:i.dataForm,rules:i.rules,"validate-trigger":"bind","label-width":"80px"},{default:e.withCtx((()=>[e.createVNode(c,{name:"nickName",label:"昵称"},{default:e.withCtx((()=>[e.createVNode(r,{type:"text",modelValue:i.dataForm.nickName,"onUpdate:modelValue":o[0]||(o[0]=e=>i.dataForm.nickName=e),placeholder:"昵称"},null,8,["modelValue"]),e.createElementVNode("text",{class:"tip-text"},"一个好的昵称可以让好友轻松记住你")])),_:1}),e.createElementVNode("button",{class:"btn-submit",disabled:!i.isValid,onClick:o[1]||(o[1]=(...e)=>l.submit&&l.submit(...e)),type:"primary"},"保存",8,["disabled"])])),_:1},8,["modelValue","rules"])])}],["__scopeId","data-v-7d26bea0"]]);const be=o({data:()=>({isValid:!1,oldusername:uni.getStorageSync("username")??"",dataForm:{username:uni.getStorageSync("username")??""},rules:{username:{rules:[{required:!0,errorMessage:"请输入用户名"},{minLength:6,errorMessage:"用户名不能少于6个字符"}]}}}),onLoad(){this.dataForm={username:uni.getStorageSync("username")}},watch:{dataForm:{handler(e,t){this.dataForm.username!=this.oldusername&&""!=this.dataForm.username?this.isValid=!0:this.isValid=!1},deep:!0}},methods:{submit(){const e={username:this.dataForm.username,nickname:uni.getStorageSync("nickname"),password:uni.getStorageSync("password"),confirmPassword:uni.getStorageSync("password")};uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/profile/update",method:"PUT",header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")},data:e,success:e=>{const t=e.data;t.status?(uni.setStorageSync("username",this.dataForm.username),uni.showToast({title:"修改成功",icon:"success",duration:2e3}),uni.navigateBack()):uni.showModal({title:"修改失败",content:t.message,showCancel:!1})},fail:e=>{uni.showModal({title:"错误",content:"网络请求失败，请稍后重试",showCancel:!1}),t("error","at pages/accountsetting/setaccount.vue:94","请求失败：",e)}})}}},[["render",function(t,o,s,n,i,l){const r=a(e.resolveDynamicComponent("uni-easyinput"),y),c=a(e.resolveDynamicComponent("uni-forms-item"),b),u=a(e.resolveDynamicComponent("uni-forms"),$);return e.openBlock(),e.createElementBlock("view",{class:"register"},[e.createVNode(u,{class:"form",modelValue:i.dataForm,rules:i.rules,"validate-trigger":"bind","label-width":"80px"},{default:e.withCtx((()=>[e.createVNode(c,{name:"userName",label:"用户名"},{default:e.withCtx((()=>[e.createVNode(r,{type:"text",modelValue:i.dataForm.username,"onUpdate:modelValue":o[0]||(o[0]=e=>i.dataForm.username=e),placeholder:"用户名"},null,8,["modelValue"]),e.createElementVNode("text",{class:"tip-text"},"用户名是账号的唯一凭证，用于登录，请牢记")])),_:1}),e.createElementVNode("button",{class:"btn-submit",disabled:!i.isValid,onClick:o[1]||(o[1]=(...e)=>l.submit&&l.submit(...e)),type:"primary"},"保存",8,["disabled"])])),_:1},8,["modelValue","rules"])])}],["__scopeId","data-v-d6b60714"]]);const ke=o({data:()=>({isValid:!1,dataForm:{oldpassword:"",password:"",confirmPassword:""},rules:{oldpassword:{rules:[{required:!0,errorMessage:"请输入旧密码"}]},password:{rules:[{required:!0,errorMessage:"请输入新密码"},{minLength:6,errorMessage:"密码不能少于6个字符"}]},confirmPassword:{rules:[{required:!0,errorMessage:"请输入确认密码"},{validateFunction:(e,t,a,o)=>(a.password!=t&&o("两次密码输入不一致"),!0)}]}}}),watch:{dataForm:{handler(e,t){""!=this.dataForm.oldpassword&&""!=this.dataForm.password&&this.dataForm.password==this.dataForm.confirmPassword?this.isValid=!0:this.isValid=!1},deep:!0}},methods:{submit(){const e={username:uni.getStorageSync("username"),nickname:uni.getStorageSync("nickname"),password:this.dataForm.password,confirmPassword:this.dataForm.oldpassword};uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/profile/update",method:"PUT",header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")},data:e,success:e=>{const t=e.data;t.status?(uni.setStorageSync("password",this.dataForm.password),uni.showToast({title:"修改成功",icon:"success",duration:2e3}),uni.navigateBack()):uni.showModal({title:"修改失败",content:t.message,showCancel:!1})},fail:e=>{uni.showModal({title:"错误",content:"网络请求失败，请稍后重试",showCancel:!1}),t("error","at pages/accountsetting/setpassword.vue:115","请求失败：",e)}})}}},[["render",function(t,o,s,n,i,l){const r=a(e.resolveDynamicComponent("uni-easyinput"),y),c=a(e.resolveDynamicComponent("uni-forms-item"),b),u=a(e.resolveDynamicComponent("uni-forms"),$);return e.openBlock(),e.createElementBlock("view",{class:"register"},[e.createVNode(u,{class:"form",modelValue:i.dataForm,rules:i.rules,"validate-trigger":"bind","label-width":"80px"},{default:e.withCtx((()=>[e.createVNode(c,{name:"oldpassword",label:"旧密码"},{default:e.withCtx((()=>[e.createVNode(r,{type:"password",modelValue:i.dataForm.oldpassword,"onUpdate:modelValue":o[0]||(o[0]=e=>i.dataForm.oldpassword=e),placeholder:"旧密码"},null,8,["modelValue"])])),_:1}),e.createVNode(c,{name:"password",label:"新密码"},{default:e.withCtx((()=>[e.createVNode(r,{type:"password",modelValue:i.dataForm.password,"onUpdate:modelValue":o[1]||(o[1]=e=>i.dataForm.password=e),placeholder:"新密码"},null,8,["modelValue"])])),_:1}),e.createVNode(c,{name:"confirmPassword",label:"确认密码"},{default:e.withCtx((()=>[e.createVNode(r,{type:"password",modelValue:i.dataForm.confirmPassword,"onUpdate:modelValue":o[2]||(o[2]=e=>i.dataForm.confirmPassword=e),placeholder:"确认密码"},null,8,["modelValue"])])),_:1}),e.createElementVNode("button",{class:"btn-submit",disabled:!i.isValid,onClick:o[3]||(o[3]=(...e)=>l.submit&&l.submit(...e)),type:"primary"},"保存",8,["disabled"])])),_:1},8,["modelValue","rules"])])}],["__scopeId","data-v-7ea9b5f2"]]);const ve=o({data:()=>({dataForm:{mood:"添加心情"===uni.getStorageSync("mood")?"":uni.getStorageSync("mood")}}),onLoad(){this.dataForm={mood:"添加心情"===uni.getStorageSync("mood")?"":uni.getStorageSync("mood")}},methods:{submit(){const e={mood:""===this.dataForm.mood?"添加心情":this.dataForm.mood};uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/profile/mood",method:"PUT",header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")},data:e,success:e=>{const t=e.data;t.status?(uni.setStorageSync("mood",this.dataForm.mood),uni.showToast({title:"修改成功",icon:"success",duration:2e3}),uni.switchTab({url:"/pages/tabBar/me/me"})):uni.showModal({title:"修改失败",content:t.message,showCancel:!1})},fail:e=>{uni.showModal({title:"错误",content:"网络请求失败，请稍后重试",showCancel:!1}),t("error","at pages/accountsetting/setmood.vue:68","请求失败：",e)}})}}},[["render",function(t,o,s,n,i,l){const r=a(e.resolveDynamicComponent("uni-easyinput"),y),c=a(e.resolveDynamicComponent("uni-forms-item"),b),u=a(e.resolveDynamicComponent("uni-forms"),$);return e.openBlock(),e.createElementBlock("view",{class:"register"},[e.createVNode(u,{class:"form",modelValue:i.dataForm,rules:t.rules,"validate-trigger":"bind","label-width":"80px"},{default:e.withCtx((()=>[e.createVNode(c,{name:"mood",label:"心情"},{default:e.withCtx((()=>[e.createVNode(r,{type:"text",modelValue:i.dataForm.mood,"onUpdate:modelValue":o[0]||(o[0]=e=>i.dataForm.mood=e),placeholder:"无心情"},null,8,["modelValue"]),e.createElementVNode("text",{class:"tip-text"},"将心情告诉你的好友")])),_:1}),e.createElementVNode("button",{class:"btn-submit",onClick:o[1]||(o[1]=(...e)=>l.submit&&l.submit(...e)),type:"primary"},"保存")])),_:1},8,["modelValue","rules"])])}],["__scopeId","data-v-701fe7fb"]]);const we=o({data:()=>({dataForm:{status:"添加状态"===uni.getStorageSync("status")?"":uni.getStorageSync("status")}}),onLoad(){this.dataForm={status:"添加状态"===uni.getStorageSync("status")?"":uni.getStorageSync("status")}},methods:{submit(){const e={status:""===this.dataForm.status?"添加状态":this.dataForm.status};uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/profile/status",method:"PUT",header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")},data:e,success:e=>{const t=e.data;t.status?(uni.setStorageSync("status",this.dataForm.status),uni.showToast({title:"修改成功",icon:"success",duration:2e3}),uni.switchTab({url:"/pages/tabBar/me/me"})):uni.showModal({title:"修改失败",content:t.message,showCancel:!1})},fail:e=>{uni.showModal({title:"错误",content:"网络请求失败，请稍后重试",showCancel:!1}),t("error","at pages/accountsetting/setstatus.vue:68","请求失败：",e)}})}}},[["render",function(t,o,s,n,i,l){const r=a(e.resolveDynamicComponent("uni-easyinput"),y),c=a(e.resolveDynamicComponent("uni-forms-item"),b),u=a(e.resolveDynamicComponent("uni-forms"),$);return e.openBlock(),e.createElementBlock("view",{class:"register"},[e.createVNode(u,{class:"form",modelValue:i.dataForm,rules:t.rules,"validate-trigger":"bind","label-width":"80px"},{default:e.withCtx((()=>[e.createVNode(c,{name:"status",label:"状态"},{default:e.withCtx((()=>[e.createVNode(r,{type:"text",modelValue:i.dataForm.status,"onUpdate:modelValue":o[0]||(o[0]=e=>i.dataForm.status=e),placeholder:"无状态"},null,8,["modelValue"]),e.createElementVNode("text",{class:"tip-text"},"将你的状态告诉你的好友")])),_:1}),e.createElementVNode("button",{class:"btn-submit",onClick:o[1]||(o[1]=(...e)=>l.submit&&l.submit(...e)),type:"primary"},"保存")])),_:1},8,["modelValue","rules"])])}],["__scopeId","data-v-a04538a2"]]);const Se=o({data:()=>({isexist:""!==uni.getStorageSync("cal"),dataForm:{cal:""===uni.getStorageSync("cal")?"":uni.getStorageSync("cal")}}),onLoad(){this.dataForm={cal:""===uni.getStorageSync("cal")?"":uni.getStorageSync("cal")}},methods:{submit(){const e={content:""===this.dataForm.cal?"":this.dataForm.cal,userIds:[uni.getStorageSync("id")]};uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/profile/calendar",method:"POST",header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")},data:e,success:e=>{const t=e.data;t.status?(uni.setStorageSync("cal",this.dataForm.cal),uni.showToast({title:"添加成功",icon:"success",duration:2e3}),uni.switchTab({url:"/pages/tabBar/me/me"})):uni.showModal({title:"添加失败",content:t.message,showCancel:!1})},fail:e=>{uni.showModal({title:"错误",content:"网络请求失败，请稍后重试",showCancel:!1}),t("error","at pages/accountsetting/setcal.vue:74","请求失败：",e)}})},alter(){const e={content:""===this.dataForm.cal?"null":this.dataForm.cal,userIds:[uni.getStorageSync("id")]};uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/profile/calendar",method:"PUT",header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")},data:e,success:e=>{const t=e.data;t.status?(uni.setStorageSync("cal",this.dataForm.cal),uni.showToast({title:"修改成功",icon:"success",duration:2e3}),uni.switchTab({url:"/pages/tabBar/me/me"})):uni.showModal({title:"修改失败",content:t.message,showCancel:!1})},fail:e=>{uni.showModal({title:"错误",content:"网络请求失败，请稍后重试",showCancel:!1}),t("error","at pages/accountsetting/setcal.vue:119","请求失败：",e)}})},remove(){uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/profile/calendar",method:"DELETE",header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")},success:e=>{const t=e.data;t.status?(uni.setStorageSync("cal","null"),uni.showToast({title:"删除成功",icon:"success",duration:2e3}),uni.switchTab({url:"/pages/tabBar/me/me"})):uni.showModal({title:"删除失败",content:t.message,showCancel:!1})},fail:e=>{uni.showModal({title:"错误",content:"网络请求失败，请稍后重试",showCancel:!1}),t("error","at pages/accountsetting/setcal.vue:159","请求失败：",e)}})}}},[["render",function(t,o,s,n,i,l){const r=a(e.resolveDynamicComponent("uni-forms-item"),b),c=a(e.resolveDynamicComponent("uni-forms"),$);return e.openBlock(),e.createElementBlock("view",{class:"register"},[e.createVNode(c,{class:"form",modelValue:i.dataForm,rules:t.rules,"validate-trigger":"bind","label-width":"80px"},{default:e.withCtx((()=>[e.createVNode(r,{name:"cal",label:"日程"},{default:e.withCtx((()=>[e.withDirectives(e.createElementVNode("textarea",{class:"cal-textarea","onUpdate:modelValue":o[0]||(o[0]=e=>i.dataForm.cal=e),placeholder:"无日程"},null,512),[[e.vModelText,i.dataForm.cal]]),e.createElementVNode("text",{class:"tip-text"},"将你的日程告诉你的好友")])),_:1}),i.isexist?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn-submit",onClick:o[1]||(o[1]=(...e)=>l.submit&&l.submit(...e)),type:"primary"},"添加日程")),i.isexist?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn-submit",onClick:o[2]||(o[2]=(...e)=>l.alter&&l.alter(...e)),type:"primary"},"保存修改")):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"btn-submit",onClick:o[3]||(o[3]=(...e)=>l.remove&&l.remove(...e)),type:"warn"},"删除日程")])),_:1},8,["modelValue","rules"])])}],["__scopeId","data-v-4c9a22b5"]]);const _e=o({data:()=>({isfriend:!1,id:"",nickname:"",username:""}),onLoad(e){this.id=e.id,this.nickname=e.nickname,this.username=e.username},methods:{onAddTap(){const e={contactUserId:this.id,contactType:"real"};t("log","at pages/detail/userdetail.vue:43",this.id),uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/contacts",method:"POST",header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")},data:e,success:e=>{const t=e.data;t.status&&(this.isfriend=!0),uni.showToast({title:t.message,icon:"none"})}})}}},[["render",function(t,a,o,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"top-section"},[e.createElementVNode("view",{class:"head-sculpture"},[e.createElementVNode("image",{src:h})]),e.createElementVNode("view",{class:"right-section"},[e.createElementVNode("view",{class:"nickname"},"昵称："+e.toDisplayString(n.nickname),1),e.createElementVNode("view",{class:"username"},"用户名："+e.toDisplayString(n.username),1)])]),e.createElementVNode("view",{class:"add-friend"},[e.createElementVNode("button",{class:"add-button",onClick:a[0]||(a[0]=(...e)=>i.onAddTap&&i.onAddTap(...e)),disabled:n.isfriend},e.toDisplayString(n.isfriend?"已添加":"添加好友"),9,["disabled"])])])}],["__scopeId","data-v-24f682fd"]]);const Ve=o({data:()=>({id:"",nickname:"",username:"",mood:"",status:"",calendar:""}),onLoad(e){this.id=e.id,this.nickname=e.nickname,this.username=e.username,this.chatId=e.chatId,"null"===e.mood||"添加心情"===e.mood?this.mood="无心情":this.mood=e.mood,"null"===e.status||"添加状态"===e.status?this.status="无状态":this.status=e.status,t("log","at pages/detail/frienddetail.vue:58",e.calendar),""===e.calendar?this.calendar="无日程":this.calendar=e.calendar.content,t("log","at pages/detail/frienddetail.vue:64",this.calendar)},methods:{navigateToChatRoom(){uni.navigateTo({url:`/pages/tabBar/chats/chat-room?chatId=${this.chatId}`})}}},[["render",function(t,a,o,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"top-section"},[e.createElementVNode("view",{class:"head-sculpture"},[e.createElementVNode("image",{src:h})]),e.createElementVNode("view",{class:"right-section"},[e.createElementVNode("view",{class:"nickname"},"昵称："+e.toDisplayString(n.nickname),1),e.createElementVNode("view",{class:"username"},"用户名："+e.toDisplayString(n.username),1)])]),e.createElementVNode("view",{class:"middle-section"},[e.createElementVNode("button",{class:"mood",onClick:a[0]||(a[0]=(...e)=>t.onMoodTap&&t.onMoodTap(...e))},e.toDisplayString(n.mood),1),e.createElementVNode("button",{class:"status",onClick:a[1]||(a[1]=(...e)=>t.onStatusTap&&t.onStatusTap(...e))},e.toDisplayString(n.status),1)]),e.createElementVNode("view",{class:"add-friend"},[e.createElementVNode("button",{class:"add-button",clickable:"",onClick:a[2]||(a[2]=e=>i.navigateToChatRoom())},"发消息")])])}],["__scopeId","data-v-a30400df"]]);const Ce=o({data:()=>({loading:!1,searchText:"",chats:[],filteredChats:[]}),methods:{async loadChats(){this.loading=!0;try{const e=await uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/characters",method:"GET",header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")}});this.chats=e.data.value||[],this.filteredChats=this.chats}catch(e){t("error","at pages/tabBar/ai/contacts.vue:61","Failed to load chats:",e),uni.showToast({title:"Error loading chats",icon:"none"})}finally{this.loading=!1}},async createChat(){this.loading=!0;try{const e=await uni.request({url:"https://gal-chat-test-970e995e1901.herokuapp.com/api/chat",method:"POST",data:{chatName:"chat with AI",type:"virtual"},header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")}});uni.navigateTo({url:`/pages/tabBar/chats/chat-room?chatId=${e.data.value.id}&actionType=virtual`})}catch(e){t("error","at pages/tabBar/ai/contacts.vue:91","Failed to create AI chat:",e),uni.showToast({title:"Error creating chat",icon:"none"})}finally{this.loading=!1}},onSearch(){""===this.searchText.trim()?this.filteredChats=this.chats:this.filteredChats=this.chats.filter((e=>e.chatName.toLowerCase().includes(this.searchText.toLowerCase())))},openChatRoom(e){e.chatId?uni.navigateTo({url:`/pages/tabBar/chats/chat-room?chatId=${e.chatId}&characterId=${e.id}&actionType=virtual`}):uni.showToast({title:"Character error",icon:"error"})},onAddNewFriends(){uni.navigateTo({url:"/pages/tabBar/contacts/add-friend"})}},created(){this.loadChats()}},[["render",function(t,o,s,n,l,r){const c=a(e.resolveDynamicComponent("uni-search-bar"),he),u=a(e.resolveDynamicComponent("uni-icons"),i);return e.openBlock(),e.createElementBlock("view",{class:"container"},[l.loading?(e.openBlock(),e.createElementBlock("view",{key:0,class:"chat-loading"},[e.createElementVNode("view",{size:50,mask:!1},[e.createElementVNode("view",null,"Starting AI chat, please wait...")])])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"nav-bar"},[e.createElementVNode("view",{class:"nav-search"},[e.createVNode(c,{modelValue:l.searchText,"onUpdate:modelValue":o[0]||(o[0]=e=>l.searchText=e),radius:"100",cancelButton:"none",placeholder:"Search virtual chats",onConfirm:r.onSearch},null,8,["modelValue","onConfirm"])]),e.createElementVNode("view",{class:"nav-startAi",onClick:o[1]||(o[1]=(...e)=>r.createChat&&r.createChat(...e))}," Start now with AI "),e.createElementVNode("view",{class:"nav-add",onClick:o[2]||(o[2]=(...e)=>r.onAddNewFriends&&r.onAddNewFriends(...e))},[e.createVNode(u,{type:"personadd",size:"35"})])]),l.chats.length>0?(e.openBlock(),e.createElementBlock("view",{key:1,class:"chat-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.filteredChats,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"chat-item",onClick:e=>r.openChatRoom(t)},[e.createElementVNode("view",{class:"chat-name"},e.toDisplayString(t.name),1)],8,["onClick"])))),128))])):(e.openBlock(),e.createElementBlock("view",{key:2},[e.createElementVNode("view",{class:"no-chats"},"No virtual chats found.")]))])}],["__scopeId","data-v-c456b593"]]);const Be=o({data:()=>({profile:null,inputMessage:"",scrollTop:0,messages:null,loading:!0}),onLoad(e){this.chatId=e.chatId,this.actionType="virtual"===e.actionType?"sendOpenai":"sendMessage",this.characterId=e.characterId||null,this.initializeProfile()},methods:{async initializeProfile(){const e=K();this.profile=e.profile,this.profile?(await this.fetchInitialMessages(),this.setupSocketConnection()):t("error","at pages/tabBar/chats/chat-room.vue:80","Profile not loaded. Please check authentication.")},async fetchInitialMessages(){try{const e=await this.fetchNewMessages(1);this.messages=e.value,this.scrollToBottom()}catch(e){t("error","at pages/tabBar/chats/chat-room.vue:90","Error fetching initial messages:",e)}},async fetchNewMessages(e=1){try{return(await new Promise(((t,a)=>{uni.request({url:`https://gal-chat-test-970e995e1901.herokuapp.com/api/chat/messages/${this.chatId}?page=${e}&limit=30`,method:"GET",header:{"Content-Type":"application/json",authorization:uni.getStorageSync("token")},success:e=>t(e),fail:e=>a(e)})}))).data}catch(a){return t("error","at pages/tabBar/chats/chat-room.vue:111","Error fetching messages:",a),{data:[]}}},sendMessage(){this.inputMessage.trim()&&(this.socketTask.send({data:JSON.stringify({event:this.actionType,data:{chatId:this.chatId,userId:this.profile.id,characterId:this.characterId,message:this.inputMessage.trim()}})}),t("log","at pages/tabBar/chats/chat-room.vue:134",this.actionType,this.inputMessage.trim()),this.inputMessage="",this.$nextTick((()=>{this.scrollToBottom()})))},scrollToBottom(){uni.createSelectorQuery().in(this).select(".message-list").boundingClientRect((e=>{this.scrollTop=e.height})).exec()},async loadMoreMessages(){if(this.messages.totalPages>this.messages.currentPage)try{const e=await this.fetchNewMessages(this.messages.currentPage+1),t=[...this.messages.data];this.messages=e.value,this.messages.data=[...this.messages.data,...t]}catch(e){t("error","at pages/tabBar/chats/chat-room.vue:161","Error loading more messages:",e)}},setupSocketConnection(){try{this.socketTask=uni.connectSocket({url:"https://gal-chat-test-970e995e1901.herokuapp.com",complete:e=>t("log","at pages/tabBar/chats/chat-room.vue:170","complete",e),success:()=>{t("log","at pages/tabBar/chats/chat-room.vue:172","WebSocket connection initiated"),this.loading=!1}}),t("log","at pages/tabBar/chats/chat-room.vue:176","this.socketTask",this.socketTask),this.socketTask.onOpen((()=>{t("log","at pages/tabBar/chats/chat-room.vue:178","WebSocket connection opened"),this.socketTask.send({data:JSON.stringify({event:"joinChat",data:{chatId:this.chatId,userId:this.profile.id}})})})),this.socketTask.onMessage((e=>{try{const a=JSON.parse(e.data);"newMessage"===a.event&&(t("log","at pages/tabBar/chats/chat-room.vue:195","New message received:",a.data),this.messages.data=[...this.messages.data,a.data])}catch(a){t("error","at pages/tabBar/chats/chat-room.vue:199","Error parsing message:",a)}})),t("log","at pages/tabBar/chats/chat-room.vue:203","setupSocketConnection")}catch(e){t("error","at pages/tabBar/chats/chat-room.vue:205","Socket connection error:",e)}}},onUnload(){this.socketTask&&(this.socketTask.close({success:()=>{t("log","at pages/tabBar/chats/chat-room.vue:214","WebSocket connection closed")},fail:e=>{t("error","at pages/tabBar/chats/chat-room.vue:217","Failed to close WebSocket connection:",e)}}),this.socketTask.onOpen(null),this.socketTask.onMessage(null),this.socketTask.onError(null),this.socketTask.onClose(null))}},[["render",function(t,a,o,s,n,i){var l;return e.openBlock(),e.createElementBlock("view",{class:"chat-container"},[n.loading?(e.openBlock(),e.createElementBlock("view",{key:0,class:"chat-loading"},[e.createElementVNode("view",{size:50,mask:!1},[e.createElementVNode("view",null,"Starting chat, please wait...")])])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"chat-header"},[e.createElementVNode("text",{class:"header-title"},"聊天室")]),e.createElementVNode("scroll-view",{class:"chat-messages","scroll-y":"true","scroll-top":n.scrollTop,"scroll-with-animation":!0,onScrolltoupper:a[0]||(a[0]=(...e)=>i.loadMoreMessages&&i.loadMoreMessages(...e))},[e.createElementVNode("view",{class:"message-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList((null==(l=n.messages)?void 0:l.data)||[],((t,a)=>{var o;return e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["message-item",(null==t?void 0:t.userId)===(null==(o=n.profile)?void 0:o.id)?"message-right":"message-left"])},[e.createElementVNode("image",{class:"avatar",src:h,mode:"aspectFill"}),e.createElementVNode("view",{class:"message-box"},[e.createElementVNode("view",{class:"sender-box"},[e.createElementVNode("text",{class:"sender-text"},e.toDisplayString(t.sender),1)]),e.createElementVNode("view",{class:"message-content"},[e.createElementVNode("text",{class:"message-text"},e.toDisplayString(t.message),1)])])],2)})),128))])],40,["scroll-top"]),e.createElementVNode("view",{class:"chat-footer"},[e.createElementVNode("view",{class:"input-box"},[e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":a[1]||(a[1]=e=>n.inputMessage=e),"confirm-type":"send",onConfirm:a[2]||(a[2]=(...e)=>i.sendMessage&&i.sendMessage(...e)),placeholder:"请输入消息",class:"message-input"},null,544),[[e.vModelText,n.inputMessage]]),e.createElementVNode("button",{disabled:n.loading,class:e.normalizeClass(["send-btn",{active:n.inputMessage.length>0}]),onClick:a[3]||(a[3]=(...e)=>i.sendMessage&&i.sendMessage(...e))},"发送",10,["disabled"])])])])}]]);__definePage("pages/tabBar/chats/chats",r),__definePage("pages/tabBar/contacts/contacts",m),__definePage("pages/tabBar/me/me",p),__definePage("pages/log/log/log",g),__definePage("pages/log/login/login",Q),__definePage("pages/log/register/register",X),__definePage("pages/tabBar/chats/chat-box",Y),__definePage("pages/tabBar/contacts/newVirtualFriend",Z),__definePage("pages/tabBar/contacts/newRealFriend",pe),__definePage("pages/tabBar/contacts/groupChat",ge),__definePage("pages/tabBar/me/accountSetting",fe),__definePage("pages/accountsetting/setnickname",ye),__definePage("pages/accountsetting/setaccount",be),__definePage("pages/accountsetting/setpassword",ke),__definePage("pages/accountsetting/setmood",ve),__definePage("pages/accountsetting/setstatus",we),__definePage("pages/accountsetting/setcal",Se),__definePage("pages/detail/userdetail",_e),__definePage("pages/detail/frienddetail",Ve),__definePage("pages/tabBar/ai/contacts",Ce),__definePage("pages/tabBar/chats/chat-room",Be);const Ne={setup(){if(uni.getStorageSync("token")){K().initializeProfile()}},onLaunch:function(){t("warn","at App.vue:15","当前组件仅支持 uni_modules 目录结构 ，请升级 HBuilderX 到 3.1.0 版本以上！"),t("log","at App.vue:16","App Launch")},onShow:function(){t("log","at App.vue:19","App Show")},onHide:function(){t("log","at App.vue:22","App Hide")}};const{app:xe,Vuex:Ee,Pinia:Te}=function(){const t=e.createVueApp(Ne);return t.use(function(){const t=e.effectScope(!0),a=t.run((()=>e.ref({})));let o=[],s=[];const n=e.markRaw({install(e){D(n),n._a=e,e.provide(A,n),e.config.globalProperties.$pinia=n,s.forEach((e=>o.push(e))),s=[]},use(e){return this._a?o.push(e):s.push(e),this},_p:o,_a:null,_e:t,_s:new Map,state:a});return n}()),{app:t}}();uni.Vuex=Ee,uni.Pinia=Te,xe.provide("__globalStyles",__uniConfig.styles),xe._component.mpType="app",xe._component.render=()=>{},xe.mount("#app")}(Vue);
>>>>>>> 9b9fc38 (last version)
